<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>RuneTyper</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />

  <!-- Fonts -->
  <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Uncial+Antiqua&family=Roboto:wght@400;700&family=Courier+Prime:wght@400;700&family=Lobster&family=Playfair+Display:wght@400;700&family=Merriweather:wght@400;700&family=Inter:wght@400;700&family=Lato:wght@400;700&family=Montserrat:wght@400;700&family=Cinzel:wght@400;700&display=swap" />

  <style>
    :root {
      --bg-color: #222;
      --panel-bg: rgba(0,0,0,0.7);
      --header-text: #fff;
      --text-color: #eee;
      --accent-correct: #50fa7b;
      --accent-incorrect: #ff5555;
      --progress-bg: #444;
      --progress-bar: #b71c1c;
      --button-bg: #444;
      --button-hover: #666;
      --input-bg: #2b2b2b;
      --input-text: #f8f8f2;
      --heading-font: 'Uncial Antiqua', serif;
      --main-font: Roboto, Arial, sans-serif;
      --ui-scale: 1;
      --ring: 0 0 0 2px rgba(255,255,255,.12);
      --shadow-1: 0 6px 20px rgba(0,0,0,.25);
      --shadow-2: 0 8px 30px rgba(0,0,0,.35);
      --muted: #888;
    }

    html, body { margin: 0; height: 100%; }
    body {
      font-family: var(--main-font);
      color: var(--text-color);
      background: var(--bg-color) url('Background.png') no-repeat center/cover fixed;
    }
    input, textarea { cursor: text; }
    button, a, select { cursor: pointer; }

    header {
      background: var(--panel-bg);
      text-align: center;
      padding: 1rem;
      box-shadow: var(--shadow-1);
      backdrop-filter: saturate(120%) blur(2px);
    }
    header h1 {
      font-family: var(--heading-font);
      color: var(--header-text);
      margin: 0;
      font-size: 2rem;
    }

    .panel {
      display: none;
      max-width: 900px;
      margin: 2rem auto;
      padding: 1rem;
      background: var(--panel-bg);
      border-radius: 10px;
      border: 1px solid rgba(255,255,255,.08);
      box-shadow: var(--shadow-1);
      transform: scale(var(--ui-scale));
    }
    .panel.active { display: block; }

    /* Duel screen narrower */
    #duelScreen.panel { max-width: 520px; }

    .btn {
      background: linear-gradient(to bottom, var(--button-bg), #383838);
      color: var(--input-text);
      border: 1px solid rgba(255,255,255,.12);
      border-radius: 10px;
      padding: .6rem .9rem;
      cursor: pointer;
      transition: transform .12s ease, background .2s ease, box-shadow .2s ease;
      box-shadow: 0 1px 0 rgba(255,255,255,.06) inset, 0 1px 8px rgba(0,0,0,.25);
    }
    .btn:hover { transform: translateY(-1px); background: var(--button-hover); }
    .btn:active { transform: translateY(0); box-shadow: none; }
    .btn-ghost {
      background: transparent;
      border: 1px dashed rgba(255,255,255,.18);
    }

    input[type="text"], input[type="number"], select {
      width: 100%;
      font-size: 1rem;
      padding: 0.5rem;
      background: var(--input-bg);
      color: var(--input-text);
      border: 1px solid rgba(255,255,255,.12);
      border-radius: 10px;
      box-shadow: 0 1px 0 rgba(255,255,255,.05) inset;
    }
    input:focus-visible, select:focus-visible, button:focus-visible {
      outline: none; box-shadow: var(--ring), 0 0 0 3px rgba(0,0,0,.35);
    }

    /* Tab focus highlighting for keyboard navigation */
    button:focus-visible, input:focus-visible, select:focus-visible, a:focus-visible {
      outline: 2px solid var(--accent-correct);
      outline-offset: 2px;
      box-shadow: 0 0 0 2px rgba(80, 250, 123, 0.3);
    }
    
    /* Consistent focus colors based on theme */
    .btn:focus-visible {
      outline-color: var(--accent-correct);
      box-shadow: 0 0 0 2px rgba(80, 250, 123, 0.3), var(--ring), 0 0 0 3px rgba(0,0,0,.35);
    }
    
    input[type="text"]:focus-visible, input[type="number"]:focus-visible, select:focus-visible {
      outline-color: var(--accent-correct);
      border-color: var(--accent-correct);
      box-shadow: 0 0 0 2px rgba(80, 250, 123, 0.3);
    }

    /* Keyboard navigation focus highlighting */
    .keyboard-focus {
      outline: 3px solid var(--accent-correct) !important;
      outline-offset: 3px !important;
      box-shadow: 0 0 0 3px rgba(80, 250, 123, 0.4), var(--ring), 0 0 0 4px rgba(0,0,0,.35) !important;
      transform: scale(1.02);
      transition: all 0.15s ease;
    }
    
    .skill-button.keyboard-focus {
      border-color: var(--accent-correct);
      border-width: 3px;
      box-shadow: 0 0 0 3px rgba(80, 250, 123, 0.4), var(--ring), 0 0 0 4px rgba(0,0,0,.35);
      transform: scale(1.02);
      transition: all 0.15s ease;
    }
    
    .title-option.keyboard-focus {
      background: var(--accent-correct) !important;
      color: #000 !important;
      border-color: var(--accent-correct);
    }
    
    .achievement-item.keyboard-focus {
      border-color: var(--accent-correct);
      background: rgba(80, 250, 123, 0.1);
    }

      .card.keyboard-focus {
    border-color: var(--accent-correct);
    border-width: 3px;
    box-shadow: 0 0 0 3px rgba(80, 250, 123, 0.4), var(--ring), 0 0 0 4px rgba(0,0,0,.35);
    transform: scale(1.02);
    transition: all 0.15s ease;
  }

  .card button.keyboard-focus {
    border-color: var(--accent-correct);
    border-width: 3px;
    box-shadow: 0 0 0 3px rgba(80, 250, 123, 0.4), var(--ring), 0 0 0 4px rgba(0,0,0,.35);
    transform: scale(1.02);
    transition: all 0.15s ease;
    background: var(--accent-correct) !important;
    color: #000 !important;
  }

    /* Home */
    #homeHeaderBar {
      display: flex; flex-wrap: wrap; align-items: center; justify-content: space-between;
      gap: 1rem; margin-bottom: 1rem;
    }
    .stat-group {
      display: flex; gap: 1rem; align-items: center; flex-wrap: wrap;
      font-family: var(--heading-font); color: var(--header-text);
    }
    .actions { display: flex; gap: .6rem; flex-wrap: wrap; }

    /* Fixed 2 columns x 5 rows */
    .skill-buttons {
      display: grid;
      grid-template-columns: repeat(2, minmax(260px, 1fr));
      grid-auto-rows: auto;
      gap: 1rem;
    }
    @media (max-width: 640px) {
      .skill-buttons { grid-template-columns: 1fr; }
    }
    .skill-button {
      display: flex; flex-direction: column; gap: .5rem; text-align: left;
      border: 1px solid rgba(255,255,255,.08);
      border-radius: 12px; box-shadow: var(--shadow-1);
      background: linear-gradient(to bottom, var(--button-bg), #383838);
      padding: 1rem; transition: box-shadow .2s ease, transform .12s ease;
    }
    .skill-button:hover { box-shadow: var(--shadow-2); transform: translateY(-1px); }
    .progress-container {
      width: 100%; height: 12px; background: var(--progress-bg);
      border-radius: 999px; border: 1px solid rgba(255,255,255,.06); overflow: hidden;
    }
    .progress-bar {
      height: 100%; width: 0%; background: var(--progress-bar);
      border-radius: 999px; transition: width .25s ease;
    }
    .level-text { color: #ccc; font-size: .9rem; }

    .row { display: flex; gap: 1rem; align-items: center; flex-wrap: wrap; }
    .center { text-align: center; }
    .muted { color: #cfcfcf; font-size: .9rem; }
    .mb-1 { margin-bottom: .6rem; }
    .mt-1 { margin-top: .6rem; }

    /* Word box */
    .word-box {
      border: 1px solid rgba(255,255,255,.08);
      box-shadow: var(--shadow-1);
      background: #111; border-radius: 8px; min-height: 3.2em;
      padding: .6rem .8rem; white-space: pre-wrap; line-height: 1.9; letter-spacing: .3px;
      text-align: center; margin-bottom: .7rem;
    }
    .current-letter { text-decoration: underline; font-weight: 700; color: var(--accent-correct); text-shadow: 0 0 6px rgba(80,250,123,.35); }
    .letter.correct { color: var(--accent-correct); transition: color .08s linear; }
    .letter.incorrect { color: var(--accent-incorrect); text-shadow: 0 0 6px rgba(255,85,85,.25); }
    .final-correct { color: var(--accent-correct) !important; }
    .final-incorrect { color: var(--accent-incorrect) !important; }




    .profile-name { font-weight: 600; color: var(--header-text); }
    .profile-stats { font-size: .9rem; color: var(--muted); margin-top: .2rem; }

    /* Achievements page */
    #achievementsScreen .achievement-item {
      display: flex; align-items: center; gap: .8rem; padding: .8rem;
      border: 1px solid rgba(255,255,255,.1); border-radius: 8px;
      background: rgba(255,255,255,.02);
      transition: background .2s ease, border-color .2s ease;
    }
    #achievementsScreen .achievement-item.unlocked {
      border-color: var(--accent-correct);
      background: rgba(80,250,123,.05);
    }
    #achievementsScreen .achievement-item.locked {
      border-color: rgba(255,255,255,.2);
      background: rgba(255,255,255,.01);
      opacity: 0.7;
    }
    .achievement-icon {
      font-size: 1.5rem; width: 2rem; text-align: center;
    }
    .achievement-info { flex: 1; }
    .achievement-name { font-weight: 600; color: var(--header-text); margin-bottom: .2rem; }
    .achievement-description { font-size: .9rem; color: var(--muted); }
    .achievement-title { font-size: .9rem; color: var(--accent-correct); font-weight: 600; margin-top: .2rem; }
    
    /* Title selection */
    #titleSelection {
      border-bottom: 1px solid rgba(255,255,255,.1);
      padding-bottom: 1rem;
      margin-bottom: 1rem;
    }
    #currentTitleDisplay {
      font-size: 1.1rem;
      color: var(--accent-correct);
      font-weight: 600;
      margin: .5rem 0;
      padding: .5rem;
      background: rgba(80,250,123,.1);
      border: 1px solid var(--accent-correct);
      border-radius: 6px;
      text-align: center;
    }
    #titleSelectionList {
      display: flex;
      flex-wrap: wrap;
      gap: .5rem;
      margin-top: .5rem;
    }
    .title-option {
      padding: .4rem .8rem;
      background: rgba(255,255,255,.05);
      border: 1px solid rgba(255,255,255,.1);
      border-radius: 6px;
      cursor: pointer;
      transition: all .2s ease;
      font-size: .9rem;
    }
    .title-option:hover {
      background: rgba(255,255,255,.1);
      border-color: rgba(255,255,255,.2);
    }
    .title-option.selected {
      background: var(--accent-correct);
      color: #000;
      border-color: var(--accent-correct);
    }
    
    /* Options page */
    #optionsScreen label {
      display: block; font-weight: 600; letter-spacing: .2px; margin: .5rem 0 .2rem;
    }
    #optionsScreen select, #optionsScreen input[type="range"] {
      margin-bottom: 1rem;
    }
    #optionsScreen input[type="checkbox"] {
      margin-right: 0.5rem;
    }

    /* Shop */
    .shop-section { margin-top: .8rem; }
    .shop-grid {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(220px, 1fr));
      gap: 1rem;
    }
    .card {
      background: #121212; border: 1px solid rgba(255,255,255,.08);
      border-radius: 12px; padding: .8rem; display: grid; gap: .6rem;
    }
    .card-row { display: flex; align-items: center; justify-content: space-between; gap: .6rem; }
    .theme-swatch { height: 54px; border-radius: 8px; border: 1px solid rgba(255,255,255,.12); display: grid; grid-template-columns: 1fr 1fr 1fr; overflow: hidden; }
    .swatch { height: 100%; }

    /* Arena board */
    #arenaBoard {
      position: relative; width: 158px; height: 227px; margin: 1em auto;
      background: #222; border: 2px solid #444; border-radius: 12px; box-shadow: var(--shadow-1);
      overflow: hidden;
    }
    
    /* Arena completion text styling */
    #arenaBoard h3 {
      font-size: 1.1rem !important;
      line-height: 1.2;
      margin: 0 0 0.5rem 0;
    }
    
    #arenaBoard p {
      font-size: 0.9rem !important;
      line-height: 1.3;
      margin: 0.3rem 0;
    }
    
    #arenaBoard .btn {
      font-size: 0.85rem !important;
      padding: 0.4rem 0.6rem;
      min-height: auto;
      white-space: nowrap;
    }
    
    /* Ensure buttons fit in the arena board */
    #arenaBoard .btn:first-of-type {
      margin-right: 0.25rem;
    }
    
    #arenaBoard .btn:last-of-type {
      margin-left: 0.25rem;
    }
    @keyframes fadeout { 0% { opacity: 1; transform: scale(1);} 100% { opacity: 0; transform: scale(.5);} }
    @keyframes slideIn { 0% { opacity: 0; transform: translateX(100%); } 100% { opacity: 1; transform: translateX(0); } }

    /* Particles */
    #particleCanvas { position: fixed; inset: 0; pointer-events: none; z-index: 10; }

header { padding: 0.5rem 1rem; }
header h1 { font-size: 1.8rem; }
.panel { margin: 0.75rem auto; padding: 0.75rem; }

#homeHeaderBar { margin-bottom: 0.5rem; }
.skill-buttons { gap: 0.75rem; }
.skill-button { padding: 0.75rem; }
.progress-container { height: 10px; }

/* Clearer, slightly tighter typography on the home tiles */
#homeScreen .skill-title {
  font-size: clamp(1.15rem, 1rem + 0.6vw, 1.5rem);
  line-height: 1.2;
  color: var(--header-text);
  text-shadow: 0 1px 0 rgba(0,0,0,.6);
  font-family: var(--heading-font);
}
#homeScreen .level-text { font-size: 0.9rem; }

/* Keep 2x5 grid; ensure it starts higher on the page */
#homeScreen .skill-buttons {
  grid-template-columns: repeat(2, minmax(260px, 1fr));
}

/* Auto-scale UI on shorter screens */
@media (max-height: 920px) { :root { --ui-scale: 0.95; } }
@media (max-height: 840px) { :root { --ui-scale: 0.90; } }
@media (max-height: 760px) { :root { --ui-scale: 0.85; } }

/* Lane sizing (near-full panel width, with small gutter) */
:root { --lane-gutter: 1rem; }  /* total horizontal gutter across both sides */

/* Global safety */
*, *::before, *::after { box-sizing: border-box; }
.panel { overflow: hidden; }
.word-box { overflow-wrap: anywhere; word-break: break-word; }

/* Unified lane rules for Skills and Raid */
#gameScreen .word-box,
#gameScreen #typedInput,
#raidScreen .word-box,
#raidScreen #raidInput {
  display: block;
  width: 100%;
  max-width: calc(100% - var(--lane-gutter)); /* ~0.5rem each side */
  margin-left: auto;
  margin-right: auto;
  padding-inline: .5rem;
}

/* Vertical spacing */
#gameScreen .word-box,
#raidScreen .word-box { margin-bottom: .6rem; }
#gameScreen #typedInput,
#raidScreen #raidInput { margin-top: 0; }
  </style>
</head>
<body>
  <header><h1>RuneTyper</h1></header>

  <!-- Startup Screen -->
  <!-- Startup -->
  <section id="startupScreen" class="panel active" aria-labelledby="startupHeading">
    <div style="text-align: center; padding: 2rem;">
      <h1 id="startupHeading" style="font-family: var(--heading-font); color: var(--header-text); margin-bottom: 2rem; font-size: 3rem;">Who Dares Enter the Keep?</h1>
      
      <!-- Create New Profile Section -->
      <div id="newProfileSection">
        <div style="display: flex; gap: 1rem; justify-content: center; align-items: center; max-width: 400px; margin: 0 auto;">
          <input id="profileNameInput" type="text" placeholder="Type your name..." maxlength="20" style="flex: 1;" />
          <button id="createProfileBtn" class="btn">Create Profile</button>
        </div>
      </div>
    </div>
  </section>

  <!-- Home -->
  <section id="homeScreen" class="panel" aria-labelledby="homeHeading">
    <div id="homeHeaderBar">
      <div class="stat-group">
        <div>Profile: <span id="profileNameDisplay" style="color: var(--accent-correct); font-weight: 700;">Adventurer</span></div>
      </div>
      <div class="stat-group">
        <div>Total Level: <span id="totalLevelValue">0</span></div>
        <div>Avg WPM: <span id="avgWPMValue">0</span></div>
        <div>Gold: <span id="goldValue">0</span></div>
      </div>
    </div>

    <h2 id="homeHeading" style="position:absolute;left:-9999px;">Home</h2>
    
    <div class="row mb-1" style="justify-content: space-between;">
      <div style="display: flex; gap: 1rem;">
        <button id="achievementsBtn" class="btn">Achievements</button>
      </div>
      <div style="display: flex; gap: 1rem;">
        <button id="raidBtn" class="btn">Raid</button>
        <button id="arenaBtn" class="btn">Arena</button>
        <button id="duelBtn" class="btn">Duel</button>
        <button id="zenBtn" class="btn">Zen</button>
        <button id="shopBtn" class="btn">Shop</button>
        <button id="optionsBtn" class="btn">Options</button>
      </div>
    </div>
    
    <div id="skillButtonsContainer" class="skill-buttons"></div>
  </section>

  <!-- Skills Game -->
  <section id="gameScreen" class="panel" aria-labelledby="gameHeading">
    <div class="row mb-1">
      <h2 id="gameHeading" style="margin:0;">Skill: <span id="skillTitle">‚Äî</span></h2>
    </div>

    <div class="row mb-1 center" style="justify-content:center;">
      <div class="progress-container" style="flex:1 1 320px; max-width:560px;">
        <div class="progress-bar" id="gameSkillProgressBar"></div>
      </div>
      <div class="level-text">Level: <span id="skillLevel">1</span>/99</div>
      <div id="wpmDisplay" class="level-text">WPM: ‚Äî</div>
    </div>

    <div class="row mb-1 center" style="justify-content:center; gap:.8rem;">
      <div id="comboDisplay" class="level-text">Combo x1.00 (0)</div>
      <div id="lineBonusDisplay" class="level-text" style="opacity:.85;"></div>
    </div>

    <div id="wordBox" class="word-box"></div>
    <input id="typedInput" type="text" autocomplete="off" placeholder="Type here... (press Space to submit word)" />
  </section>

  <!-- Raid -->
  <section id="raidScreen" class="panel" aria-labelledby="raidHeading">
    <div class="row mb-1">
      <h2 id="raidHeading" style="margin:0;">Raid Mode</h2>
    </div>
    <div class="row center" style="justify-content:center;">
      <div>Level: <span id="raidLevel">1</span></div>
      <div>High Score: <span id="raidHighScore">0</span></div>
      <div>Errors: <span id="raidErrors">0</span>/3</div>
    </div>
    <div id="raidWordBox" class="word-box"></div>
    <input id="raidInput" type="text" autocomplete="off" placeholder="Type perfectly..." />
  </section>

  <!-- Arena -->
  <section id="arenaScreen" class="panel" aria-labelledby="arenaHeading">
    <div class="row mb-1">
      <h2 id="arenaHeading" style="margin:0;">Arena</h2>
    </div>

    <div class="row mb-1">
      <label for="arenaDifficultySelect" style="min-width:90px;">Difficulty</label>
      <select id="arenaDifficultySelect" style="max-width:180px;">
        <option value="easy">Easy</option>
        <option value="medium" selected>Medium</option>
        <option value="hard">Hard</option>
      </select>
    </div>

    <div class="row mb-1">
      <div>Score: <span id="arenaScore">0</span></div>
      <div>High: <span id="arenaHighScore">0</span></div>
      <div>Time: <span id="arenaTimer">30</span>s</div>
    </div>

    <div id="arenaBoard" aria-label="Arena board">
      <button id="startArenaBtn" class="btn" style="position:absolute;top:50%;left:50%;transform:translate(-50%,-50%);">
        Start Arena
      </button>
    </div>
  </section>

  <!-- Duel (narrower) -->
  <section id="duelScreen" class="panel" aria-labelledby="duelHeading">
    <div class="row mb-1">
      <h2 id="duelHeading" style="margin:0;">Duel</h2>
    </div>

    <div class="mb-1">Gold: <span id="duelGoldDisplay">0</span></div>

    <div class="row mb-1" style="align-items:flex-end;">
      <div style="flex:1; min-width:160px;">
        <label for="duelWagerInput">Wager</label>
        <input id="duelWagerInput" type="number" min="1" placeholder="Gold amount..." />
      </div>
      <button id="startDuelBtn" class="btn">Start Duel</button>
    </div>

    <div id="duelCombatArea" style="display:none;">
      <div class="row center" style="justify-content:center;">
        <div><strong>Player HP:</strong> <span id="playerHP">99</span></div>
        <div><strong>Opponent HP:</strong> <span id="opponentHP">99</span></div>
      </div>
      <div id="duelLog" class="word-box" style="min-height:120px; text-align:left; font-size:.95rem;"></div>
      <div id="duelResult" class="center mt-1" style="font-weight:700;"></div>
    </div>

    <h3 class="mt-1">Match History</h3>
    <table style="width:100%; border-collapse:collapse; font-size:.95rem;">
      <thead>
        <tr style="border-bottom:1px solid #555;">
          <th style="text-align:left; padding:.4rem;">Result</th>
          <th style="text-align:left; padding:.4rem;">Wager</th>
          <th style="text-align:left; padding:.4rem;">Gold Change</th>
          <th style="text-align:left; padding:.4rem;">Rounds</th>
        </tr>
      </thead>
      <tbody id="duelHistoryTable"></tbody>
    </table>
  </section>

  <!-- Zen -->
  <section id="zenScreen" class="panel" aria-labelledby="zenHeading">
    <div class="row mb-1">
      <h2 id="zenHeading" style="margin:0;">Zen Mode</h2>
    </div>
    <div class="row center" style="justify-content:center;">
      <div>Words Completed: <span id="zenWordsCompleted">0</span></div>
      <div>Current Streak: <span id="zenStreak">0</span></div>
      <div>Best Streak: <span id="zenBestStreak">0</span></div>
    </div>
    <div id="zenWordBox" class="word-box" style="font-family: 'Courier Prime', monospace; line-height: 1.8; white-space: pre-wrap;"></div>
    <input id="zenInput" type="text" autocomplete="off" placeholder="Type here... (press Space to submit word)" />
  </section>

  <!-- Shop -->
  <section id="shopScreen" class="panel" aria-labelledby="shopHeading">
    <div class="row mb-1">
      <h2 id="shopHeading" style="margin:0;">Theme Shop</h2>
    </div>

    <div class="shop-section">
      <div id="themeCards" class="shop-grid"></div>
    </div>

    
  </section>

  <!-- Achievements -->
  <section id="achievementsScreen" class="panel" aria-labelledby="achievementsHeading">
    <div class="row mb-1">
      <h2 id="achievementsHeading" style="margin:0;">Achievements</h2>
    </div>
    
    <div id="achievementsContent">
      <div id="titleSelection">
        <h4>Select Title</h4>
        <div id="titleSelectionList"></div>
      </div>

      <div id="unlockedAchievements">
        <h3>üèÜ Unlocked Achievements</h3>
        <div id="unlockedList"></div>
      </div>
      
      <div id="lockedAchievements">
        <h3>üîí Locked Achievements</h3>
        <div id="lockedList"></div>
      </div>
    </div>
  </section>

  <!-- Options -->
  <section id="optionsScreen" class="panel" aria-labelledby="optionsHeading">
    <div class="row mb-1">
      <h2 id="optionsHeading" style="margin:0;">Settings</h2>
    </div>

    <div style="max-width: 500px; margin: 0 auto;">
      <label for="headingFontSelect">Heading Font</label>
      <select id="headingFontSelect">
        <option value="'Uncial Antiqua', serif">Uncial Antiqua</option>
        <option value="'Playfair Display', serif">Playfair Display</option>
        <option value="'Merriweather', serif">Merriweather</option>
        <option value="'Cinzel', serif">Cinzel</option>
        <option value="'Lobster', cursive">Lobster</option>
        <option value="Georgia, serif">Georgia</option>
        <option value="'Times New Roman', serif">Times New Roman</option>
      </select>

      <label for="mainFontSelect">UI Font</label>
      <select id="mainFontSelect">
        <option value="Roboto, Arial, sans-serif">Roboto</option>
        <option value="'Inter', Arial, sans-serif">Inter</option>
        <option value="'Lato', Arial, sans-serif">Lato</option>
        <option value="'Montserrat', Arial, sans-serif">Montserrat</option>
        <option value="'Courier Prime', monospace">Courier Prime</option>
        <option value="Arial, sans-serif">Arial</option>
      </select>

      <label for="uiScaleRange">UI Scale</label>
      <input id="uiScaleRange" type="range" min="0.8" max="1.5" step="0.1" value="1" />

      <label for="fontSizeRange">Font Size</label>
      <input id="fontSizeRange" type="range" min="0.9" max="1.6" step="0.05" value="1" />

      <label><input type="checkbox" id="musicEnabled"> Background Music</label>
      <label for="musicVolume">Music Volume</label>
      <input id="musicVolume" type="range" min="0" max="1" step="0.01" />

      <div class="row mt-1" style="justify-content:space-between;">
        <button id="resetProfileBtn" class="btn btn-ghost" style="color: var(--accent-incorrect);">Reset Profile</button>
        <button id="saveSettingsBtn" class="btn">Save</button>
      </div>
    </div>
  </section>



  <canvas id="particleCanvas"></canvas>

  <script>
    // Storage keys (v3)
    const STORAGE_KEYS = { profile: 'rt_profile_v3', settings: 'rt_settings_v3' };

    // Profile management
    let currentProfileName = '';
    
    function createProfile(name) {
      try {
        if (!name || name.trim().length === 0) {
          alert('Please enter a profile name');
          return false;
        }
        
        const profileName = name.trim();
        
        // Create new profile with default data
        const newProfile = structuredClone(defaultProfile);
        newProfile.name = profileName;
        newProfile.createdAt = Date.now();
        newProfile.lastPlayed = Date.now();
        
        // Save as the single profile
        profile = newProfile;
        saveProfile();
        
        // Start background music for new profile
        startBackgroundMusic();
        
        // Check for achievements when profile is created
        checkAchievements();
        
        return true;
      } catch (error) {
        console.error('Error creating profile:', error);
        alert('Failed to create profile. Please try again.');
        return false;
      }
    }
    

    
    function resetProfile() {
      if (confirm('Are you sure you want to reset your profile? This will delete all progress and cannot be undone.')) {
        // Clear the profile completely
        profile = null;
        localStorage.removeItem(STORAGE_KEYS.profile);
        
        // Return to startup screen to create new profile
        showScreen('startup');
        renderStartupScreen();
        
        return true;
      }
      return false;
    }
    
    function updateProfileDisplay() {
      const profileNameElem = document.getElementById('profileNameDisplay');
      if (profileNameElem) {
        const currentTitle = getCurrentTitle();
        const displayName = profile && profile.name ? profile.name : 'Adventurer';
        
        if (currentTitle) {
          profileNameElem.textContent = `${currentTitle} ${displayName}`;
        } else {
          profileNameElem.textContent = displayName;
        }
      }
    }
    
    function renderStartupScreen() {
      // Startup screen only shows when no profile exists
      // This function is kept for consistency but doesn't need complex logic
    }

    // Default profile: you will add words manually later
    const defaultProfile = {
      gold: 0,
      skills: {
        fishing:   { name: 'Fishing',   level: 1, currentXP: 0, nextLevelXP: 83,  words: ["angler","bait","tackle","lure","hook","rod","line","net","reel","fly","swivel","float","sinker","bobber","jig","minnow","trout","salmon","bass","perch","catfish","crappie","walleye","pike","sardine","mackerel","halibut","tuna","eel","swordfish","marlin","shad","smelt","herring","anchovy","sprat","anglerfish","crab","shrimp","lobster","clam","oyster","mussel","scallop","crawfish","fisher","fishing","fisherman","flyfishing","icefishing","deepsea","shoreline","bank","stream","river","lake","pond","ocean","bay","estuary","harbor","dock","pier","boathouse","skiff","canoe","kayak","yacht","sailboat","boat","seine","trawl","cruise","wader","waders","artificial","baitcasting","spinning","drift","casting","wind","current","eddy","swim","dive","buoy","floatation","submerge","surface","rip","tide","tidal","surf","breakwater","flotsam","jetsam","splash","gill","scales","fin","dorsal","lateral","aquatic","marine","freshwater","saltwater","brackish","fishingpole","fishingrod","fishingline","fishingnet","flylure","streamer","swimmer","baitworm","nightfishing","dusk","dawn","anglergear","baitbucket","tacklebox","rodholder","fishfinder","sonar","echo","rangefinder","depthfinder","hookset","strike","run","fight","anglerknot","bowline","chum","dredge","netting","fishtrap","weir","eeltrap","spinnerbait","crankbait","softbait","jighead","swimbait","sinkerweight","gaff","landingnet","cast","hatch","spawn","bluefish","snapper","grouper","barracuda","skipjack","yellowtail","cod","pollock","flounder","sole","carp","gar","sturgeon","drum","whitefish","tilapia","pickerel","bream","tarpon","mullet","pompano","sheepshead","bonito","dolphin","mahi","scup","triggerfish","cobia","kingfish","tilefish","lingcod","rockfish","steelhead","sunfish","paddlefish","needlefish","seabass","lamprey","hagfish","whitebait","seahorse","barnacle","krill","seaweed","kelp","algae","coral","reef","shoal","depth","offshore","inshore","shipwreck","catch","release","keeper","limit","license","permit","season","quota","spawnpoint","hotspot","feeding","migration","school","baitfish","microfishing","spearfishing","harpoon","gigging","bucket","cooler","icebox","baitshop","fishmarket","processing","fillet","gutting","cleaning","scaler","sharpener","pliers","knife","multitool","splitshot","downrigger","outrigger","leader","braid","monofilament","fluorocarbon","drag","retrieve","action","fastaction","slowaction","tip","butt","grip","handle","guides","eyelet","spool","clicker","ratchet","lubricant","maintenance","inspection","repair","storage","transport","drydock","marina","moor","anchor","driftwood","vegetation","currentflow","navigation","compass","chartplotter","waypoint","bearing","position","coordinates","latitude","longitude","castnet","handline","longline","jigger","trolling","popping","skimming","baitball","surfacefeed","riptide","slackwater","ebb","floodtide","springtide","neaptide","tidetable","fishery","stock","population","ecosystem","conservation"] },
        smithing:  { name: 'Smithing',  level: 1, currentXP: 0, nextLevelXP: 83,  words: ["anvil","hammer","forge","metal","steel","iron","copper","bronze","alloy","furnace","smelt","temper","quench","cast","mold","ingot","bellows","tongs","rivet","weld","solder","slag","bloomery","billet","workbench","fire","heat","scorch","anneal","carburize","tempering","smithy","blacksmith","metalsmith","mallet","chisel","file","grindstone","quenching","smiting","flint","crucible","casting","foundry","coldwork","hotwork","taper","shrink","forgefire","pattern","hammerfall","metalcut","shear","roll","press","stoke","ore","extraction","refining","carburization","quenchpot","billeting","swage","die","presswork","emboss","engraving","chiseling","temperer","alloying","metallurgist","forgehammer","dropforge","refiners","slagheaps","refractory","cruciform","remelt","reforge","patternweld","edge","blade","graver","incise","spur","temperproof","furnacefire","flux","smelter","carbonize","carburizer","quenchbox","billetroll","shearer","split","slagline","copperplate","brass","tin","zinc","lead","steelplate","ferrous","nonferrous","forgingpress","hammerstruck","anviling","temperingoven","cruciblepot","metalcasting","glowing","redhot","whitehot","cooled","metalshaping","diecasting","patterncasting","moldmaking","smeltpot","ironworks","steelworks","caster","rollingmill","stamper","heavyiron","ironclad","metalloid","refinery","gasforge","arcweld","plasma","oxyacetylene","gritblasting","sandblasting","pickling","galvanize","electroplate","nickelplate","silversmith","goldsmith","patternforge","heattreat","hot","rolling","cold","cutting","tool","pigiron","carbonsteel","toolsteel","sheetmetal","plate","wire","rodbender","hardening","folding","forgeweld","coldforging","hotforging","metalworker","machinist","finisher","hammering","drawplate","extrusion","coppersmith","aluminum","titanium","nickel","chromium","vanadium","manganese","silicon","boron","tinplate","peening","shotblast","buffing","polishing","grinder","millscale","blackoxide","surfaceprep","patternmaker","dross","ladle","slagpot","reheat","cupola","induction","kiln","fuel","charcoal","coke","blastfurnace","heatproof","temperline","harden","soak","retemper","ironore","metalblank","smithingtools","stock","scrollwork","ornament","damascus","fuller","hardface","casehardening","malleable","ductile","tenacity","impact","forgecraft","hammeranvil","metalpress","steelmaker","forgemaster","riveting","spotweld","forgework","chiselform","upset","draw","crosspeen","ballpeen","raising","planishing","driftpin","swaging","hotcut","coldchisel","snips","nipper","ironmongery","hinge","hasp","latch","locksmith","broach","treadle","flypress","gearwheel","turning","lathe","stockbar","smithtools","clinker","carbonization","powdercoat","bluing","hammerblow","wroughtiron","temperedsteel","smeltery","finishing","sparktest","bender","metalart","craftmetal","ironworker","hammerstrike","ironfoundry","scale","slagremoval","flash","deburr","molding","rollform","smithcraft","metalforming","steelsmith","ironsmith","scrapmetal","metalfab","grindwheel","hotstamp","hotmetal","smithhammer","metaljoin","rivetset","rivethammer","forgeoven","smithfire","hotblast","forgeheat","striker","hammerhandle","hardness","rockwell","brinell","tensile","yieldstrength"] },
        crafting:  { name: 'Crafting',  level: 1, currentXP: 0, nextLevelXP: 83,  words: ["sew","weave","stitch","carve","sculpt","lace","pattern","embroider","design","craft","create","assemble","build","construct","fabricate","artisan","tailor","knit","crochet","mending","repairing","dye","color","print","stamp","chisel","mold","cast","shape","form","model","sculpting","engraving","inlay","mosaic","pottery","ceramics","glazing","drawing","painting","sketch","brushstroke","collage","decoupage","papercraft","origami","quilling","scrapbooking","beading","jewelry","wiring","soldering","woodworking","carpentry","lathe","turning","whittling","sewing","handmade","creation","patterning","designwork","textile","fabric","thread","yarn","loom","weaving","batting","felting","dyeing","quilting","tapestry","embroidery","applique","stenciling","printing","calligraphy","collagework","marquetry","intarsia","mosaicing","paperfolding","origamic","craftwork","modelmaking","diorama","beadwork","wirework","claycraft","sculptingclay","modeling","polymerclay","papiermache","craftshop","kit","handmadecraft","artifice","ingenuity","embellish","craftiness","gluegun","hotglue","needlework","fabricating","upcycle","repurpose","refurbish","tailormade","couture","patchwork","mosaictile","frame","woodburning","pyrography","stenciled","crafted","formwork","beadstring","embroideryhoop","yarnball","craftsperson","artisanry","handiwork","creative","manual","craftsman","craftswoman","inventiveness","innovation","resourceful","improvise","customize","designmaker","hobbyist","workshop","sketching","blueprint","prototype","modelcraft","artful","embellishment","fabrication","assembly","configuration","ornamentation","makerspace","cutout","paperclip","bookmark","garland","sticker","stencil","woodcarving","woodcraft","hammering","joinery","fastening","folding","papier","binding","bookbinding","stationery","cardmaking","stampcraft","inkpad","decorating","paintingbrush","palette","watercolor","acrylic","oilpaint","canvass","easel","scissors","measuring","tape","ruler","tracing","templates","sequins","sparkle","glitter","pompon","ribbon","cord","braiding","macrame","scrapbook","glue","adhesive","fastener","binder","button","snap","clasp","hookandeye","pincushion","straightpin","safetyclip","seamripper","thimble","bobbin","spindle","spinner","spinningwheel","basketweave","basketry","papercutting","silkscreen","screenprint","serigraphy","toolbox","measuringtape","cuttingmat","rotarycutter","craftknife","exactoknife","utilityknife","papertrimmer","holepunch","reinforce","laminate","varnish","sealant","finishing","polish","paintbrush","craftpaper","constructionpaper","feltcraft","feltwork","cardboard","chipboard","foamboard","craftfoam","crepepaper","tissuepaper","papermaking","papierwork","handcrafting","beadloom","seedbead","pendant","earring","bracelet","necklace","locket","cameo","brooch","wirewrap","resin","castingresin","epoxy","woodstain","woodvarnish","veneer","veneerwork","scrollsaw","jigsaw","sanding","finisher","riveting","riveter","clothespin","clips","diecut","perforate","miter","joiner","craftboard","woodglue","gluestick","crafttool","binderclip","woodgrain","carvingknife","craftkit","craftstudio","handicraft","creativework"] },
        cooking:   { name: 'Cooking',   level: 1, currentXP: 0, nextLevelXP: 83,  words: ["boil","simmer","fry","roast","bake","grill","steam","poach","braise","sear","stew","broil","melt","whisk","stir","mix","blend","chop","dice","slice","julienne","mince","grind","puree","emulsify","season","spice","salt","pepper","garnish","marinate","brine","baste","glaze","caramelize","deglaze","flambe","toast","boilover","simmering","sauteing","frying","baking","steaming","broiling","poaching","grilling","roasting","cooking","foodprep","recipe","cuisine","culinary","chef","kitchen","pan","pot","skillet","saucepan","wok","griddle","oven","microwave","blender","foodprocessor","mixer","cutter","peeler","zester","mandoline","colander","strainer","sieve","spatula","ladle","tongs","rollingpin","choppingboard","cuttingboard","knife","cleaver","paring","grater","steamer","roaster","pressurecooker","slowcooker","crockpot","sousvide","bastingbrush","measuringcup","measuringspoon","foodscale","timer","recipebook","cookbook","ingredients","produce","vegetable","fruit","meat","poultry","fish","seafood","grain","pasta","rice","dough","batter","sauce","soup","stewpot","broth","stock","reduction","herb","basil","oregano","thyme","rosemary","sage","dill","cilantro","parsley","mint","bayleaf","chili","curry","cumin","paprika","garlic","onion","shallot","ginger","lemon","lime","vinegar","oil","butter","cream","cheese","egg","sugar","chocolate","caramel","molasses","knead","proof","riseknead","ferment","yeast","leaven","sourdough","bread","pastry","cake","muffin","cookie","custard","pudding","jam","jelly","preserve","pickling","fermentation","can","jar","bottle","airtight","vacuumseal","frost","icing","confection","biscuit","roll","bagel","pancake","waffle","omelette","scramble","hardboil","softboil","sunnyside","overeasy","scrambled","fried","charbroil","smoke","smoker","charcoal","propane","gasgrill","electricoven","induction","ceramic","nonstick","castiron","aluminumfoil","parchment","waxpaper","bamboo","skewer","kebab","rotisserie","sizzle","drizzle","sprinkle","dash","pinch","rub","dryrub","breadcrumb","stuffing","filling","layer","stack","spread","layered","coat","breaded","crumb","crust","flavor","taste","aroma","savory","sweet","bitter","tangy","zesty","spicy","hot","mild","raw","rare","mediumrare","medium","welldone","plating","presentation","serve","portion","batch","familymeal","dinner","lunch","breakfast","brunch","buffet","appetizer","entree","dessert","side","beverage","drink","tea","coffee","juice","smoothie","shake","whip","creamwhip","froth","foam","infuse","steep","extract","essence","broiler","toaster","freezer","fridge","refrigerate","cool","warm","roomtemp","preheat","casserole","tray","sheetpan","rack","bakingdish","souffle","bainmarie","doubleboiler","temper","custardbase","ganache","truffle","fondant","battermix","doughball","pizzadough","flatbread","wrap","tortilla","dip","spreadable","condiment","ketchup","mustard","mayonnaise","aioli","vinaigrette","dressing","toss","marinade","stockpot","boiling","scald","blanch","shuck","peel","core","seed","pit","skin","debone","fillet","sliceable","chunk","cube","wedges","segments","julienning","crudite","tart","savorypie","sweetpie","shortcrust","flakycrust","buttery","broiled"] },
        prayer:    { name: 'Prayer',    level: 1, currentXP: 0, nextLevelXP: 83,  words: ["altar","blessing","prayer","ritual","divine","sacred","meditate","worship","chant","hymn","psalm","sermon","devotion","sacredness","sanctify","reverence","supplicate","penance","absolution","communion","incense","offering","oblation","liturgy","mass","scripture","gospel","faith","belief","spirit","soul","oracle","prophet","saint","martyr","angel","cherub","seraph","holy","grace","salvation","redemption","miracle","confession","atonement","repentance","invocation","benediction","consecration","exorcism","fasting","vigil","supplication","anointing","sanctuary","shrine","temple","chapel","cathedral","monastery","abbey","cloister","parish","priest","pastor","minister","cleric","bishop","cardinal","pope","congregation","fellowship","creed","doctrine","litany","orison","meditation","reflection","quietude","stillness","gracefulness","divineword","testament","revelation","prophecy","vision","sanctum","adoration","exaltation","humility","submission","worshipper","pilgrim","pilgrimage","celestial","eternity","infinite","omnipotent","omniscient","providence","miracleworker","sanctifier","redeemer","mediator","intercession","absolver","penitent","contrition","spiritguide","solace","comfort","refuge","divinewill","divineplan","heavenly","seraphic","beatitude","rapture","devotionary","recitation","recite","proclaim","homily","sanctity","purity","worshipfulness","solemnity","unity","oneness","mystery","awe","veneration","oratory","meditative","quiet","still","surrender","pacification","intercede","spiritualize","unison","faithful","piety","virtue","enlighten","illumination","guidance","enlightenment","sacrifice","sacrament","spirituality","sacral","celibacy","clergy","laity","ascetic","asceticism","savior","godliness","dogma","canon","orthodox","monk","nun","friar","sisterhood","brotherhood","order","ordination","missionary","evangelist","catechism","catechist","pilgrimagepath","relic","talisman","amulet","icon","idol","totem","reliquary","myth","mysticism","esoteric","gnostic","karma","dharma","nirvana","samadhi","zen","mantra","affirmation","tranquil","repose","contemplation","awakening","satori","transcendence","awakenspirit","innerpeace","chakras","aura","intuition","clairvoyance","clairaudience","telepathy","channeling","medium","afterlife","immortality","rebirth","reincarnation","incarnation","resurrection","apocalypse","judgment","paradise","eden","heaven","nirvanic","transcendent","ethereal","supernatural","metaphysical","cosmic","cosmos","universe","creator","divinity","deity","godhead","supreme","holyland","promisedland","blessedness","hallowed","godly","godliness","archangel","guardian","purify","cleansing","spiritualist","ritualistic","sanctification","beatific","benevolence","magnificence","ineffable","holyspirit","scriptural","faithfulness","steadfast","penitence","mortification","discipline","illumined","seeker","truth","light","prana","qi","chi","lifeenergy","energize","sanctified","universal","cosmology","theology","theologian","spiritualhealing","energywork","holistic","metaphysics","numinous","bless","transfiguration","spiritualjourney","innerguidance","mystic","seer","enlightened","allegory","parable","hermitage","anchorite","guru","master","teacher","disciple","devotee","sanctumspace","tranquility","centeredness","heartfulness","mindfulness","unconditionallove","forgiveness","compassion","mercy","divinepresence","devout","transpersonal","superconsciousness","awareness","realization","soulful"] },
        woodcutting:{name: 'Woodcutting', level: 1, currentXP: 0, nextLevelXP: 83, words: ["oak","pine","maple","birch","cedar","spruce","fir","elm","walnut","cherry","poplar","ash","redwood","sequoia","timber","lumber","log","branch","trunk","bark","sapling","stump","coppice","thicket","grove","forest","woodland","clearing","fell","harvest","cut","chop","saw","chainsaw","axe","hatchet","cleaver","splitting","chopper","limb","bough","sap","resin","veneer","plank","board","timberland","logjam","mulch","chipping","debark","notching","sawdust","woodchip","felling","pruner","brushcut","lumberjack","deforestation","reforestation","woodlot","sawmill","woodwork","carpentry","joinery","millwork","barkscraper","sliver","knot","grain","texture","ring","cambium","crosscut","ripcut","dovetail","chisel","lathe","sanding","planing","shavings","sawblade","forestry","arborist","woodsman","logger","logging","treefall","brushfire","seedling","sprout","sapwood","heartwood","deciduous","evergreen","softwood","hardwood","plywood","particleboard","lumberyard","mill","branchlet","twigs","leafage","canopy","understory","sylvan","glade","stand","coppicing","pruning","trimming","feller","lopper","scythe","mower","brushcutter","ream","chink","woodwind","sawyer","buck","skidder","pile","logbook","timbersaw","woodchipper","borer","barkmill","woodcutter","logsplitter","tree","seed","lath","veneerboard","lumbering","chipboard","roughcut","dovetailing","woodturning","planer","shingle","barkstrip","timberframe","riftsawn","flitch","sawbuck","boardfoot","veneercraft","alder","beech","hickory","sycamore","basswood","dogwood","hemlock","juniper","yew","willow","teak","mahogany","balsa","ebony","rosewood","acacia","butternut","gumtree","hornbeam","ironwood","mulberry","tamarack","arbor","arboretum","backcut","basecut","billet","bole","bucking","cant","clearcut","cordwood","deadwood","dryrot","fellingaxe","forester","greenwood","handsaw","kerf","kindling","loggingcamp","loggingroad","lumbermill","mast","pith","polewood","pullsaw","quartercut","roundwood","scaling","seasoning","silviculture","slashpile","snag","snedding","spalting","springwood","summerwood","winterwood","timbercut","topwood","treeline","whorl","widowmaker","windthrow","woodblock","woodfuel","woodpile","woodsplitter","woodstack","xylem","buckingsaw","crossgrain","dimensionlumber","firewood","framing","hardhat","headrig","heartrot","incrementborer","landing","loggingtruck","pulpwood","railcut","resaw","saprot","slash","stave","trimmer","undercut","veneerlog","woodfiber","woodfueling","woodhewer","woodshed","woodstacker","forestland","cutblock","harvester","forwarder","silvopasture","crown","toppling","delimb","destumping","forestation","replant","nursery","seedtree","canthook","pickaroon","peavey","timberjack","logroller","brushpile","brushwood","timberstand","logdeck","timbermark","markingaxe","treefelling","timberfall","rootball","rootcut","thinning","shelterwood","evenaged","unevenaged","highgrading","logscale","logyard","timberhaul","woodhandling","wooddrying","kilndry","woodpreserve","logchain","skidding","woodsplit","stumpage","cutover","clearfelling","stripcut","groupselection","woodlotowner","timberowner","logbuyer","forestrymanagement"] },
        combat:    { name: 'Combat',    level: 1, currentXP: 0, nextLevelXP: 83,  words: ["sword","shield","dagger","lance","bow","arrow","spear","halberd","axe","mace","flail","rapier","scimitar","broadsword","cutlass","sabre","claymore","longsword","shortsword","polearm","pike","trident","warhammer","maul","gladius","katana","scythe","falchion","kukri","tomahawk","warclub","morningstar","battleaxe","handaxe","stiletto","blade","edge","guard","parry","riposte","feint","block","thrust","swing","strike","slash","lunge","cleave","chop","hack","stab","duel","skirmish","brawl","combat","clash","spar","engagement","encounter","assault","ambush","counter","offense","defense","tactic","maneuver","strategy","charge","retreat","flank","formation","battalion","legion","warrior","soldier","knight","mercenary","gladiator","veteran","fighter","combatant","pugilist","boxer","duelist","champion","hero","adversary","rival","skirmisher","lancer","archer","crossbowman","bolt","quiver","projectile","sling","ballista","catapult","siege","barracks","arsenal","armory","weaponry","bladework","sparring","grappling","clinch","submission","knockout","parrying","counterattack","headbutt","uppercut","hook","jab","barrage","blitz","onslaught","rampage","bloodlust","fury","adrenaline","aggression","warfare","battleground","warcry","rally","ambuscade","incursion","siegecraft","stratagem","offensive","defensive","warpath","rallying","breakthrough","counterstrike","conflict","hostilities","combativeness","valor","honor","discipline","tactical","unity","fortitude","resilience","endurance","triumph","victory","gauntlet","greaves","helm","cuirass","pauldron","vambrace","buckler","chainmail","platemail","armor","armored","brigandine","gambeson","tabard","battlefield","casualty","infantry","cavalry","archery","ballistics","reinforcement","siegeengine","artillery","sortie","foray","campaign","invasion","raid","loot","plunder","spoils","booty","lootable","banner","standard","command","marshal","general","captain","sergeant","rank","insignia","salute","disciplinary","frontline","rearward","vanguard","rearguard","phalanx","shieldwall","column","advance","withdrawal","deployment","flanking","maneuvering","outflank","overrun","encircle","siegebreaker","batteringram","fortification","stronghold","bastion","fortress","castle","citadel","barricade","bulwark","palisade","watchtower","garrison","patrol","scout","sentry","lookout","espionage","spy","intelligence","recon","guerrilla","commando","partisan","insurgent","resistance","militia","regiment","brigade","corps","force","contingent","unit","platoon","squad","fireteam","assassin","saboteur","operative","operative","covert","operative","stealth","stealthy","camouflage","concealment","cover","decoy","diversion","falseflag","attrition","stalemate","deadlock","armistice","ceasefire","truce","treaty","surrender","capitulate","yield","submissionhold","grapple","lock","hold","pin","strikeforce","taskforce","coalition","ally","enemy","hostile","belligerent","combatzone","hotzone","neutralize","subdue","overpower","conquer","vanquish","defeat","dominate","commandpost","fieldcommand","chainofcommand","briefing","debriefing","objective","mission","operation","deploymentzone","hotspot","incident","skirmishline","firefight","engage","suppression","coverfire","retaliation","reprisal","countermeasure","counteroffensive","regroup","redeploy","reinforce","countermaneuver","feignedretreat","falsecharge","probingattack","tacticalwithdrawal","tacticaladvance","preemptivestrike","shocktroops","stormtrooper","siegetower"] },
        construction:{name: 'Construction', level:1, currentXP:0, nextLevelXP:83, words: ["brick","cement","mortar","beam","column","pillar","foundation","structure","framework","scaffolding","arch","lintel","joist","rafter","truss","girder","slab","concrete","paving","masonry","drywall","plaster","stucco","tile","roofing","shingle","siding","insulation","window","door","header","facade","portico","cornice","eave","soffit","fascia","flashing","gutter","downspout","pipe","plumbing","wiring","conduit","electrical","circuit","breaker","switch","outlet","junction","stud","framing","lumber","woodwork","rebar","steel","beamline","trusswork","scaffolder","contractor","blueprint","plan","design","drafting","architect","survey","excavation","grading","earthwork","backfill","compaction","footing","pile","underpinning","retaining","wall","partition","ceiling","floor","subfloor","vent","duct","HVAC","sealant","adhesive","fastener","nail","screw","bolt","anchor","bracket","scaffold","crane","hoist","derrick","elevator","forklift","bulldozer","excavator","backhoe","grader","loader","skidder","mixer","pump","formwork","shoring","temporary","permanent","renovation","remodeling","demolition","building","edifice","superstructure","substructure","reinforcement","composite","cantilever","overhang","expansion","joint","seal","waterproofing","soundproofing","lighting","fixture","finish","coating","paint","primer","texture","veneer","cladding","thermal","barrier","buttress","keystone","capstone","lintelguard","partitioning","concreting","blockwork","brickwork","retiling","shoringwork","formlining","sitework","construct","aggregate","batching","binder","bitumen","blueprinter","bulkhead","caulking","chimney","culvert","curbing","dampproofing","drainage","embankment","facadework","fill","foundationwall","gradebeam","handrail","hardscape","joisthanger","ledger","mullion","newel","parapet","pilaster","post","purlin","rise","run","sash","sill","soffitvent","spandrel","staircase","stairwell","stringer","threshold","tiebeam","tread","underlayment","weep","wingwall","yarddrain","zoning","permit","inspection","code","specification","submittal","bid","estimate","proposal","contract","budget","schedule","timeline","milestone","logistics","mobilization","demobilization","siteplan","footprint","topography","landscape","landscaping","streetscape","utility","trenching","borehole","foundationdrain","drainpipe","sump","tank","cesspool","septic","gravel","sand","fillmaterial","surcharge","settlement","bearing","geotechnical","testing","structural","analysis","engineering","civil","engineer","contracting","project","manager","foreman","crew","laborer","journeyman","apprentice","fabrication","prefabricate","modular","erection","install","installation","assembly","precast","castinplace","panel","decking","sheathe","rigging","lift","transport","haulage","loadingdock","access","scissorlift","boomlift","platform","personnel","siteoffice","toolbox","hardhat","PPE","safety","harness","lanyard","barricade","warning","signage","inspectionreport","deficiency","punchlist","closeout","turnover","occupancy","certificate","commissioning","warranty","maintenance","operation","handover","ownership","developer","client","stakeholder","consultant","coordination","communications","logbook","dailyreport","progress","fieldwork","onsite","offsite","supplychain","vendor","supplier","materiallist","procurement","storage","inventory","deliverable","documentation","drawings","revision","asbuilt","turnkey","sitecleanup","restoration","completion"] },
        farming:   { name: 'Farming',   level: 1, currentXP: 0, nextLevelXP: 83,  words: ["plow","till","sow","plant","seed","harvest","reap","cultivate","farm","field","crop","acreage","barn","silo","tractor","combine","irrigation","water","drip","sprinkler","fertilizer","manure","compost","organic","soil","loam","earth","tillage","rotation","fallow","covercrop","pasture","grazing","livestock","cattle","sheep","goat","pig","poultry","chicken","duck","turkey","bee","apiary","orchard","vineyard","greenhouse","nursery","hedgerow","canal","waterway","drainage","mulch","weed","weeding","pruning","trimming","grafting","propagation","seedling","sprout","bud","bloom","blossom","yield","produce","reaping","thresh","winnow","harvester","baler","siloing","grain","wheat","barley","rye","oats","corn","maize","soybean","legume","pulse","vegetable","fruit","farmstead","homestead","agronomy","agriculture","husbandry","cultivation","fertilization","plowing","harrow","disc","cultivator","seeder","planter","sprayer","pesticide","herbicide","fungicide","sustainable","permaculture","biodynamic","agribusiness","market","fieldwork","rural","barnyard","dairy","milking","fodder","hay","straw","silage","manurepile","aquaculture","hydroponics","cropyield","soilscience","replanting","seedbank","botany","weedkiller","cropdusting","fieldcrop","arable","horticulture","pastureland","irrigationcanal","fieldtrial","agroforestry","biomass","grainmill","farmhand","ploughman","orchardist","vineyardist","silviculture","greenmanure","agronomylab","soiltest","landrace","agrochemical","agrotechnology","harvesttime","rootstock","trellis","vine","rowcrop","transplant","bed","seeddrill","broadcast","furrow","windbreak","cropinsurance","subsidy","extension","countyagent","landmanagement","topsoil","subsoil","amendment","soilhealth","pollinator","beneficial","cover","cropcover","grassland","meadow","hayfield","balestack","shearing","livestockfeed","feeder","stockyard","cowshed","goatshed","pigshed","chickencoop","duckpond","beehive","honeycomb","queenbee","beekeeper","harvestfestival","farmersmarket","localproduce","freshpicked","seasonal","farmgate","roadside","upick","pickyourown","agritourism","countryside","agrarian","ranch","rancher","stockman","cowherd","shepherd","goatherd","swineherd","pastoral","forage","grazeland","range","croprotation","intercrop","monoculture","polyculture","companionplant","weedcontrol","integrated","pestcontrol","fertigation","cropmonitoring","scarecrow","soilmoisture","watershed","levee","reservoir","catchment","cistern","watering","floodirrigation","fertility","cropmanagement","precisionfarming","dronefarming","satellite","yieldmapping","soilsampling","agroecology","carbonfarming","soilcarbon","covercropping","seedstorage","germination","hybridseed","heirloom","pollination","cropbreeding","hybridization","crossbreeding","seedcatalog","rootcrop","leafcrop","fruittree","nutorchard","nutcrop","rootvegetable","berryfarm","vinecrop","melonpatch","pumpkinpatch","sweetcorn","greens","tuber","potato","carrot","lettuce","spinach","cabbage","tomato","cucumber","pepper","onionfield","garlicbed","herbgarden","orcharding","cropdust","cultivated","haymaking","foddercrop","livestockauction","stockbreeding","lambing","calving","farmlabor","farmer","farmworker","barnraising","stable","granary","rootcellar","grainstorage","stackyard","feedingtrough","watertrough","pasturerotation","farmmachinery","cultivatedland"] },
        magic:     { name: 'Magic',     level: 1, currentXP: 0, nextLevelXP: 83,  words: ["spell","charm","incantation","enchantment","sorcery","wizardry","arcane","mystic","occult","potion","elixir","brew","hex","curse","amulet","talisman","rune","glyph","sigil","invocation","conjuration","ritual","mysticism","divination","prophecy","clairvoyance","alchemy","transmutation","transformation","illusion","apparition","spectral","phantom","wizard","sorcerer","mage","warlock","enchanter","necromancer","seer","oracle","diviner","medium","crystal","ball","wand","staff","grimoire","tome","incant","charmcraft","spellbound","bewitch","conjure","summon","familiar","spirit","elemental","energy","aura","leyline","portal","dimension","astral","ether","void","shadow","light","darkness","flame","frost","lightning","storm","wind","water","earth","nature","cosmic","celestial","divine","occultism","ritualistic","sigilcraft","spellcraft","enchant","mystify","charmspell","bewitched","omen","augury","portent","prognostication","seerhood","astrology","horoscope","magnetism","witchcraft","wizardcraft","runecasting","alchemist","philter","mystifier","numinous","occultation","entranced","witchery","seeress","magician","spellbinder","hexcraft","coven","incantatory","magi","necromancy","elementalism","fireball","iceshard","lightningbolt","windgust","earthquake","watersurge","aether","astralprojection","scrying","claircognizance","sigilize","charmcaster","magister","wizardlike","enchantress","magocracy","spiritweaver","etheric","stardust","runecaster","arcanist","spellcasting","magicka","enchanting","spellwork","mystical","thaumaturgy","telekinesis","telepathy","pyromancy","cryomancy","geomancy","hydromancy","aeromancy","electromancy","chronomancy","illusionist","phasing","shapeshifting","polymorph","teleport","blink","portalmancy","ward","barrier","protection","shieldspell","abjuration","evocation","necrotic","lifedrain","mana","essence","etherial","manaflow","manafont","channeling","spellchannel","ritualcircle","magicscroll","incanting","spellformula","runescript","glyphcraft","spellweaving","invoker","summoner","soulbind","soullink","hexer","cursecraft","hexagram","pentagram","ritualist","chanter","conjurer","mirage","phantasmal","eidolon","specter","wraith","ghoul","revenant","apparitioncraft","dreamweaver","spellbook","spellpage","codex","grimoirekeeper","spellsmith","spellforge","magiccircle","mysticarts","arcana","wizardstaff","witchesbrew","manaorb","manaflow","focustone","spellfoci","manaweave","manafount","magicsource","energyfield","spellenergy","spellforce","witchdoctor","shaman","voodoo","hoodoo","hexbag","charmbag","witchmark","hexsign","warding","protectionspell","dispell","disenchant","counterspell","spellbreaking","etherium","eldritch","ancientmagic","bloodmagic","darkmagic","lightmagic","sanctifiedmagic","chaosmagic","order","balance","harmony","magical","mysticismcraft","spellblade","enchanted","magicwand","crystalball","oraclevision","visionspell","dreamseer","astralmagic","planar","voidmagic","shadowmagic","lightweaver","faemagic","druidcraft","spellgem","magicrune","wardstone","invocationcircle","ritualknife","athame","boline","spellritual","ritualbook","charmmaker","spellmaker","etherbound","spiritcall","spectralform","mysticrealm","otherworld","netherrealm","planeshift","dreamwalk","soulmagic","spellcast","wizardtower","witchhut","magespire","ritualaltar","spellcomponent","spellpouch","arcaneenergy","spellcrafting","mysticpower","spellseal","mageseal","mystictome","arcanearts","mysticforce"] }
      },
      stats: { 
        totalSetsCompleted: 0, 
        totalWPMAccumulated: 0,
        perfectLinesCompleted: 0,
        maxComboAchieved: 0
      },
      raid: { highScore: 0 },
      arena: { highScores: { easy: 0, medium: 0, hard: 0 } },
      duel: { history: [] },
      zen: { wordsCompleted: 0, bestStreak: 0 },
      shop: {
        purchasedThemes: ['themeDarkSteel'],
        activeTheme: 'themeDarkSteel',
      },
      achievements: {
        unlocked: [],
        titles: [],
        selectedTitle: null
      }
    };

    // Achievement definitions
    const achievements = {
      // === GENERAL ACHIEVEMENTS ===
      firstWords: {
        id: 'firstWords',
        name: 'First Steps',
        description: 'Complete your first set of words',
        title: 'Novice',
        condition: (profile) => profile.stats.totalSetsCompleted >= 1,
        category: 'general'
      },
      wordCollector: {
        id: 'wordCollector',
        name: 'Word Collector',
        description: 'Complete 10 sets of words',
        title: 'Collector',
        condition: (profile) => profile.stats.totalSetsCompleted >= 10,
        category: 'general'
      },
      wordMaster: {
        id: 'wordMaster',
        name: 'Word Master',
        description: 'Complete 50 sets of words',
        title: 'Word Master',
        condition: (profile) => profile.stats.totalSetsCompleted >= 50,
        category: 'general'
      },
      wordLegend: {
        id: 'wordLegend',
        name: 'Word Legend',
        description: 'Complete 100 sets of words',
        title: 'Word Legend',
        condition: (profile) => profile.stats.totalSetsCompleted >= 100,
        category: 'general'
      },
      wordGod: {
        id: 'wordGod',
        name: 'Word God',
        description: 'Complete 500 sets of words',
        title: 'Word God',
        condition: (profile) => profile.stats.totalSetsCompleted >= 500,
        category: 'general'
      },
      speedDemon: {
        id: 'speedDemon',
        name: 'Speed Demon',
        description: 'Achieve 50+ WPM',
        title: 'Speed Demon',
        condition: (profile) => profile.stats.totalSetsCompleted > 0 && 
                                (profile.stats.totalWPMAccumulated / profile.stats.totalSetsCompleted) >= 50,
        category: 'speed'
      },
      speedMaster: {
        id: 'speedMaster',
        name: 'Speed Master',
        description: 'Achieve 75+ WPM',
        title: 'Speed Master',
        condition: (profile) => profile.stats.totalSetsCompleted > 0 && 
                                (profile.stats.totalWPMAccumulated / profile.stats.totalSetsCompleted) >= 75,
        category: 'speed'
      },
      speedLegend: {
        id: 'speedLegend',
        name: 'Speed Legend',
        description: 'Achieve 100+ WPM',
        title: 'Speed Legend',
        condition: (profile) => profile.stats.totalSetsCompleted > 0 && 
                                (profile.stats.totalWPMAccumulated / profile.stats.totalSetsCompleted) >= 100,
        category: 'speed'
      },
      speedGod: {
        id: 'speedGod',
        name: 'Speed God',
        description: 'Achieve 150+ WPM',
        title: 'Speed God',
        condition: (profile) => profile.stats.totalSetsCompleted > 0 && 
                                (profile.stats.totalWPMAccumulated / profile.stats.totalSetsCompleted) >= 150,
        category: 'speed'
      },

      // === SKILL ACHIEVEMENTS ===
      // Fishing achievements
      fisherman: {
        id: 'fisherman',
        name: 'Fisherman',
        description: 'Reach level 25 in Fishing',
        title: 'Fisherman',
        condition: (profile) => profile.skills.fishing.level >= 25,
        category: 'skills'
      },
      masterFisher: {
        id: 'masterFisher',
        name: 'Master Fisher',
        description: 'Reach level 50 in Fishing',
        title: 'Master Fisher',
        condition: (profile) => profile.skills.fishing.level >= 50,
        category: 'skills'
      },
      fishingLegend: {
        id: 'fishingLegend',
        name: 'Fishing Legend',
        description: 'Reach level 75 in Fishing',
        title: 'Fishing Legend',
        condition: (profile) => profile.skills.fishing.level >= 75,
        category: 'skills'
      },
      fishingGod: {
        id: 'fishingGod',
        name: 'Fishing God',
        description: 'Reach level 99 in Fishing',
        title: 'Fishing God',
        condition: (profile) => profile.skills.fishing.level >= 99,
        category: 'skills'
      },

      // Smithing achievements
      blacksmith: {
        id: 'blacksmith',
        name: 'Blacksmith',
        description: 'Reach level 25 in Smithing',
        title: 'Blacksmith',
        condition: (profile) => profile.skills.smithing.level >= 25,
        category: 'skills'
      },
      masterSmith: {
        id: 'masterSmith',
        name: 'Master Smith',
        description: 'Reach level 50 in Smithing',
        title: 'Master Smith',
        condition: (profile) => profile.skills.smithing.level >= 50,
        category: 'skills'
      },
      smithingLegend: {
        id: 'smithingLegend',
        name: 'Smithing Legend',
        description: 'Reach level 75 in Smithing',
        title: 'Smithing Legend',
        condition: (profile) => profile.skills.smithing.level >= 75,
        category: 'skills'
      },
      smithingGod: {
        id: 'smithingGod',
        name: 'Smithing God',
        description: 'Reach level 99 in Smithing',
        title: 'Smithing God',
        condition: (profile) => profile.skills.smithing.level >= 99,
        category: 'skills'
      },

      // Crafting achievements
      crafter: {
        id: 'crafter',
        name: 'Crafter',
        description: 'Reach level 25 in Crafting',
        title: 'Crafter',
        condition: (profile) => profile.skills.crafting.level >= 25,
        category: 'skills'
      },
      masterCrafter: {
        id: 'masterCrafter',
        name: 'Master Crafter',
        description: 'Reach level 50 in Crafting',
        title: 'Master Crafter',
        condition: (profile) => profile.skills.crafting.level >= 50,
        category: 'skills'
      },
      craftingLegend: {
        id: 'craftingLegend',
        name: 'Crafting Legend',
        description: 'Reach level 75 in Crafting',
        title: 'Crafting Legend',
        condition: (profile) => profile.skills.crafting.level >= 75,
        category: 'skills'
      },
      craftingGod: {
        id: 'craftingGod',
        name: 'Crafting God',
        description: 'Reach level 99 in Crafting',
        title: 'Crafting God',
        condition: (profile) => profile.skills.crafting.level >= 99,
        category: 'skills'
      },

      // Cooking achievements
      cook: {
        id: 'cook',
        name: 'Cook',
        description: 'Reach level 25 in Cooking',
        title: 'Cook',
        condition: (profile) => profile.skills.cooking.level >= 25,
        category: 'skills'
      },
      masterChef: {
        id: 'masterChef',
        name: 'Master Chef',
        description: 'Reach level 50 in Cooking',
        title: 'Master Chef',
        condition: (profile) => profile.skills.cooking.level >= 50,
        category: 'skills'
      },
      cookingLegend: {
        id: 'cookingLegend',
        name: 'Cooking Legend',
        description: 'Reach level 75 in Cooking',
        title: 'Cooking Legend',
        condition: (profile) => profile.skills.cooking.level >= 75,
        category: 'skills'
      },
      cookingGod: {
        id: 'cookingGod',
        name: 'Cooking God',
        description: 'Reach level 99 in Cooking',
        title: 'Cooking God',
        condition: (profile) => profile.skills.cooking.level >= 99,
        category: 'skills'
      },

      // Prayer achievements
      faithful: {
        id: 'faithful',
        name: 'Faithful',
        description: 'Reach level 25 in Prayer',
        title: 'Faithful',
        condition: (profile) => profile.skills.prayer.level >= 25,
        category: 'skills'
      },
      masterPriest: {
        id: 'masterPriest',
        name: 'Master Priest',
        description: 'Reach level 50 in Prayer',
        title: 'Master Priest',
        condition: (profile) => profile.skills.prayer.level >= 50,
        category: 'skills'
      },
      prayerLegend: {
        id: 'prayerLegend',
        name: 'Prayer Legend',
        description: 'Reach level 75 in Prayer',
        title: 'Prayer Legend',
        condition: (profile) => profile.skills.prayer.level >= 75,
        category: 'skills'
      },
      prayerGod: {
        id: 'prayerGod',
        name: 'Prayer God',
        description: 'Reach level 99 in Prayer',
        title: 'Prayer God',
        condition: (profile) => profile.skills.prayer.level >= 99,
        category: 'skills'
      },

      // Woodcutting achievements
      lumberjack: {
        id: 'lumberjack',
        name: 'Lumberjack',
        description: 'Reach level 25 in Woodcutting',
        title: 'Lumberjack',
        condition: (profile) => profile.skills.woodcutting.level >= 25,
        category: 'skills'
      },
      masterWoodcutter: {
        id: 'masterWoodcutter',
        name: 'Master Woodcutter',
        description: 'Reach level 50 in Woodcutting',
        title: 'Master Woodcutter',
        condition: (profile) => profile.skills.woodcutting.level >= 50,
        category: 'skills'
      },
      woodcuttingLegend: {
        id: 'woodcuttingLegend',
        name: 'Woodcutting Legend',
        description: 'Reach level 75 in Woodcutting',
        title: 'Woodcutting Legend',
        condition: (profile) => profile.skills.woodcutting.level >= 75,
        category: 'skills'
      },
      woodcuttingGod: {
        id: 'woodcuttingGod',
        name: 'Woodcutting God',
        description: 'Reach level 99 in Woodcutting',
        title: 'Woodcutting God',
        condition: (profile) => profile.skills.woodcutting.level >= 99,
        category: 'skills'
      },

      // Combat achievements
      warrior: {
        id: 'warrior',
        name: 'Warrior',
        description: 'Reach level 25 in Combat',
        title: 'Warrior',
        condition: (profile) => profile.skills.combat.level >= 25,
        category: 'skills'
      },
      masterWarrior: {
        id: 'masterWarrior',
        name: 'Master Warrior',
        description: 'Reach level 50 in Combat',
        title: 'Master Warrior',
        condition: (profile) => profile.skills.combat.level >= 50,
        category: 'skills'
      },
      combatLegend: {
        id: 'combatLegend',
        name: 'Combat Legend',
        description: 'Reach level 75 in Combat',
        title: 'Combat Legend',
        condition: (profile) => profile.skills.combat.level >= 75,
        category: 'skills'
      },
      combatGod: {
        id: 'combatGod',
        name: 'Combat God',
        description: 'Reach level 99 in Combat',
        title: 'Combat God',
        condition: (profile) => profile.skills.combat.level >= 99,
        category: 'skills'
      },

      // Construction achievements
      builder: {
        id: 'builder',
        name: 'Builder',
        description: 'Reach level 25 in Construction',
        title: 'Builder',
        condition: (profile) => profile.skills.construction.level >= 25,
        category: 'skills'
      },
      masterBuilder: {
        id: 'masterBuilder',
        name: 'Master Builder',
        description: 'Reach level 50 in Construction',
        title: 'Master Builder',
        condition: (profile) => profile.skills.construction.level >= 50,
        category: 'skills'
      },
      constructionLegend: {
        id: 'constructionLegend',
        name: 'Construction Legend',
        description: 'Reach level 75 in Construction',
        title: 'Construction Legend',
        condition: (profile) => profile.skills.construction.level >= 75,
        category: 'skills'
      },
      constructionGod: {
        id: 'constructionGod',
        name: 'Construction God',
        description: 'Reach level 99 in Construction',
        title: 'Construction God',
        condition: (profile) => profile.skills.construction.level >= 99,
        category: 'skills'
      },

      // Farming achievements
      farmer: {
        id: 'farmer',
        name: 'Farmer',
        description: 'Reach level 25 in Farming',
        title: 'Farmer',
        condition: (profile) => profile.skills.farming.level >= 25,
        category: 'skills'
      },
      masterFarmer: {
        id: 'masterFarmer',
        name: 'Master Farmer',
        description: 'Reach level 50 in Farming',
        title: 'Master Farmer',
        condition: (profile) => profile.skills.farming.level >= 50,
        category: 'skills'
      },
      farmingLegend: {
        id: 'farmingLegend',
        name: 'Farming Legend',
        description: 'Reach level 75 in Farming',
        title: 'Farming Legend',
        condition: (profile) => profile.skills.farming.level >= 75,
        category: 'skills'
      },
      farmingGod: {
        id: 'farmingGod',
        name: 'Farming God',
        description: 'Reach level 99 in Farming',
        title: 'Farming God',
        condition: (profile) => profile.skills.farming.level >= 99,
        category: 'skills'
      },

      // Magic achievements
      mage: {
        id: 'mage',
        name: 'Mage',
        description: 'Reach level 25 in Magic',
        title: 'Mage',
        condition: (profile) => profile.skills.magic.level >= 25,
        category: 'skills'
      },
      masterMage: {
        id: 'masterMage',
        name: 'Master Mage',
        description: 'Reach level 50 in Magic',
        title: 'Master Mage',
        condition: (profile) => profile.skills.magic.level >= 50,
        category: 'skills'
      },
      magicLegend: {
        id: 'magicLegend',
        name: 'Magic Legend',
        description: 'Reach level 75 in Magic',
        title: 'Magic Legend',
        condition: (profile) => profile.skills.magic.level >= 75,
        category: 'skills'
      },
      magicGod: {
        id: 'magicGod',
        name: 'Magic God',
        description: 'Reach level 99 in Magic',
        title: 'Magic God',
        condition: (profile) => profile.skills.magic.level >= 99,
        category: 'skills'
      },

      // === SKILL MILESTONE ACHIEVEMENTS ===
      skillDiversifier: {
        id: 'skillDiversifier',
        name: 'Skill Diversifier',
        description: 'Reach level 10 in 3 different skills',
        title: 'Diversifier',
        condition: (profile) => Object.values(profile.skills).filter(skill => skill.level >= 10).length >= 3,
        category: 'skills'
      },
      skillBalancer: {
        id: 'skillBalancer',
        name: 'Skill Balancer',
        description: 'Reach level 25 in 5 different skills',
        title: 'Balancer',
        condition: (profile) => Object.values(profile.skills).filter(skill => skill.level >= 25).length >= 5,
        category: 'skills'
      },
      skillMaster: {
        id: 'skillMaster',
        name: 'Skill Master',
        description: 'Reach level 50 in 3 different skills',
        title: 'Skill Master',
        condition: (profile) => Object.values(profile.skills).filter(skill => skill.level >= 50).length >= 3,
        category: 'skills'
      },
      skillLegend: {
        id: 'skillLegend',
        name: 'Skill Legend',
        description: 'Reach level 75 in 3 different skills',
        title: 'Skill Legend',
        condition: (profile) => Object.values(profile.skills).filter(skill => skill.level >= 75).length >= 3,
        category: 'skills'
      },
      skillGod: {
        id: 'skillGod',
        name: 'Skill God',
        description: 'Reach level 99 in 2 different skills',
        title: 'Skill God',
        condition: (profile) => Object.values(profile.skills).filter(skill => skill.level >= 99).length >= 2,
        category: 'skills'
      },
      grandmaster: {
        id: 'grandmaster',
        name: 'Grandmaster',
        description: 'Reach level 99 in any skill',
        title: 'Grandmaster',
        condition: (profile) => Object.values(profile.skills).some(skill => skill.level >= 99),
        category: 'skills'
      },
      ultimateMaster: {
        id: 'ultimateMaster',
        name: 'Ultimate Master',
        description: 'Reach level 99 in all skills',
        title: 'Ultimate Master',
        condition: (profile) => Object.values(profile.skills).every(skill => skill.level >= 99),
        category: 'skills'
      },

      // === SKILL COMBINATION ACHIEVEMENTS ===
      fisherCook: {
        id: 'fisherCook',
        name: 'Fisher Cook',
        description: 'Reach level 30 in both Fishing and Cooking',
        title: 'Fisher Cook',
        condition: (profile) => profile.skills.fishing.level >= 30 && profile.skills.cooking.level >= 30,
        category: 'skills'
      },
      blacksmithBuilder: {
        id: 'blacksmithBuilder',
        name: 'Blacksmith Builder',
        description: 'Reach level 40 in both Smithing and Construction',
        title: 'Blacksmith Builder',
        condition: (profile) => profile.skills.smithing.level >= 40 && profile.skills.construction.level >= 40,
        category: 'skills'
      },
      farmerWoodcutter: {
        id: 'farmerWoodcutter',
        name: 'Farmer Woodcutter',
        description: 'Reach level 35 in both Farming and Woodcutting',
        title: 'Farmer Woodcutter',
        condition: (profile) => profile.skills.farming.level >= 35 && profile.skills.woodcutting.level >= 35,
        category: 'skills'
      },
      mageWarrior: {
        id: 'mageWarrior',
        name: 'Mage Warrior',
        description: 'Reach level 45 in both Magic and Combat',
        title: 'Mage Warrior',
        condition: (profile) => profile.skills.magic.level >= 45 && profile.skills.combat.level >= 45,
        category: 'skills'
      },
      crafterPrayer: {
        id: 'crafterPrayer',
        name: 'Crafter Prayer',
        description: 'Reach level 50 in both Crafting and Prayer',
        title: 'Crafter Prayer',
        condition: (profile) => profile.skills.crafting.level >= 50 && profile.skills.prayer.level >= 50,
        category: 'skills'
      },

      // === SKILL TRIAD ACHIEVEMENTS ===
      natureTriad: {
        id: 'natureTriad',
        name: 'Nature Triad',
        description: 'Reach level 25 in Fishing, Farming, and Woodcutting',
        title: 'Nature Triad',
        condition: (profile) => profile.skills.fishing.level >= 25 && profile.skills.farming.level >= 25 && profile.skills.woodcutting.level >= 25,
        category: 'skills'
      },
      craftTriad: {
        id: 'craftTriad',
        name: 'Craft Triad',
        description: 'Reach level 30 in Smithing, Crafting, and Construction',
        title: 'Craft Triad',
        condition: (profile) => profile.skills.smithing.level >= 30 && profile.skills.crafting.level >= 30 && profile.skills.construction.level >= 30,
        category: 'skills'
      },
      combatTriad: {
        id: 'combatTriad',
        name: 'Combat Triad',
        description: 'Reach level 40 in Combat, Magic, and Prayer',
        title: 'Combat Triad',
        condition: (profile) => profile.skills.combat.level >= 40 && profile.skills.magic.level >= 40 && profile.skills.prayer.level >= 40,
        category: 'skills'
      },
      supportTriad: {
        id: 'supportTriad',
        name: 'Support Triad',
        description: 'Reach level 35 in Cooking, Crafting, and Prayer',
        title: 'Support Triad',
        condition: (profile) => profile.skills.cooking.level >= 35 && profile.skills.crafting.level >= 35 && profile.skills.prayer.level >= 35,
        category: 'skills'
      },

      // === SKILL QUADRANT ACHIEVEMENTS ===
      gathererQuad: {
        id: 'gathererQuad',
        name: 'Gatherer Quad',
        description: 'Reach level 20 in Fishing, Farming, Woodcutting, and Mining (if added)',
        title: 'Gatherer',
        condition: (profile) => profile.skills.fishing.level >= 20 && profile.skills.farming.level >= 20 && profile.skills.woodcutting.level >= 20,
        category: 'skills'
      },
      artisanQuad: {
        id: 'artisanQuad',
        name: 'Artisan Quad',
        description: 'Reach level 25 in Smithing, Crafting, Construction, and Cooking',
        title: 'Artisan',
        condition: (profile) => profile.skills.smithing.level >= 25 && profile.skills.crafting.level >= 25 && profile.skills.construction.level >= 25 && profile.skills.cooking.level >= 25,
        category: 'skills'
      },
      warriorQuad: {
        id: 'warriorQuad',
        name: 'Warrior Quad',
        description: 'Reach level 30 in Combat, Magic, Prayer, and Smithing',
        title: 'Warrior',
        condition: (profile) => profile.skills.combat.level >= 30 && profile.skills.magic.level >= 30 && profile.skills.prayer.level >= 30 && profile.skills.smithing.level >= 30,
        category: 'skills'
      },

      // === SKILL PENTAD ACHIEVEMENTS ===
      masterPentad: {
        id: 'masterPentad',
        name: 'Master Pentad',
        description: 'Reach level 50 in 5 different skills',
        title: 'Master Pentad',
        condition: (profile) => Object.values(profile.skills).filter(skill => skill.level >= 50).length >= 5,
        category: 'skills'
      },
      legendPentad: {
        id: 'legendPentad',
        name: 'Legend Pentad',
        description: 'Reach level 75 in 5 different skills',
        title: 'Legend Pentad',
        condition: (profile) => Object.values(profile.skills).filter(skill => skill.level >= 75).length >= 5,
        category: 'skills'
      },
      godPentad: {
        id: 'godPentad',
        name: 'God Pentad',
        description: 'Reach level 99 in 5 different skills',
        title: 'God Pentad',
        condition: (profile) => Object.values(profile.skills).filter(skill => skill.level >= 99).length >= 5,
        category: 'skills'
      },

      // === SKILL HEXAD ACHIEVEMENTS ===
      masterHexad: {
        id: 'masterHexad',
        name: 'Master Hexad',
        description: 'Reach level 50 in 6 different skills',
        title: 'Master Hexad',
        condition: (profile) => Object.values(profile.skills).filter(skill => skill.level >= 50).length >= 6,
        category: 'skills'
      },
      legendHexad: {
        id: 'legendHexad',
        name: 'Legend Hexad',
        description: 'Reach level 75 in 6 different skills',
        title: 'Legend Hexad',
        condition: (profile) => Object.values(profile.skills).filter(skill => skill.level >= 75).length >= 6,
        category: 'skills'
      },
      godHexad: {
        id: 'godHexad',
        name: 'God Hexad',
        description: 'Reach level 99 in 6 different skills',
        title: 'God Hexad',
        condition: (profile) => Object.values(profile.skills).filter(skill => skill.level >= 99).length >= 6,
        category: 'skills'
      },

      // === SKILL SEPTAD ACHIEVEMENTS ===
      masterSeptad: {
        id: 'masterSeptad',
        name: 'Master Septad',
        description: 'Reach level 50 in 7 different skills',
        title: 'Master Septad',
        condition: (profile) => Object.values(profile.skills).filter(skill => skill.level >= 50).length >= 7,
        category: 'skills'
      },
      legendSeptad: {
        id: 'legendSeptad',
        name: 'Legend Septad',
        description: 'Reach level 75 in 7 different skills',
        title: 'Legend Septad',
        condition: (profile) => Object.values(profile.skills).filter(skill => skill.level >= 75).length >= 7,
        category: 'skills'
      },
      godSeptad: {
        id: 'godSeptad',
        name: 'God Septad',
        description: 'Reach level 99 in 7 different skills',
        title: 'God Septad',
        condition: (profile) => Object.values(profile.skills).filter(skill => skill.level >= 99).length >= 7,
        category: 'skills'
      },

      // === SKILL OCTAD ACHIEVEMENTS ===
      masterOctad: {
        id: 'masterOctad',
        name: 'Master Octad',
        description: 'Reach level 50 in 8 different skills',
        title: 'Master Octad',
        condition: (profile) => Object.values(profile.skills).filter(skill => skill.level >= 50).length >= 8,
        category: 'skills'
      },
      legendOctad: {
        id: 'legendOctad',
        name: 'Legend Octad',
        description: 'Reach level 75 in 8 different skills',
        title: 'Legend Octad',
        condition: (profile) => Object.values(profile.skills).filter(skill => skill.level >= 75).length >= 8,
        category: 'skills'
      },
      godOctad: {
        id: 'godOctad',
        name: 'God Octad',
        description: 'Reach level 99 in 8 different skills',
        title: 'God Octad',
        condition: (profile) => Object.values(profile.skills).filter(skill => skill.level >= 99).length >= 8,
        category: 'skills'
      },

      // === SKILL NONAD ACHIEVEMENTS ===
      masterNonad: {
        id: 'masterNonad',
        name: 'Master Nonad',
        description: 'Reach level 50 in 9 different skills',
        title: 'Master Nonad',
        condition: (profile) => Object.values(profile.skills).filter(skill => skill.level >= 50).length >= 9,
        category: 'skills'
      },
      legendNonad: {
        id: 'legendNonad',
        name: 'Legend Nonad',
        description: 'Reach level 75 in 9 different skills',
        title: 'Legend Nonad',
        condition: (profile) => Object.values(profile.skills).filter(skill => skill.level >= 75).length >= 9,
        category: 'skills'
      },
      godNonad: {
        id: 'godNonad',
        name: 'God Nonad',
        description: 'Reach level 99 in 9 different skills',
        title: 'God Nonad',
        condition: (profile) => Object.values(profile.skills).filter(skill => skill.level >= 99).length >= 9,
        category: 'skills'
      },

      // === SKILL DECAD ACHIEVEMENTS ===
      masterDecad: {
        id: 'masterDecad',
        name: 'Master Decad',
        description: 'Reach level 50 in all skills',
        title: 'Master Decad',
        condition: (profile) => Object.values(profile.skills).every(skill => skill.level >= 50),
        category: 'skills'
      },
      legendDecad: {
        id: 'legendDecad',
        name: 'Legend Decad',
        description: 'Reach level 75 in all skills',
        title: 'Legend Decad',
        condition: (profile) => Object.values(profile.skills).every(skill => skill.level >= 75),
        category: 'skills'
      },
      godDecad: {
        id: 'godDecad',
        name: 'God Decad',
        description: 'Reach level 99 in all skills',
        title: 'God Decad',
        condition: (profile) => Object.values(profile.skills).every(skill => skill.level >= 99),
        category: 'skills'
      },

      // === ZEN MODE ACHIEVEMENTS ===
      zenMaster: {
        id: 'zenMaster',
        name: 'Zen Master',
        description: 'Complete 100 words in Zen mode',
        title: 'Zen Master',
        condition: (profile) => profile.zen.wordsCompleted >= 100,
        category: 'zen'
      },
      zenLegend: {
        id: 'zenLegend',
        name: 'Zen Legend',
        description: 'Complete 500 words in Zen mode',
        title: 'Zen Legend',
        condition: (profile) => profile.zen.wordsCompleted >= 500,
        category: 'zen'
      },
      zenGod: {
        id: 'zenGod',
        name: 'Zen God',
        description: 'Complete 1000 words in Zen mode',
        title: 'Zen God',
        condition: (profile) => profile.zen.wordsCompleted >= 1000,
        category: 'zen'
      },
      zenMythic: {
        id: 'zenMythic',
        name: 'Zen Mythic',
        description: 'Complete 2500 words in Zen mode',
        title: 'Zen Mythic',
        condition: (profile) => profile.zen.wordsCompleted >= 2500,
        category: 'zen'
      },
      zenUltimate: {
        id: 'zenUltimate',
        name: 'Zen Ultimate',
        description: 'Complete 5000 words in Zen mode',
        title: 'Zen Ultimate',
        condition: (profile) => profile.zen.wordsCompleted >= 5000,
        category: 'zen'
      },
      zenStreak10: {
        id: 'zenStreak10',
        name: 'Zen Streak',
        description: 'Achieve a 10-word streak in Zen mode',
        title: 'Streaker',
        condition: (profile) => profile.zen.bestStreak >= 10,
        category: 'zen'
      },
      zenStreak25: {
        id: 'zenStreak25',
        name: 'Zen Streak Master',
        description: 'Achieve a 25-word streak in Zen mode',
        title: 'Streak Master',
        condition: (profile) => profile.zen.bestStreak >= 25,
        category: 'zen'
      },
      zenStreak50: {
        id: 'zenStreak50',
        name: 'Zen Streak Legend',
        description: 'Achieve a 50-word streak in Zen mode',
        title: 'Streak Legend',
        condition: (profile) => profile.zen.bestStreak >= 50,
        category: 'zen'
      },
      zenStreak100: {
        id: 'zenStreak100',
        name: 'Zen Streak God',
        description: 'Achieve a 100-word streak in Zen mode',
        title: 'Streak God',
        condition: (profile) => profile.zen.bestStreak >= 100,
        category: 'zen'
      },

      // === RAID MODE ACHIEVEMENTS ===
      raider: {
        id: 'raider',
        name: 'Raider',
        description: 'Reach level 10 in Raid mode',
        title: 'Raider',
        condition: (profile) => profile.raid.highScore >= 10,
        category: 'raid'
      },
      raidMaster: {
        id: 'raidMaster',
        name: 'Raid Master',
        description: 'Reach level 25 in Raid mode',
        title: 'Raid Master',
        condition: (profile) => profile.raid.highScore >= 25,
        category: 'raid'
      },
      raidLegend: {
        id: 'raidLegend',
        name: 'Raid Legend',
        description: 'Reach level 50 in Raid mode',
        title: 'Raid Legend',
        condition: (profile) => profile.raid.highScore >= 50,
        category: 'raid'
      },
      raidGod: {
        id: 'raidGod',
        name: 'Raid God',
        description: 'Reach level 100 in Raid mode',
        title: 'Raid God',
        condition: (profile) => profile.raid.highScore >= 100,
        category: 'raid'
      },
      raidMythic: {
        id: 'raidMythic',
        name: 'Raid Mythic',
        description: 'Reach level 250 in Raid mode',
        title: 'Raid Mythic',
        condition: (profile) => profile.raid.highScore >= 250,
        category: 'raid'
      },
      raidUltimate: {
        id: 'raidUltimate',
        name: 'Raid Ultimate',
        description: 'Reach level 500 in Raid mode',
        title: 'Raid Ultimate',
        condition: (profile) => profile.raid.highScore >= 500,
        category: 'raid'
      },

      // === ARENA MODE ACHIEVEMENTS ===
      arenaEasy: {
        id: 'arenaEasy',
        name: 'Easy Arena Champion',
        description: 'Score 40+ in Easy Arena',
        title: 'Easy Champion',
        condition: (profile) => profile.arena.highScores.easy >= 40,
        category: 'arena'
      },
      arenaMedium: {
        id: 'arenaMedium',
        name: 'Medium Arena Champion',
        description: 'Score 60+ in Medium Arena',
        title: 'Medium Champion',
        condition: (profile) => profile.arena.highScores.medium >= 60,
        category: 'arena'
      },
      arenaHard: {
        id: 'arenaHard',
        name: 'Hard Arena Champion',
        description: 'Score 75+ in Hard Arena',
        title: 'Hard Champion',
        condition: (profile) => profile.arena.highScores.hard >= 75,
        category: 'arena'
      },

      // === DUEL MODE ACHIEVEMENTS ===
      duelist: {
        id: 'duelist',
        name: 'Duelist',
        description: 'Win 5 duels',
        title: 'Duelist',
        condition: (profile) => profile.duel.history.filter(duel => duel.result === 'Win').length >= 5,
        category: 'duel'
      },
      duelMaster: {
        id: 'duelMaster',
        name: 'Duel Master',
        description: 'Win 25 duels',
        title: 'Duel Master',
        condition: (profile) => profile.duel.history.filter(duel => duel.result === 'Win').length >= 25,
        category: 'duel'
      },
      duelLegend: {
        id: 'duelLegend',
        name: 'Duel Legend',
        description: 'Win 100 duels',
        title: 'Duel Legend',
        condition: (profile) => profile.duel.history.filter(duel => duel.result === 'Win').length >= 100,
        category: 'duel'
      },
      duelGod: {
        id: 'duelGod',
        name: 'Duel God',
        description: 'Win 250 duels',
        title: 'Duel God',
        condition: (profile) => profile.duel.history.filter(duel => duel.result === 'Win').length >= 250,
        category: 'duel'
      },
      duelMythic: {
        id: 'duelMythic',
        name: 'Duel Mythic',
        description: 'Win 500 duels',
        title: 'Duel Mythic',
        condition: (profile) => profile.duel.history.filter(duel => duel.result === 'Win').length >= 500,
        category: 'duel'
      },
      duelUltimate: {
        id: 'duelUltimate',
        name: 'Duel Ultimate',
        description: 'Win 1000 duels',
        title: 'Duel Ultimate',
        condition: (profile) => profile.duel.history.filter(duel => duel.result === 'Win').length >= 1000,
        category: 'duel'
      },
      highRoller: {
        id: 'highRoller',
        name: 'High Roller',
        description: 'Win a duel with 100+ gold wager',
        title: 'High Roller',
        condition: (profile) => profile.duel.history.some(duel => duel.result === 'Win' && duel.wager >= 100),
        category: 'duel'
      },
      megaRoller: {
        id: 'megaRoller',
        name: 'Mega Roller',
        description: 'Win a duel with 500+ gold wager',
        title: 'Mega Roller',
        condition: (profile) => profile.duel.history.some(duel => duel.result === 'Win' && duel.wager >= 500),
        category: 'duel'
      },
      ultraRoller: {
        id: 'ultraRoller',
        name: 'Ultra Roller',
        description: 'Win a duel with 1000+ gold wager',
        title: 'Ultra Roller',
        condition: (profile) => profile.duel.history.some(duel => duel.result === 'Win' && duel.wager >= 1000),
        category: 'duel'
      },

      // === ECONOMY ACHIEVEMENTS ===
      goldMiner: {
        id: 'goldMiner',
        name: 'Gold Miner',
        description: 'Accumulate 1000 gold',
        title: 'Miner',
        condition: (profile) => profile.gold >= 1000,
        category: 'economy'
      },
      goldCollector: {
        id: 'goldCollector',
        name: 'Gold Collector',
        description: 'Accumulate 5000 gold',
        title: 'Collector',
        condition: (profile) => profile.gold >= 5000,
        category: 'economy'
      },
      goldMaster: {
        id: 'goldMaster',
        name: 'Gold Master',
        description: 'Accumulate 10000 gold',
        title: 'Gold Master',
        condition: (profile) => profile.gold >= 10000,
        category: 'economy'
      },
      goldLegend: {
        id: 'goldLegend',
        name: 'Gold Legend',
        description: 'Accumulate 25000 gold',
        title: 'Gold Legend',
        condition: (profile) => profile.gold >= 25000,
        category: 'economy'
      },
      goldGod: {
        id: 'goldGod',
        name: 'Gold God',
        description: 'Accumulate 50000 gold',
        title: 'Gold God',
        condition: (profile) => profile.gold >= 50000,
        category: 'economy'
      },
      goldMythic: {
        id: 'goldMythic',
        name: 'Gold Mythic',
        description: 'Accumulate 100000 gold',
        title: 'Gold Mythic',
        condition: (profile) => profile.gold >= 100000,
        category: 'economy'
      },
      goldUltimate: {
        id: 'goldUltimate',
        name: 'Gold Ultimate',
        description: 'Accumulate 250000 gold',
        title: 'Gold Ultimate',
        condition: (profile) => profile.gold >= 250000,
        category: 'economy'
      },

      // === SHOP/THEME ACHIEVEMENTS ===
      themeCollector: {
        id: 'themeCollector',
        name: 'Theme Collector',
        description: 'Purchase 3 themes',
        title: 'Theme Collector',
        condition: (profile) => profile.shop.purchasedThemes.length >= 4, // Including default theme
        category: 'shop'
      },
      themeMaster: {
        id: 'themeMaster',
        name: 'Theme Master',
        description: 'Purchase 6 themes',
        title: 'Theme Master',
        condition: (profile) => profile.shop.purchasedThemes.length >= 7,
        category: 'shop'
      },
      themeLegend: {
        id: 'themeLegend',
        name: 'Theme Legend',
        description: 'Purchase all themes',
        title: 'Theme Legend',
        condition: (profile) => profile.shop.purchasedThemes.length >= 10,
        category: 'shop'
      },

      // === PERFECT LINE ACHIEVEMENTS ===
      perfectLine: {
        id: 'perfectLine',
        name: 'Perfect Line',
        description: 'Complete a perfect line (all words correct)',
        title: 'Perfect',
        condition: (profile) => profile.stats.perfectLinesCompleted >= 1,
        category: 'perfection'
      },
      perfectMaster: {
        id: 'perfectMaster',
        name: 'Perfect Master',
        description: 'Complete 10 perfect lines',
        title: 'Perfect Master',
        condition: (profile) => profile.stats.perfectLinesCompleted >= 10,
        category: 'perfection'
      },
      perfectLegend: {
        id: 'perfectLegend',
        name: 'Perfect Legend',
        description: 'Complete 50 perfect lines',
        title: 'Perfect Legend',
        condition: (profile) => profile.stats.perfectLinesCompleted >= 50,
        category: 'perfection'
      },
      perfectGod: {
        id: 'perfectGod',
        name: 'Perfect God',
        description: 'Complete 100 perfect lines',
        title: 'Perfect God',
        condition: (profile) => profile.stats.perfectLinesCompleted >= 100,
        category: 'perfection'
      },

      // === COMBO ACHIEVEMENTS ===
      comboMaster: {
        id: 'comboMaster',
        name: 'Combo Master',
        description: 'Achieve a 10x combo multiplier',
        title: 'Combo Master',
        condition: (profile) => profile.stats.maxComboAchieved >= 10,
        category: 'combo'
      },
      comboLegend: {
        id: 'comboLegend',
        name: 'Combo Legend',
        description: 'Achieve a 20x combo multiplier',
        title: 'Combo Legend',
        condition: (profile) => profile.stats.maxComboAchieved >= 20,
        category: 'combo'
      },
      comboGod: {
        id: 'comboGod',
        name: 'Combo God',
        description: 'Achieve a 50x combo multiplier',
        title: 'Combo God',
        condition: (profile) => profile.stats.maxComboAchieved >= 50,
        category: 'combo'
      },

      // === TIME-BASED ACHIEVEMENTS ===
      earlyBird: {
        id: 'earlyBird',
        name: 'Early Bird',
        description: 'Play the game for the first time',
        title: 'Early Bird',
        condition: (profile) => profile.createdAt && (Date.now() - profile.createdAt) > 0,
        category: 'time'
      },
      veteran: {
        id: 'veteran',
        name: 'Veteran',
        description: 'Play the game for 7 days',
        title: 'Veteran',
        condition: (profile) => profile.createdAt && (Date.now() - profile.createdAt) >= 7 * 24 * 60 * 60 * 1000,
        category: 'time'
      },
      oldTimer: {
        id: 'oldTimer',
        name: 'Old Timer',
        description: 'Play the game for 30 days',
        title: 'Old Timer',
        condition: (profile) => profile.createdAt && (Date.now() - profile.createdAt) >= 30 * 24 * 60 * 60 * 1000,
        category: 'time'
      },
      ancient: {
        id: 'ancient',
        name: 'Ancient',
        description: 'Play the game for 100 days',
        title: 'Ancient',
        condition: (profile) => profile.createdAt && (Date.now() - profile.createdAt) >= 100 * 24 * 60 * 60 * 1000,
        category: 'time'
      },
      immortal: {
        id: 'immortal',
        name: 'Immortal',
        description: 'Play the game for 365 days',
        title: 'Immortal',
        condition: (profile) => profile.createdAt && (Date.now() - profile.createdAt) >= 365 * 24 * 60 * 60 * 1000,
        category: 'time'
      },

      // === TOTAL LEVEL ACHIEVEMENTS ===
      totalLevel10: {
        id: 'totalLevel10',
        name: 'Apprentice',
        description: 'Reach total level 10',
        title: 'Apprentice',
        condition: (profile) => Object.values(profile.skills).reduce((sum, skill) => sum + skill.level, 0) >= 10,
        category: 'total'
      },
      totalLevel50: {
        id: 'totalLevel50',
        name: 'Journeyman',
        description: 'Reach total level 50',
        title: 'Journeyman',
        condition: (profile) => Object.values(profile.skills).reduce((sum, skill) => sum + skill.level, 0) >= 50,
        category: 'total'
      },
      totalLevel100: {
        id: 'totalLevel100',
        name: 'Expert',
        description: 'Reach total level 100',
        title: 'Expert',
        condition: (profile) => Object.values(profile.skills).reduce((sum, skill) => sum + skill.level, 0) >= 100,
        category: 'total'
      },
      totalLevel250: {
        id: 'totalLevel250',
        name: 'Master',
        description: 'Reach total level 250',
        title: 'Master',
        condition: (profile) => Object.values(profile.skills).reduce((sum, skill) => sum + skill.level, 0) >= 250,
        category: 'total'
      },
      totalLevel500: {
        id: 'totalLevel500',
        name: 'Grandmaster',
        description: 'Reach total level 500',
        title: 'Grandmaster',
        condition: (profile) => Object.values(profile.skills).reduce((sum, skill) => sum + skill.level, 0) >= 500,
        category: 'total'
      },
      totalLevel750: {
        id: 'totalLevel750',
        name: 'Legend',
        description: 'Reach total level 750',
        title: 'Legend',
        condition: (profile) => Object.values(profile.skills).reduce((sum, skill) => sum + skill.level, 0) >= 750,
        category: 'total'
      },
      totalLevel900: {
        id: 'totalLevel900',
        name: 'Mythic',
        description: 'Reach total level 900',
        title: 'Mythic',
        condition: (profile) => Object.values(profile.skills).reduce((sum, skill) => sum + skill.level, 0) >= 900,
        category: 'total'
      },

      // === SKILL COMBINATION ACHIEVEMENTS ===
      fisherCook: {
        id: 'fisherCook',
        name: 'Fisher Cook',
        description: 'Reach level 30 in both Fishing and Cooking',
        title: 'Fisher Cook',
        condition: (profile) => profile.skills.fishing.level >= 30 && profile.skills.cooking.level >= 30,
        category: 'skills'
      },
      blacksmithBuilder: {
        id: 'blacksmithBuilder',
        name: 'Blacksmith Builder',
        description: 'Reach level 40 in both Smithing and Construction',
        title: 'Blacksmith Builder',
        condition: (profile) => profile.skills.smithing.level >= 40 && profile.skills.construction.level >= 40,
        category: 'skills'
      },
      farmerWoodcutter: {
        id: 'farmerWoodcutter',
        name: 'Farmer Woodcutter',
        description: 'Reach level 35 in both Farming and Woodcutting',
        title: 'Farmer Woodcutter',
        condition: (profile) => profile.skills.farming.level >= 35 && profile.skills.woodcutting.level >= 35,
        category: 'skills'
      },
      mageWarrior: {
        id: 'mageWarrior',
        name: 'Mage Warrior',
        description: 'Reach level 45 in both Magic and Combat',
        title: 'Mage Warrior',
        condition: (profile) => profile.skills.magic.level >= 45 && profile.skills.combat.level >= 45,
        category: 'skills'
      },
      crafterPrayer: {
        id: 'crafterPrayer',
        name: 'Crafter Prayer',
        description: 'Reach level 50 in both Crafting and Prayer',
        title: 'Crafter Prayer',
        condition: (profile) => profile.skills.crafting.level >= 50 && profile.skills.prayer.level >= 50,
        category: 'skills'
      },

      // === SKILL TRIAD ACHIEVEMENTS ===
      natureTriad: {
        id: 'natureTriad',
        name: 'Nature Triad',
        description: 'Reach level 25 in Fishing, Farming, and Woodcutting',
        title: 'Nature Triad',
        condition: (profile) => profile.skills.fishing.level >= 25 && profile.skills.farming.level >= 25 && profile.skills.woodcutting.level >= 25,
        category: 'skills'
      },
      craftTriad: {
        id: 'craftTriad',
        name: 'Craft Triad',
        description: 'Reach level 30 in Smithing, Crafting, and Construction',
        title: 'Craft Triad',
        condition: (profile) => profile.skills.smithing.level >= 30 && profile.skills.crafting.level >= 30 && profile.skills.construction.level >= 30,
        category: 'skills'
      },
      combatTriad: {
        id: 'combatTriad',
        name: 'Combat Triad',
        description: 'Reach level 40 in Combat, Magic, and Prayer',
        title: 'Combat Triad',
        condition: (profile) => profile.skills.combat.level >= 40 && profile.skills.magic.level >= 40 && profile.skills.prayer.level >= 40,
        category: 'skills'
      },
      supportTriad: {
        id: 'supportTriad',
        name: 'Support Triad',
        description: 'Reach level 35 in Cooking, Crafting, and Prayer',
        title: 'Support Triad',
        condition: (profile) => profile.skills.cooking.level >= 35 && profile.skills.crafting.level >= 35 && profile.skills.prayer.level >= 35,
        category: 'skills'
      },

      // === SKILL QUADRANT ACHIEVEMENTS ===
      gathererQuad: {
        id: 'gathererQuad',
        name: 'Gatherer Quad',
        description: 'Reach level 20 in Fishing, Farming, Woodcutting, and Mining (if added)',
        title: 'Gatherer',
        condition: (profile) => profile.skills.fishing.level >= 20 && profile.skills.farming.level >= 20 && profile.skills.woodcutting.level >= 20,
        category: 'skills'
      },
      artisanQuad: {
        id: 'artisanQuad',
        name: 'Artisan Quad',
        description: 'Reach level 25 in Smithing, Crafting, Construction, and Cooking',
        title: 'Artisan',
        condition: (profile) => profile.skills.smithing.level >= 25 && profile.skills.crafting.level >= 25 && profile.skills.construction.level >= 25 && profile.skills.cooking.level >= 25,
        category: 'skills'
      },
      warriorQuad: {
        id: 'warriorQuad',
        name: 'Warrior Quad',
        description: 'Reach level 30 in Combat, Magic, Prayer, and Smithing',
        title: 'Warrior',
        condition: (profile) => profile.skills.combat.level >= 30 && profile.skills.magic.level >= 30 && profile.skills.prayer.level >= 30 && profile.skills.smithing.level >= 30,
        category: 'skills'
      },

      // === SKILL PENTAD ACHIEVEMENTS ===
      masterPentad: {
        id: 'masterPentad',
        name: 'Master Pentad',
        description: 'Reach level 50 in 5 different skills',
        title: 'Master Pentad',
        condition: (profile) => Object.values(profile.skills).filter(skill => skill.level >= 50).length >= 5,
        category: 'skills'
      },
      legendPentad: {
        id: 'legendPentad',
        name: 'Legend Pentad',
        description: 'Reach level 75 in 5 different skills',
        title: 'Legend Pentad',
        condition: (profile) => Object.values(profile.skills).filter(skill => skill.level >= 75).length >= 5,
        category: 'skills'
      },
      godPentad: {
        id: 'godPentad',
        name: 'God Pentad',
        description: 'Reach level 99 in 5 different skills',
        title: 'God Pentad',
        condition: (profile) => Object.values(profile.skills).filter(skill => skill.level >= 99).length >= 5,
        category: 'skills'
      },

      // === SKILL HEXAD ACHIEVEMENTS ===
      masterHexad: {
        id: 'masterHexad',
        name: 'Master Hexad',
        description: 'Reach level 50 in 6 different skills',
        title: 'Master Hexad',
        condition: (profile) => Object.values(profile.skills).filter(skill => skill.level >= 50).length >= 6,
        category: 'skills'
      },
      legendHexad: {
        id: 'legendHexad',
        name: 'Legend Hexad',
        description: 'Reach level 75 in 6 different skills',
        title: 'Legend Hexad',
        condition: (profile) => Object.values(profile.skills).filter(skill => skill.level >= 75).length >= 6,
        category: 'skills'
      },
      godHexad: {
        id: 'godHexad',
        name: 'God Hexad',
        description: 'Reach level 99 in 6 different skills',
        title: 'God Hexad',
        condition: (profile) => Object.values(profile.skills).filter(skill => skill.level >= 99).length >= 6,
        category: 'skills'
      },

      // === SKILL SEPTAD ACHIEVEMENTS ===
      masterSeptad: {
        id: 'masterSeptad',
        name: 'Master Septad',
        description: 'Reach level 50 in 7 different skills',
        title: 'Master Septad',
        condition: (profile) => Object.values(profile.skills).filter(skill => skill.level >= 50).length >= 7,
        category: 'skills'
      },
      legendSeptad: {
        id: 'legendSeptad',
        name: 'Legend Septad',
        description: 'Reach level 75 in 7 different skills',
        title: 'Legend Septad',
        condition: (profile) => Object.values(profile.skills).filter(skill => skill.level >= 75).length >= 7,
        category: 'skills'
      },
      godSeptad: {
        id: 'godSeptad',
        name: 'God Septad',
        description: 'Reach level 99 in 7 different skills',
        title: 'God Septad',
        condition: (profile) => Object.values(profile.skills).filter(skill => skill.level >= 99).length >= 7,
        category: 'skills'
      },

      // === SKILL OCTAD ACHIEVEMENTS ===
      masterOctad: {
        id: 'masterOctad',
        name: 'Master Octad',
        description: 'Reach level 50 in 8 different skills',
        title: 'Master Octad',
        condition: (profile) => Object.values(profile.skills).filter(skill => skill.level >= 50).length >= 8,
        category: 'skills'
      },
      legendOctad: {
        id: 'legendOctad',
        name: 'Legend Octad',
        description: 'Reach level 75 in 8 different skills',
        title: 'Legend Octad',
        condition: (profile) => Object.values(profile.skills).filter(skill => skill.level >= 75).length >= 8,
        category: 'skills'
      },
      godOctad: {
        id: 'godOctad',
        name: 'God Octad',
        description: 'Reach level 99 in 8 different skills',
        title: 'God Octad',
        condition: (profile) => Object.values(profile.skills).filter(skill => skill.level >= 99).length >= 8,
        category: 'skills'
      },

      // === SKILL NONAD ACHIEVEMENTS ===
      masterNonad: {
        id: 'masterNonad',
        name: 'Master Nonad',
        description: 'Reach level 50 in 9 different skills',
        title: 'Master Nonad',
        condition: (profile) => Object.values(profile.skills).filter(skill => skill.level >= 50).length >= 9,
        category: 'skills'
      },
      legendNonad: {
        id: 'legendNonad',
        name: 'Legend Nonad',
        description: 'Reach level 75 in 9 different skills',
        title: 'Legend Nonad',
        condition: (profile) => Object.values(profile.skills).filter(skill => skill.level >= 75).length >= 9,
        category: 'skills'
      },
      godNonad: {
        id: 'godNonad',
        name: 'God Nonad',
        description: 'Reach level 99 in 9 different skills',
        title: 'God Nonad',
        condition: (profile) => Object.values(profile.skills).filter(skill => skill.level >= 99).length >= 9,
        category: 'skills'
      },

      // === SKILL DECAD ACHIEVEMENTS ===
      masterDecad: {
        id: 'masterDecad',
        name: 'Master Decad',
        description: 'Reach level 50 in all skills',
        title: 'Master Decad',
        condition: (profile) => Object.values(profile.skills).every(skill => skill.level >= 50),
        category: 'skills'
      },
      legendDecad: {
        id: 'legendDecad',
        name: 'Legend Decad',
        description: 'Reach level 75 in all skills',
        title: 'Legend Decad',
        condition: (profile) => Object.values(profile.skills).every(skill => skill.level >= 75),
        category: 'skills'
      },
      godDecad: {
        id: 'godDecad',
        name: 'God Decad',
        description: 'Reach level 99 in all skills',
        title: 'God Decad',
        condition: (profile) => Object.values(profile.skills).every(skill => skill.level >= 99),
        category: 'skills'
      },

      // === ZEN MODE ACHIEVEMENTS ===
      zenMaster: {
        id: 'zenMaster',
        name: 'Zen Master',
        description: 'Complete 100 words in Zen mode',
        title: 'Zen Master',
        condition: (profile) => profile.zen.wordsCompleted >= 100,
        category: 'zen'
      },
      zenLegend: {
        id: 'zenLegend',
        name: 'Zen Legend',
        description: 'Complete 500 words in Zen mode',
        title: 'Zen Legend',
        condition: (profile) => profile.zen.wordsCompleted >= 500,
        category: 'zen'
      },
      zenGod: {
        id: 'zenGod',
        name: 'Zen God',
        description: 'Complete 1000 words in Zen mode',
        title: 'Zen God',
        condition: (profile) => profile.zen.wordsCompleted >= 1000,
        category: 'zen'
      },
      zenMythic: {
        id: 'zenMythic',
        name: 'Zen Mythic',
        description: 'Complete 2500 words in Zen mode',
        title: 'Zen Mythic',
        condition: (profile) => profile.zen.wordsCompleted >= 2500,
        category: 'zen'
      },
      zenUltimate: {
        id: 'zenUltimate',
        name: 'Zen Ultimate',
        description: 'Complete 5000 words in Zen mode',
        title: 'Zen Ultimate',
        condition: (profile) => profile.zen.wordsCompleted >= 5000,
        category: 'zen'
      },
      zenStreak10: {
        id: 'zenStreak10',
        name: 'Zen Streak',
        description: 'Achieve a 10-word streak in Zen mode',
        title: 'Streaker',
        condition: (profile) => profile.zen.bestStreak >= 10,
        category: 'zen'
      },
      zenStreak25: {
        id: 'zenStreak25',
        name: 'Zen Streak Master',
        description: 'Achieve a 25-word streak in Zen mode',
        title: 'Streak Master',
        condition: (profile) => profile.zen.bestStreak >= 25,
        category: 'zen'
      },
      zenStreak50: {
        id: 'zenStreak50',
        name: 'Zen Streak Legend',
        description: 'Achieve a 50-word streak in Zen mode',
        title: 'Streak Legend',
        condition: (profile) => profile.zen.bestStreak >= 50,
        category: 'zen'
      },
      zenStreak100: {
        id: 'zenStreak100',
        name: 'Zen Streak God',
        description: 'Achieve a 100-word streak in Zen mode',
        title: 'Streak God',
        condition: (profile) => profile.zen.bestStreak >= 100,
        category: 'zen'
      },

      // === RAID MODE ACHIEVEMENTS ===
      raider: {
        id: 'raider',
        name: 'Raider',
        description: 'Reach level 10 in Raid mode',
        title: 'Raider',
        condition: (profile) => profile.raid.highScore >= 10,
        category: 'raid'
      },
      raidMaster: {
        id: 'raidMaster',
        name: 'Raid Master',
        description: 'Reach level 25 in Raid mode',
        title: 'Raid Master',
        condition: (profile) => profile.raid.highScore >= 25,
        category: 'raid'
      },
      raidLegend: {
        id: 'raidLegend',
        name: 'Raid Legend',
        description: 'Reach level 50 in Raid mode',
        title: 'Raid Legend',
        condition: (profile) => profile.raid.highScore >= 50,
        category: 'raid'
      },
      raidGod: {
        id: 'raidGod',
        name: 'Raid God',
        description: 'Reach level 100 in Raid mode',
        title: 'Raid God',
        condition: (profile) => profile.raid.highScore >= 100,
        category: 'raid'
      },
      raidMythic: {
        id: 'raidMythic',
        name: 'Raid Mythic',
        description: 'Reach level 250 in Raid mode',
        title: 'Raid Mythic',
        condition: (profile) => profile.raid.highScore >= 250,
        category: 'raid'
      },
      raidUltimate: {
        id: 'raidUltimate',
        name: 'Raid Ultimate',
        description: 'Reach level 500 in Raid mode',
        title: 'Raid Ultimate',
        condition: (profile) => profile.raid.highScore >= 500,
        category: 'raid'
      },

      // === ARENA MODE ACHIEVEMENTS ===
      arenaEasy: {
        id: 'arenaEasy',
        name: 'Easy Arena Champion',
        description: 'Score 40+ in Easy Arena',
        title: 'Easy Champion',
        condition: (profile) => profile.arena.highScores.easy >= 40,
        category: 'arena'
      },
      arenaMedium: {
        id: 'arenaMedium',
        name: 'Medium Arena Champion',
        description: 'Score 60+ in Medium Arena',
        title: 'Medium Champion',
        condition: (profile) => profile.arena.highScores.medium >= 60,
        category: 'arena'
      },
      arenaHard: {
        id: 'arenaHard',
        name: 'Hard Arena Champion',
        description: 'Score 75+ in Hard Arena',
        title: 'Hard Champion',
        condition: (profile) => profile.arena.highScores.hard >= 75,
        category: 'arena'
      },

      // === DUEL MODE ACHIEVEMENTS ===
      duelist: {
        id: 'duelist',
        name: 'Duelist',
        description: 'Win 5 duels',
        title: 'Duelist',
        condition: (profile) => profile.duel.history.filter(duel => duel.result === 'Win').length >= 5,
        category: 'duel'
      },
      duelMaster: {
        id: 'duelMaster',
        name: 'Duel Master',
        description: 'Win 25 duels',
        title: 'Duel Master',
        condition: (profile) => profile.duel.history.filter(duel => duel.result === 'Win').length >= 25,
        category: 'duel'
      },
      duelLegend: {
        id: 'duelLegend',
        name: 'Duel Legend',
        description: 'Win 100 duels',
        title: 'Duel Legend',
        condition: (profile) => profile.duel.history.filter(duel => duel.result === 'Win').length >= 100,
        category: 'duel'
      },
      duelGod: {
        id: 'duelGod',
        name: 'Duel God',
        description: 'Win 250 duels',
        title: 'Duel God',
        condition: (profile) => profile.duel.history.filter(duel => duel.result === 'Win').length >= 250,
        category: 'duel'
      },
      duelMythic: {
        id: 'duelMythic',
        name: 'Duel Mythic',
        description: 'Win 500 duels',
        title: 'Duel Mythic',
        condition: (profile) => profile.duel.history.filter(duel => duel.result === 'Win').length >= 500,
        category: 'duel'
      },
      duelUltimate: {
        id: 'duelUltimate',
        name: 'Duel Ultimate',
        description: 'Win 1000 duels',
        title: 'Duel Ultimate',
        condition: (profile) => profile.duel.history.filter(duel => duel.result === 'Win').length >= 1000,
        category: 'duel'
      },
      highRoller: {
        id: 'highRoller',
        name: 'High Roller',
        description: 'Win a duel with 100+ gold wager',
        title: 'High Roller',
        condition: (profile) => profile.duel.history.some(duel => duel.result === 'Win' && duel.wager >= 100),
        category: 'duel'
      },
      megaRoller: {
        id: 'megaRoller',
        name: 'Mega Roller',
        description: 'Win a duel with 500+ gold wager',
        title: 'Mega Roller',
        condition: (profile) => profile.duel.history.some(duel => duel.result === 'Win' && duel.wager >= 500),
        category: 'duel'
      },
      ultraRoller: {
        id: 'ultraRoller',
        name: 'Ultra Roller',
        description: 'Win a duel with 1000+ gold wager',
        title: 'Ultra Roller',
        condition: (profile) => profile.duel.history.some(duel => duel.result === 'Win' && duel.wager >= 1000),
        category: 'duel'
      },

      // === ECONOMY ACHIEVEMENTS ===
      goldMiner: {
        id: 'goldMiner',
        name: 'Gold Miner',
        description: 'Accumulate 1000 gold',
        title: 'Miner',
        condition: (profile) => profile.gold >= 1000,
        category: 'economy'
      },
      goldCollector: {
        id: 'goldCollector',
        name: 'Gold Collector',
        description: 'Accumulate 5000 gold',
        title: 'Collector',
        condition: (profile) => profile.gold >= 5000,
        category: 'economy'
      },
      goldMaster: {
        id: 'goldMaster',
        name: 'Gold Master',
        description: 'Accumulate 10000 gold',
        title: 'Gold Master',
        condition: (profile) => profile.gold >= 10000,
        category: 'economy'
      },
      goldLegend: {
        id: 'goldLegend',
        name: 'Gold Legend',
        description: 'Accumulate 25000 gold',
        title: 'Gold Legend',
        condition: (profile) => profile.gold >= 25000,
        category: 'economy'
      },
      goldGod: {
        id: 'goldGod',
        name: 'Gold God',
        description: 'Accumulate 50000 gold',
        title: 'Gold God',
        condition: (profile) => profile.gold >= 50000,
        category: 'economy'
      },
      goldMythic: {
        id: 'goldMythic',
        name: 'Gold Mythic',
        description: 'Accumulate 100000 gold',
        title: 'Gold Mythic',
        condition: (profile) => profile.gold >= 100000,
        category: 'economy'
      },
      goldUltimate: {
        id: 'goldUltimate',
        name: 'Gold Ultimate',
        description: 'Accumulate 250000 gold',
        title: 'Gold Ultimate',
        condition: (profile) => profile.gold >= 250000,
        category: 'economy'
      },

      // === SHOP/THEME ACHIEVEMENTS ===
      themeCollector: {
        id: 'themeCollector',
        name: 'Theme Collector',
        description: 'Purchase 3 themes',
        title: 'Theme Collector',
        condition: (profile) => profile.shop.purchasedThemes.length >= 4, // Including default theme
        category: 'shop'
      },
      themeMaster: {
        id: 'themeMaster',
        name: 'Theme Master',
        description: 'Purchase 6 themes',
        title: 'Theme Master',
        condition: (profile) => profile.shop.purchasedThemes.length >= 7,
        category: 'shop'
      },
      themeLegend: {
        id: 'themeLegend',
        name: 'Theme Legend',
        description: 'Purchase all themes',
        title: 'Theme Legend',
        condition: (profile) => profile.shop.purchasedThemes.length >= 10,
        category: 'shop'
      },

      // === PERFECT LINE ACHIEVEMENTS ===
      perfectLine: {
        id: 'perfectLine',
        name: 'Perfect Line',
        description: 'Complete a perfect line (all words correct)',
        title: 'Perfect',
        condition: (profile) => profile.stats.perfectLinesCompleted >= 1,
        category: 'perfection'
      },
      perfectMaster: {
        id: 'perfectMaster',
        name: 'Perfect Master',
        description: 'Complete 10 perfect lines',
        title: 'Perfect Master',
        condition: (profile) => profile.stats.perfectLinesCompleted >= 10,
        category: 'perfection'
      },
      perfectLegend: {
        id: 'perfectLegend',
        name: 'Perfect Legend',
        description: 'Complete 50 perfect lines',
        title: 'Perfect Legend',
        condition: (profile) => profile.stats.perfectLinesCompleted >= 50,
        category: 'perfection'
      },
      perfectGod: {
        id: 'perfectGod',
        name: 'Perfect God',
        description: 'Complete 100 perfect lines',
        title: 'Perfect God',
        condition: (profile) => profile.stats.perfectLinesCompleted >= 100,
        category: 'perfection'
      },

      // === COMBO ACHIEVEMENTS ===
      comboMaster: {
        id: 'comboMaster',
        name: 'Combo Master',
        description: 'Achieve a 10x combo multiplier',
        title: 'Combo Master',
        condition: (profile) => profile.stats.maxComboAchieved >= 10,
        category: 'combo'
      },
      comboLegend: {
        id: 'comboLegend',
        name: 'Combo Legend',
        description: 'Achieve a 20x combo multiplier',
        title: 'Combo Legend',
        condition: (profile) => profile.stats.maxComboAchieved >= 20,
        category: 'combo'
      },
      comboGod: {
        id: 'comboGod',
        name: 'Combo God',
        description: 'Achieve a 50x combo multiplier',
        title: 'Combo God',
        condition: (profile) => profile.stats.maxComboAchieved >= 50,
        category: 'combo'
      },

      // === TIME-BASED ACHIEVEMENTS ===
      earlyBird: {
        id: 'earlyBird',
        name: 'Early Bird',
        description: 'Play the game for the first time',
        title: 'Early Bird',
        condition: (profile) => profile.createdAt && (Date.now() - profile.createdAt) > 0,
        category: 'time'
      },
      veteran: {
        id: 'veteran',
        name: 'Veteran',
        description: 'Play the game for 7 days',
        title: 'Veteran',
        condition: (profile) => profile.createdAt && (Date.now() - profile.createdAt) >= 7 * 24 * 60 * 60 * 1000,
        category: 'time'
      },
      oldTimer: {
        id: 'oldTimer',
        name: 'Old Timer',
        description: 'Play the game for 30 days',
        title: 'Old Timer',
        condition: (profile) => profile.createdAt && (Date.now() - profile.createdAt) >= 30 * 24 * 60 * 60 * 1000,
        category: 'time'
      },
      ancient: {
        id: 'ancient',
        name: 'Ancient',
        description: 'Play the game for 100 days',
        title: 'Ancient',
        condition: (profile) => profile.createdAt && (Date.now() - profile.createdAt) >= 100 * 24 * 60 * 60 * 1000,
        category: 'time'
      },
      immortal: {
        id: 'immortal',
        name: 'Immortal',
        description: 'Play the game for 365 days',
        title: 'Immortal',
        condition: (profile) => profile.createdAt && (Date.now() - profile.createdAt) >= 365 * 24 * 60 * 60 * 1000,
        category: 'time'
      },

      // === TOTAL LEVEL ACHIEVEMENTS ===
      totalLevel10: {
        id: 'totalLevel10',
        name: 'Apprentice',
        description: 'Reach total level 10',
        title: 'Apprentice',
        condition: (profile) => Object.values(profile.skills).reduce((sum, skill) => sum + skill.level, 0) >= 10,
        category: 'total'
      },
      totalLevel50: {
        id: 'totalLevel50',
        name: 'Journeyman',
        description: 'Reach total level 50',
        title: 'Journeyman',
        condition: (profile) => Object.values(profile.skills).reduce((sum, skill) => sum + skill.level, 0) >= 50,
        category: 'total'
      },
      totalLevel100: {
        id: 'totalLevel100',
        name: 'Expert',
        description: 'Reach total level 100',
        title: 'Expert',
        condition: (profile) => Object.values(profile.skills).reduce((sum, skill) => sum + skill.level, 0) >= 100,
        category: 'total'
      },
      totalLevel250: {
        id: 'totalLevel250',
        name: 'Master',
        description: 'Reach total level 250',
        title: 'Master',
        condition: (profile) => Object.values(profile.skills).reduce((sum, skill) => sum + skill.level, 0) >= 250,
        category: 'total'
      },
      totalLevel500: {
        id: 'totalLevel500',
        name: 'Grandmaster',
        description: 'Reach total level 500',
        title: 'Grandmaster',
        condition: (profile) => Object.values(profile.skills).reduce((sum, skill) => sum + skill.level, 0) >= 500,
        category: 'total'
      },
      totalLevel750: {
        id: 'totalLevel750',
        name: 'Legend',
        description: 'Reach total level 750',
        title: 'Legend',
        condition: (profile) => Object.values(profile.skills).reduce((sum, skill) => sum + skill.level, 0) >= 750,
        category: 'total'
      },
      totalLevel900: {
        id: 'totalLevel900',
        name: 'Mythic',
        description: 'Reach total level 900',
        title: 'Mythic',
        condition: (profile) => Object.values(profile.skills).reduce((sum, skill) => sum + skill.level, 0) >= 900,
        category: 'total'
      },

      // === SKILL COMBINATION ACHIEVEMENTS ===
      fisherCook: {
        id: 'fisherCook',
        name: 'Fisher Cook',
        description: 'Reach level 30 in both Fishing and Cooking',
        title: 'Fisher Cook',
        condition: (profile) => profile.skills.fishing.level >= 30 && profile.skills.cooking.level >= 30,
        category: 'skills'
      },
      blacksmithBuilder: {
        id: 'blacksmithBuilder',
        name: 'Blacksmith Builder',
        description: 'Reach level 40 in both Smithing and Construction',
        title: 'Blacksmith Builder',
        condition: (profile) => profile.skills.smithing.level >= 40 && profile.skills.construction.level >= 40,
        category: 'skills'
      },
      farmerWoodcutter: {
        id: 'farmerWoodcutter',
        name: 'Farmer Woodcutter',
        description: 'Reach level 35 in both Farming and Woodcutting',
        title: 'Farmer Woodcutter',
        condition: (profile) => profile.skills.farming.level >= 35 && profile.skills.woodcutting.level >= 35,
        category: 'skills'
      },
      mageWarrior: {
        id: 'mageWarrior',
        name: 'Mage Warrior',
        description: 'Reach level 45 in both Magic and Combat',
        title: 'Mage Warrior',
        condition: (profile) => profile.skills.magic.level >= 45 && profile.skills.combat.level >= 45,
        category: 'skills'
      },
      crafterPrayer: {
        id: 'crafterPrayer',
        name: 'Crafter Prayer',
        description: 'Reach level 50 in both Crafting and Prayer',
        title: 'Crafter Prayer',
        condition: (profile) => profile.skills.crafting.level >= 50 && profile.skills.prayer.level >= 50,
        category: 'skills'
      },

      // === SKILL TRIAD ACHIEVEMENTS ===
      natureTriad: {
        id: 'natureTriad',
        name: 'Nature Triad',
        description: 'Reach level 25 in Fishing, Farming, and Woodcutting',
        title: 'Nature Triad',
        condition: (profile) => profile.skills.fishing.level >= 25 && profile.skills.farming.level >= 25 && profile.skills.woodcutting.level >= 25,
        category: 'skills'
      },
      craftTriad: {
        id: 'craftTriad',
        name: 'Craft Triad',
        description: 'Reach level 30 in Smithing, Crafting, and Construction',
        title: 'Craft Triad',
        condition: (profile) => profile.skills.smithing.level >= 30 && profile.skills.crafting.level >= 30 && profile.skills.construction.level >= 30,
        category: 'skills'
      },
      combatTriad: {
        id: 'combatTriad',
        name: 'Combat Triad',
        description: 'Reach level 40 in Combat, Magic, and Prayer',
        title: 'Combat Triad',
        condition: (profile) => profile.skills.combat.level >= 40 && profile.skills.magic.level >= 40 && profile.skills.prayer.level >= 40,
        category: 'skills'
      },
      supportTriad: {
        id: 'supportTriad',
        name: 'Support Triad',
        description: 'Reach level 35 in Cooking, Crafting, and Prayer',
        title: 'Support Triad',
        condition: (profile) => profile.skills.cooking.level >= 35 && profile.skills.crafting.level >= 35 && profile.skills.prayer.level >= 35,
        category: 'skills'
      },

      // === SKILL QUADRANT ACHIEVEMENTS ===
      gathererQuad: {
        id: 'gathererQuad',
        name: 'Gatherer Quad',
        description: 'Reach level 20 in Fishing, Farming, Woodcutting, and Mining (if added)',
        title: 'Gatherer',
        condition: (profile) => profile.skills.fishing.level >= 20 && profile.skills.farming.level >= 20 && profile.skills.woodcutting.level >= 20,
        category: 'skills'
      },
      artisanQuad: {
        id: 'artisanQuad',
        name: 'Artisan Quad',
        description: 'Reach level 25 in Smithing, Crafting, Construction, and Cooking',
        title: 'Artisan',
        condition: (profile) => profile.skills.smithing.level >= 25 && profile.skills.crafting.level >= 25 && profile.skills.construction.level >= 25 && profile.skills.cooking.level >= 25,
        category: 'skills'
      },
      warriorQuad: {
        id: 'warriorQuad',
        name: 'Warrior Quad',
        description: 'Reach level 30 in Combat, Magic, Prayer, and Smithing',
        title: 'Warrior',
        condition: (profile) => profile.skills.combat.level >= 30 && profile.skills.magic.level >= 30 && profile.skills.prayer.level >= 30 && profile.skills.smithing.level >= 30,
        category: 'skills'
      },

      // === SKILL PENTAD ACHIEVEMENTS ===
      masterPentad: {
        id: 'masterPentad',
        name: 'Master Pentad',
        description: 'Reach level 50 in 5 different skills',
        title: 'Master Pentad',
        condition: (profile) => Object.values(profile.skills).filter(skill => skill.level >= 50).length >= 5,
        category: 'skills'
      },
      legendPentad: {
        id: 'legendPentad',
        name: 'Legend Pentad',
        description: 'Reach level 75 in 5 different skills',
        title: 'Legend Pentad',
        condition: (profile) => Object.values(profile.skills).filter(skill => skill.level >= 75).length >= 5,
        category: 'skills'
      },
      godPentad: {
        id: 'godPentad',
        name: 'God Pentad',
        description: 'Reach level 99 in 5 different skills',
        title: 'God Pentad',
        condition: (profile) => Object.values(profile.skills).filter(skill => skill.level >= 99).length >= 5,
        category: 'skills'
      },

      // === SKILL HEXAD ACHIEVEMENTS ===
      masterHexad: {
        id: 'masterHexad',
        name: 'Master Hexad',
        description: 'Reach level 50 in 6 different skills',
        title: 'Master Hexad',
        condition: (profile) => Object.values(profile.skills).filter(skill => skill.level >= 50).length >= 6,
        category: 'skills'
      },
      legendHexad: {
        id: 'legendHexad',
        name: 'Legend Hexad',
        description: 'Reach level 75 in 6 different skills',
        title: 'Legend Hexad',
        condition: (profile) => Object.values(profile.skills).filter(skill => skill.level >= 75).length >= 6,
        category: 'skills'
      },
      godHexad: {
        id: 'godHexad',
        name: 'God Hexad',
        description: 'Reach level 99 in 6 different skills',
        title: 'God Hexad',
        condition: (profile) => Object.values(profile.skills).filter(skill => skill.level >= 99).length >= 6,
        category: 'skills'
      },

      // === SKILL SEPTAD ACHIEVEMENTS ===
      masterSeptad: {
        id: 'masterSeptad',
        name: 'Master Septad',
        description: 'Reach level 50 in 7 different skills',
        title: 'Master Septad',
        condition: (profile) => Object.values(profile.skills).filter(skill => skill.level >= 50).length >= 7,
        category: 'skills'
      },
      legendSeptad: {
        id: 'legendSeptad',
        name: 'Legend Septad',
        description: 'Reach level 75 in 7 different skills',
        title: 'Legend Septad',
        condition: (profile) => Object.values(profile.skills).filter(skill => skill.level >= 75).length >= 7,
        category: 'skills'
      },
      godSeptad: {
        id: 'godSeptad',
        name: 'God Septad',
        description: 'Reach level 99 in 7 different skills',
        title: 'God Septad',
        condition: (profile) => Object.values(profile.skills).filter(skill => skill.level >= 99).length >= 7,
        category: 'skills'
      },

      // === SKILL OCTAD ACHIEVEMENTS ===
      masterOctad: {
        id: 'masterOctad',
        name: 'Master Octad',
        description: 'Reach level 50 in 8 different skills',
        title: 'Master Octad',
        condition: (profile) => Object.values(profile.skills).filter(skill => skill.level >= 50).length >= 8,
        category: 'skills'
      },
      legendOctad: {
        id: 'legendOctad',
        name: 'Legend Octad',
        description: 'Reach level 75 in 8 different skills',
        title: 'Legend Octad',
        condition: (profile) => Object.values(profile.skills).filter(skill => skill.level >= 75).length >= 8,
        category: 'skills'
      },
      godOctad: {
        id: 'godOctad',
        name: 'God Octad',
        description: 'Reach level 99 in 8 different skills',
        title: 'God Octad',
        condition: (profile) => Object.values(profile.skills).filter(skill => skill.level >= 99).length >= 8,
        category: 'skills'
      },

      // === SKILL NONAD ACHIEVEMENTS ===
      masterNonad: {
        id: 'masterNonad',
        name: 'Master Nonad',
        description: 'Reach level 50 in 9 different skills',
        title: 'Master Nonad',
        condition: (profile) => Object.values(profile.skills).filter(skill => skill.level >= 50).length >= 9,
        category: 'skills'
      },
      legendNonad: {
        id: 'legendNonad',
        name: 'Legend Nonad',
        description: 'Reach level 75 in 9 different skills',
        title: 'Legend Nonad',
        condition: (profile) => Object.values(profile.skills).filter(skill => skill.level >= 75).length >= 9,
        category: 'skills'
      },
      godNonad: {
        id: 'godNonad',
        name: 'God Nonad',
        description: 'Reach level 99 in 9 different skills',
        title: 'God Nonad',
        condition: (profile) => Object.values(profile.skills).filter(skill => skill.level >= 99).length >= 9,
        category: 'skills'
      },

      // === SKILL DECAD ACHIEVEMENTS ===
      masterDecad: {
        id: 'masterDecad',
        name: 'Master Decad',
        description: 'Reach level 50 in all skills',
        title: 'Master Decad',
        condition: (profile) => Object.values(profile.skills).every(skill => skill.level >= 50),
        category: 'skills'
      },
      legendDecad: {
        id: 'legendDecad',
        name: 'Legend Decad',
        description: 'Reach level 75 in all skills',
        title: 'Legend Decad',
        condition: (profile) => Object.values(profile.skills).every(skill => skill.level >= 75),
        category: 'skills'
      },
      godDecad: {
        id: 'godDecad',
        name: 'God Decad',
        description: 'Reach level 99 in all skills',
        title: 'God Decad',
        condition: (profile) => Object.values(profile.skills).every(skill => skill.level >= 99),
        category: 'skills'
      },

      // === ZEN MODE ACHIEVEMENTS ===
      zenMaster: {
        id: 'zenMaster',
        name: 'Zen Master',
        description: 'Complete 100 words in Zen mode',
        title: 'Zen Master',
        condition: (profile) => profile.zen.wordsCompleted >= 100,
        category: 'zen'
      },
      zenLegend: {
        id: 'zenLegend',
        name: 'Zen Legend',
        description: 'Complete 500 words in Zen mode',
        title: 'Zen Legend',
        condition: (profile) => profile.zen.wordsCompleted >= 500,
        category: 'zen'
      },
      zenGod: {
        id: 'zenGod',
        name: 'Zen God',
        description: 'Complete 1000 words in Zen mode',
        title: 'Zen God',
        condition: (profile) => profile.zen.wordsCompleted >= 1000,
        category: 'zen'
      },
      zenMythic: {
        id: 'zenMythic',
        name: 'Zen Mythic',
        description: 'Complete 2500 words in Zen mode',
        title: 'Zen Mythic',
        condition: (profile) => profile.zen.wordsCompleted >= 2500,
        category: 'zen'
      },
      zenUltimate: {
        id: 'zenUltimate',
        name: 'Zen Ultimate',
        description: 'Complete 5000 words in Zen mode',
        title: 'Zen Ultimate',
        condition: (profile) => profile.zen.wordsCompleted >= 5000,
        category: 'zen'
      },
      zenStreak10: {
        id: 'zenStreak10',
        name: 'Zen Streak',
        description: 'Achieve a 10-word streak in Zen mode',
        title: 'Streaker',
        condition: (profile) => profile.zen.bestStreak >= 10,
        category: 'zen'
      },
      zenStreak25: {
        id: 'zenStreak25',
        name: 'Zen Streak Master',
        description: 'Achieve a 25-word streak in Zen mode',
        title: 'Streak Master',
        condition: (profile) => profile.zen.bestStreak >= 25,
        category: 'zen'
      },
      zenStreak50: {
        id: 'zenStreak50',
        name: 'Zen Streak Legend',
        description: 'Achieve a 50-word streak in Zen mode',
        title: 'Streak Legend',
        condition: (profile) => profile.zen.bestStreak >= 50,
        category: 'zen'
      },
      zenStreak100: {
        id: 'zenStreak100',
        name: 'Zen Streak God',
        description: 'Achieve a 100-word streak in Zen mode',
        title: 'Streak God',
        condition: (profile) => profile.zen.bestStreak >= 100,
        category: 'zen'
      },

      // === RAID MODE ACHIEVEMENTS ===
      raider: {
        id: 'raider',
        name: 'Raider',
        description: 'Reach level 10 in Raid mode',
        title: 'Raider',
        condition: (profile) => profile.raid.highScore >= 10,
        category: 'raid'
      },
      raidMaster: {
        id: 'raidMaster',
        name: 'Raid Master',
        description: 'Reach level 25 in Raid mode',
        title: 'Raid Master',
        condition: (profile) => profile.raid.highScore >= 25,
        category: 'raid'
      },
      raidLegend: {
        id: 'raidLegend',
        name: 'Raid Legend',
        description: 'Reach level 50 in Raid mode',
        title: 'Raid Legend',
        condition: (profile) => profile.raid.highScore >= 50,
        category: 'raid'
      },
      raidGod: {
        id: 'raidGod',
        name: 'Raid God',
        description: 'Reach level 100 in Raid mode',
        title: 'Raid God',
        condition: (profile) => profile.raid.highScore >= 100,
        category: 'raid'
      },
      raidMythic: {
        id: 'raidMythic',
        name: 'Raid Mythic',
        description: 'Reach level 250 in Raid mode',
        title: 'Raid Mythic',
        condition: (profile) => profile.raid.highScore >= 250,
        category: 'raid'
      },
      raidUltimate: {
        id: 'raidUltimate',
        name: 'Raid Ultimate',
        description: 'Reach level 500 in Raid mode',
        title: 'Raid Ultimate',
        condition: (profile) => profile.raid.highScore >= 500,
        category: 'raid'
      },

      // === ARENA MODE ACHIEVEMENTS ===
      arenaEasy: {
        id: 'arenaEasy',
        name: 'Easy Arena Champion',
        description: 'Score 40+ in Easy Arena',
        title: 'Easy Champion',
        condition: (profile) => profile.arena.highScores.easy >= 40,
        category: 'arena'
      },
      arenaMedium: {
        id: 'arenaMedium',
        name: 'Medium Arena Champion',
        description: 'Score 60+ in Medium Arena',
        title: 'Medium Champion',
        condition: (profile) => profile.arena.highScores.medium >= 60,
        category: 'arena'
      },
      arenaHard: {
        id: 'arenaHard',
        name: 'Hard Arena Champion',
        description: 'Score 75+ in Hard Arena',
        title: 'Hard Champion',
        condition: (profile) => profile.arena.highScores.hard >= 75,
        category: 'arena'
      },

      // === DUEL MODE ACHIEVEMENTS ===
      duelist: {
        id: 'duelist',
        name: 'Duelist',
        description: 'Win 5 duels',
        title: 'Duelist',
        condition: (profile) => profile.duel.history.filter(duel => duel.result === 'Win').length >= 5,
        category: 'duel'
      },
      duelMaster: {
        id: 'duelMaster',
        name: 'Duel Master',
        description: 'Win 25 duels',
        title: 'Duel Master',
        condition: (profile) => profile.duel.history.filter(duel => duel.result === 'Win').length >= 25,
        category: 'duel'
      },
      duelLegend: {
        id: 'duelLegend',
        name: 'Duel Legend',
        description: 'Win 100 duels',
        title: 'Duel Legend',
        condition: (profile) => profile.duel.history.filter(duel => duel.result === 'Win').length >= 100,
        category: 'duel'
      },
      duelGod: {
        id: 'duelGod',
        name: 'Duel God',
        description: 'Win 250 duels',
        title: 'Duel God',
        condition: (profile) => profile.duel.history.filter(duel => duel.result === 'Win').length >= 250,
        category: 'duel'
      },
      duelMythic: {
        id: 'duelMythic',
        name: 'Duel Mythic',
        description: 'Win 500 duels',
        title: 'Duel Mythic',
        condition: (profile) => profile.duel.history.filter(duel => duel.result === 'Win').length >= 500,
        category: 'duel'
      },
      duelUltimate: {
        id: 'duelUltimate',
        name: 'Duel Ultimate',
        description: 'Win 1000 duels',
        title: 'Duel Ultimate',
        condition: (profile) => profile.duel.history.filter(duel => duel.result === 'Win').length >= 1000,
        category: 'duel'
      },
      highRoller: {
        id: 'highRoller',
        name: 'High Roller',
        description: 'Win a duel with 100+ gold wager',
        title: 'High Roller',
        condition: (profile) => profile.duel.history.some(duel => duel.result === 'Win' && duel.wager >= 100),
        category: 'duel'
      },
      megaRoller: {
        id: 'megaRoller',
        name: 'Mega Roller',
        description: 'Win a duel with 500+ gold wager',
        title: 'Mega Roller',
        condition: (profile) => profile.duel.history.some(duel => duel.result === 'Win' && duel.wager >= 500),
        category: 'duel'
      },
      ultraRoller: {
        id: 'ultraRoller',
        name: 'Ultra Roller',
        description: 'Win a duel with 1000+ gold wager',
        title: 'Ultra Roller',
        condition: (profile) => profile.duel.history.some(duel => duel.result === 'Win' && duel.wager >= 1000),
        category: 'duel'
      },

      // === ECONOMY ACHIEVEMENTS ===
      goldMiner: {
        id: 'goldMiner',
        name: 'Gold Miner',
        description: 'Accumulate 1000 gold',
        title: 'Miner',
        condition: (profile) => profile.gold >= 1000,
        category: 'economy'
      },
      goldCollector: {
        id: 'goldCollector',
        name: 'Gold Collector',
        description: 'Accumulate 5000 gold',
        title: 'Collector',
        condition: (profile) => profile.gold >= 5000,
        category: 'economy'
      },
      goldMaster: {
        id: 'goldMaster',
        name: 'Gold Master',
        description: 'Accumulate 10000 gold',
        title: 'Gold Master',
        condition: (profile) => profile.gold >= 10000,
        category: 'economy'
      },
      goldLegend: {
        id: 'goldLegend',
        name: 'Gold Legend',
        description: 'Accumulate 25000 gold',
        title: 'Gold Legend',
        condition: (profile) => profile.gold >= 25000,
        category: 'economy'
      },
      goldGod: {
        id: 'goldGod',
        name: 'Gold God',
        description: 'Accumulate 50000 gold',
        title: 'Gold God',
        condition: (profile) => profile.gold >= 50000,
        category: 'economy'
      },
      goldMythic: {
        id: 'goldMythic',
        name: 'Gold Mythic',
        description: 'Accumulate 100000 gold',
        title: 'Gold Mythic',
        condition: (profile) => profile.gold >= 100000,
        category: 'economy'
      },
      goldUltimate: {
        id: 'goldUltimate',
        name: 'Gold Ultimate',
        description: 'Accumulate 250000 gold',
        title: 'Gold Ultimate',
        condition: (profile) => profile.gold >= 250000,
        category: 'economy'
      },

      // === SHOP/THEME ACHIEVEMENTS ===
      themeCollector: {
        id: 'themeCollector',
        name: 'Theme Collector',
        description: 'Purchase 3 themes',
        title: 'Theme Collector',
        condition: (profile) => profile.shop.purchasedThemes.length >= 4, // Including default theme
        category: 'shop'
      },
      themeMaster: {
        id: 'themeMaster',
        name: 'Theme Master',
        description: 'Purchase 6 themes',
        title: 'Theme Master',
        condition: (profile) => profile.shop.purchasedThemes.length >= 7,
        category: 'shop'
      },
      themeLegend: {
        id: 'themeLegend',
        name: 'Theme Legend',
        description: 'Purchase all themes',
        title: 'Theme Legend',
        condition: (profile) => profile.shop.purchasedThemes.length >= 10,
        category: 'shop'
      },

      // === PERFECT LINE ACHIEVEMENTS ===
      perfectLine: {
        id: 'perfectLine',
        name: 'Perfect Line',
        description: 'Complete a perfect line (all words correct)',
        title: 'Perfect',
        condition: (profile) => profile.stats.perfectLinesCompleted >= 1,
        category: 'perfection'
      },
      perfectMaster: {
        id: 'perfectMaster',
        name: 'Perfect Master',
        description: 'Complete 10 perfect lines',
        title: 'Perfect Master',
        condition: (profile) => profile.stats.perfectLinesCompleted >= 10,
        category: 'perfection'
      },
      perfectLegend: {
        id: 'perfectLegend',
        name: 'Perfect Legend',
        description: 'Complete 50 perfect lines',
        title: 'Perfect Legend',
        condition: (profile) => profile.stats.perfectLinesCompleted >= 50,
        category: 'perfection'
      },
      perfectGod: {
        id: 'perfectGod',
        name: 'Perfect God',
        description: 'Complete 100 perfect lines',
        title: 'Perfect God',
        condition: (profile) => profile.stats.perfectLinesCompleted >= 100,
        category: 'perfection'
      },

      // === COMBO ACHIEVEMENTS ===
      comboMaster: {
        id: 'comboMaster',
        name: 'Combo Master',
        description: 'Achieve a 10x combo multiplier',
        title: 'Combo Master',
        condition: (profile) => profile.stats.maxComboAchieved >= 10,
        category: 'combo'
      },
      comboLegend: {
        id: 'comboLegend',
        name: 'Combo Legend',
        description: 'Achieve a 20x combo multiplier',
        title: 'Combo Legend',
        condition: (profile) => profile.stats.maxComboAchieved >= 20,
        category: 'combo'
      },
      comboGod: {
        id: 'comboGod',
        name: 'Combo God',
        description: 'Achieve a 50x combo multiplier',
        title: 'Combo God',
        condition: (profile) => profile.stats.maxComboAchieved >= 50,
        category: 'combo'
      },

      // === TIME-BASED ACHIEVEMENTS ===
      earlyBird: {
        id: 'earlyBird',
        name: 'Early Bird',
        description: 'Play the game for the first time',
        title: 'Early Bird',
        condition: (profile) => profile.createdAt && (Date.now() - profile.createdAt) > 0,
        category: 'time'
      },
      veteran: {
        id: 'veteran',
        name: 'Veteran',
        description: 'Play the game for 7 days',
        title: 'Veteran',
        condition: (profile) => profile.createdAt && (Date.now() - profile.createdAt) >= 7 * 24 * 60 * 60 * 1000,
        category: 'time'
      },
      oldTimer: {
        id: 'oldTimer',
        name: 'Old Timer',
        description: 'Play the game for 30 days',
        title: 'Old Timer',
        condition: (profile) => profile.createdAt && (Date.now() - profile.createdAt) >= 30 * 24 * 60 * 60 * 1000,
        category: 'time'
      },
      ancient: {
        id: 'ancient',
        name: 'Ancient',
        description: 'Play the game for 100 days',
        title: 'Ancient',
        condition: (profile) => profile.createdAt && (Date.now() - profile.createdAt) >= 100 * 24 * 60 * 60 * 1000,
        category: 'time'
      },
      immortal: {
        id: 'immortal',
        name: 'Immortal',
        description: 'Play the game for 365 days',
        title: 'Immortal',
        condition: (profile) => profile.createdAt && (Date.now() - profile.createdAt) >= 365 * 24 * 60 * 60 * 1000,
        category: 'time'
      },

      // === SKILL LEVEL MILESTONE ACHIEVEMENTS ===
      level10Master: {
        id: 'level10Master',
        name: 'Level 10 Master',
        description: 'Reach level 10 in all skills',
        title: 'Level 10 Master',
        condition: (profile) => Object.values(profile.skills).every(skill => skill.level >= 10),
        category: 'skills'
      },
      level20Master: {
        id: 'level20Master',
        name: 'Level 20 Master',
        description: 'Reach level 20 in all skills',
        title: 'Level 20 Master',
        condition: (profile) => Object.values(profile.skills).every(skill => skill.level >= 20),
        category: 'skills'
      },
      level30Master: {
        id: 'level30Master',
        name: 'Level 30 Master',
        description: 'Reach level 30 in all skills',
        title: 'Level 30 Master',
        condition: (profile) => Object.values(profile.skills).every(skill => skill.level >= 30),
        category: 'skills'
      },
      level40Master: {
        id: 'level40Master',
        name: 'Level 40 Master',
        description: 'Reach level 40 in all skills',
        title: 'Level 40 Master',
        condition: (profile) => Object.values(profile.skills).every(skill => skill.level >= 40),
        category: 'skills'
      },
      level60Master: {
        id: 'level60Master',
        name: 'Level 60 Master',
        description: 'Reach level 60 in all skills',
        title: 'Level 60 Master',
        condition: (profile) => Object.values(profile.skills).every(skill => skill.level >= 60),
        category: 'skills'
      },
      level80Master: {
        id: 'level80Master',
        name: 'Level 80 Master',
        description: 'Reach level 80 in all skills',
        title: 'Level 80 Master',
        condition: (profile) => Object.values(profile.skills).every(skill => skill.level >= 80),
        category: 'skills'
      },

      // === SKILL RANGE ACHIEVEMENTS ===
      lowLevelMaster: {
        id: 'lowLevelMaster',
        name: 'Low Level Master',
        description: 'Reach level 25 in all skills',
        title: 'Low Level Master',
        condition: (profile) => Object.values(profile.skills).every(skill => skill.level >= 25),
        category: 'skills'
      },
      midLevelMaster: {
        id: 'midLevelMaster',
        name: 'Mid Level Master',
        description: 'Reach level 50 in all skills',
        title: 'Mid Level Master',
        condition: (profile) => Object.values(profile.skills).every(skill => skill.level >= 50),
        category: 'skills'
      },
      highLevelMaster: {
        id: 'highLevelMaster',
        name: 'High Level Master',
        description: 'Reach level 75 in all skills',
        title: 'High Level Master',
        condition: (profile) => Object.values(profile.skills).every(skill => skill.level >= 75),
        category: 'skills'
      },





      // === SKILL PAIR ACHIEVEMENTS ===
      fisherSmith: {
        id: 'fisherSmith',
        name: 'Fisher Smith',
        description: 'Reach level 35 in both Fishing and Smithing',
        title: 'Fisher Smith',
        condition: (profile) => profile.skills.fishing.level >= 35 && profile.skills.smithing.level >= 35,
        category: 'skills'
      },
      cookFarmer: {
        id: 'cookFarmer',
        name: 'Cook Farmer',
        description: 'Reach level 40 in both Cooking and Farming',
        title: 'Cook Farmer',
        condition: (profile) => profile.skills.cooking.level >= 40 && profile.skills.farming.level >= 40,
        category: 'skills'
      },
      woodcutterBuilder: {
        id: 'woodcutterBuilder',
        name: 'Woodcutter Builder',
        description: 'Reach level 45 in both Woodcutting and Construction',
        title: 'Woodcutter Builder',
        condition: (profile) => profile.skills.woodcutting.level >= 45 && profile.skills.construction.level >= 45,
        category: 'skills'
      },
      mageCrafter: {
        id: 'mageCrafter',
        name: 'Mage Crafter',
        description: 'Reach level 55 in both Magic and Crafting',
        title: 'Mage Crafter',
        condition: (profile) => profile.skills.magic.level >= 55 && profile.skills.crafting.level >= 55,
        category: 'skills'
      },
      warriorPrayer: {
        id: 'warriorPrayer',
        name: 'Warrior Prayer',
        description: 'Reach level 60 in both Combat and Prayer',
        title: 'Warrior Prayer',
        condition: (profile) => profile.skills.combat.level >= 60 && profile.skills.prayer.level >= 60,
        category: 'skills'
      },

      // === SKILL TRIAD ACHIEVEMENTS ===
      natureTriad: {
        id: 'natureTriad',
        name: 'Nature Triad',
        description: 'Reach level 25 in Fishing, Farming, and Woodcutting',
        title: 'Nature Triad',
        condition: (profile) => profile.skills.fishing.level >= 25 && profile.skills.farming.level >= 25 && profile.skills.woodcutting.level >= 25,
        category: 'skills'
      },
      craftTriad: {
        id: 'craftTriad',
        name: 'Craft Triad',
        description: 'Reach level 30 in Smithing, Crafting, and Construction',
        title: 'Craft Triad',
        condition: (profile) => profile.skills.smithing.level >= 30 && profile.skills.crafting.level >= 30 && profile.skills.construction.level >= 30,
        category: 'skills'
      },
      combatTriad: {
        id: 'combatTriad',
        name: 'Combat Triad',
        description: 'Reach level 40 in Combat, Magic, and Prayer',
        title: 'Combat Triad',
        condition: (profile) => profile.skills.combat.level >= 40 && profile.skills.magic.level >= 40 && profile.skills.prayer.level >= 40,
        category: 'skills'
      },
      supportTriad: {
        id: 'supportTriad',
        name: 'Support Triad',
        description: 'Reach level 35 in Cooking, Crafting, and Prayer',
        title: 'Support Triad',
        condition: (profile) => profile.skills.cooking.level >= 35 && profile.skills.crafting.level >= 35 && profile.skills.prayer.level >= 35,
        category: 'skills'
      },

      // === SKILL QUADRANT ACHIEVEMENTS ===
      gathererQuad: {
        id: 'gathererQuad',
        name: 'Gatherer Quad',
        description: 'Reach level 20 in Fishing, Farming, Woodcutting, and Mining (if added)',
        title: 'Gatherer',
        condition: (profile) => profile.skills.fishing.level >= 20 && profile.skills.farming.level >= 20 && profile.skills.woodcutting.level >= 20,
        category: 'skills'
      },
      artisanQuad: {
        id: 'artisanQuad',
        name: 'Artisan Quad',
        description: 'Reach level 25 in Smithing, Crafting, Construction, and Cooking',
        title: 'Artisan',
        condition: (profile) => profile.skills.smithing.level >= 25 && profile.skills.crafting.level >= 25 && profile.skills.construction.level >= 25 && profile.skills.cooking.level >= 25,
        category: 'skills'
      },
      warriorQuad: {
        id: 'warriorQuad',
        name: 'Warrior Quad',
        description: 'Reach level 30 in Combat, Magic, Prayer, and Smithing',
        title: 'Warrior',
        condition: (profile) => profile.skills.combat.level >= 30 && profile.skills.magic.level >= 30 && profile.skills.prayer.level >= 30 && profile.skills.smithing.level >= 30,
        category: 'skills'
      },

      // === SKILL PENTAD ACHIEVEMENTS ===
      masterPentad: {
        id: 'masterPentad',
        name: 'Master Pentad',
        description: 'Reach level 50 in 5 different skills',
        title: 'Master Pentad',
        condition: (profile) => Object.values(profile.skills).filter(skill => skill.level >= 50).length >= 5,
        category: 'skills'
      },
      legendPentad: {
        id: 'legendPentad',
        name: 'Legend Pentad',
        description: 'Reach level 75 in 5 different skills',
        title: 'Legend Pentad',
        condition: (profile) => Object.values(profile.skills).filter(skill => skill.level >= 75).length >= 5,
        category: 'skills'
      },
      godPentad: {
        id: 'godPentad',
        name: 'God Pentad',
        description: 'Reach level 99 in 5 different skills',
        title: 'God Pentad',
        condition: (profile) => Object.values(profile.skills).filter(skill => skill.level >= 99).length >= 5,
        category: 'skills'
      },

      // === SKILL HEXAD ACHIEVEMENTS ===
      masterHexad: {
        id: 'masterHexad',
        name: 'Master Hexad',
        description: 'Reach level 50 in 6 different skills',
        title: 'Master Hexad',
        condition: (profile) => Object.values(profile.skills).filter(skill => skill.level >= 50).length >= 6,
        category: 'skills'
      },
      legendHexad: {
        id: 'legendHexad',
        name: 'Legend Hexad',
        description: 'Reach level 75 in 6 different skills',
        title: 'Legend Hexad',
        condition: (profile) => Object.values(profile.skills).filter(skill => skill.level >= 75).length >= 6,
        category: 'skills'
      },
      godHexad: {
        id: 'godHexad',
        name: 'God Hexad',
        description: 'Reach level 99 in 6 different skills',
        title: 'God Hexad',
        condition: (profile) => Object.values(profile.skills).filter(skill => skill.level >= 99).length >= 6,
        category: 'skills'
      },

      // === SKILL SEPTAD ACHIEVEMENTS ===
      masterSeptad: {
        id: 'masterSeptad',
        name: 'Master Septad',
        description: 'Reach level 50 in 7 different skills',
        title: 'Master Septad',
        condition: (profile) => Object.values(profile.skills).filter(skill => skill.level >= 50).length >= 7,
        category: 'skills'
      },
      legendSeptad: {
        id: 'legendSeptad',
        name: 'Legend Septad',
        description: 'Reach level 75 in 7 different skills',
        title: 'Legend Septad',
        condition: (profile) => Object.values(profile.skills).filter(skill => skill.level >= 75).length >= 7,
        category: 'skills'
      },
      godSeptad: {
        id: 'godSeptad',
        name: 'God Septad',
        description: 'Reach level 99 in 7 different skills',
        title: 'God Septad',
        condition: (profile) => Object.values(profile.skills).filter(skill => skill.level >= 99).length >= 7,
        category: 'skills'
      },

      // === SKILL OCTAD ACHIEVEMENTS ===
      masterOctad: {
        id: 'masterOctad',
        name: 'Master Octad',
        description: 'Reach level 50 in 8 different skills',
        title: 'Master Octad',
        condition: (profile) => Object.values(profile.skills).filter(skill => skill.level >= 50).length >= 8,
        category: 'skills'
      },
      legendOctad: {
        id: 'legendOctad',
        name: 'Legend Octad',
        description: 'Reach level 75 in 8 different skills',
        title: 'Legend Octad',
        condition: (profile) => Object.values(profile.skills).filter(skill => skill.level >= 75).length >= 8,
        category: 'skills'
      },
      godOctad: {
        id: 'godOctad',
        name: 'God Octad',
        description: 'Reach level 99 in 8 different skills',
        title: 'God Octad',
        condition: (profile) => Object.values(profile.skills).filter(skill => skill.level >= 99).length >= 8,
        category: 'skills'
      },

      // === SKILL NONAD ACHIEVEMENTS ===
      masterNonad: {
        id: 'masterNonad',
        name: 'Master Nonad',
        description: 'Reach level 50 in 9 different skills',
        title: 'Master Nonad',
        condition: (profile) => Object.values(profile.skills).filter(skill => skill.level >= 50).length >= 9,
        category: 'skills'
      },
      legendNonad: {
        id: 'legendNonad',
        name: 'Legend Nonad',
        description: 'Reach level 75 in 9 different skills',
        title: 'Legend Nonad',
        condition: (profile) => Object.values(profile.skills).filter(skill => skill.level >= 75).length >= 9,
        category: 'skills'
      },
      godNonad: {
        id: 'godNonad',
        name: 'God Nonad',
        description: 'Reach level 99 in 9 different skills',
        title: 'God Nonad',
        condition: (profile) => Object.values(profile.skills).filter(skill => skill.level >= 99).length >= 9,
        category: 'skills'
      },

      // === SKILL DECAD ACHIEVEMENTS ===
      masterDecad: {
        id: 'masterDecad',
        name: 'Master Decad',
        description: 'Reach level 50 in all skills',
        title: 'Master Decad',
        condition: (profile) => Object.values(profile.skills).every(skill => skill.level >= 50),
        category: 'skills'
      },
      legendDecad: {
        id: 'legendDecad',
        name: 'Legend Decad',
        description: 'Reach level 75 in all skills',
        title: 'Legend Decad',
        condition: (profile) => Object.values(profile.skills).every(skill => skill.level >= 75),
        category: 'skills'
      },
      godDecad: {
        id: 'godDecad',
        name: 'God Decad',
        description: 'Reach level 99 in all skills',
        title: 'God Decad',
        condition: (profile) => Object.values(profile.skills).every(skill => skill.level >= 99),
        category: 'skills'
      },

      // === ZEN MODE ACHIEVEMENTS ===
      zenMaster: {
        id: 'zenMaster',
        name: 'Zen Master',
        description: 'Complete 100 words in Zen mode',
        title: 'Zen Master',
        condition: (profile) => profile.zen.wordsCompleted >= 100,
        category: 'zen'
      },
      zenLegend: {
        id: 'zenLegend',
        name: 'Zen Legend',
        description: 'Complete 500 words in Zen mode',
        title: 'Zen Legend',
        condition: (profile) => profile.zen.wordsCompleted >= 500,
        category: 'zen'
      },
      zenGod: {
        id: 'zenGod',
        name: 'Zen God',
        description: 'Complete 1000 words in Zen mode',
        title: 'Zen God',
        condition: (profile) => profile.zen.wordsCompleted >= 1000,
        category: 'zen'
      },
      zenMythic: {
        id: 'zenMythic',
        name: 'Zen Mythic',
        description: 'Complete 2500 words in Zen mode',
        title: 'Zen Mythic',
        condition: (profile) => profile.zen.wordsCompleted >= 2500,
        category: 'zen'
      },
      zenUltimate: {
        id: 'zenUltimate',
        name: 'Zen Ultimate',
        description: 'Complete 5000 words in Zen mode',
        title: 'Zen Ultimate',
        condition: (profile) => profile.zen.wordsCompleted >= 5000,
        category: 'zen'
      },
      zenStreak10: {
        id: 'zenStreak10',
        name: 'Zen Streak',
        description: 'Achieve a 10-word streak in Zen mode',
        title: 'Streaker',
        condition: (profile) => profile.zen.bestStreak >= 10,
        category: 'zen'
      },
      zenStreak25: {
        id: 'zenStreak25',
        name: 'Zen Streak Master',
        description: 'Achieve a 25-word streak in Zen mode',
        title: 'Streak Master',
        condition: (profile) => profile.zen.bestStreak >= 25,
        category: 'zen'
      },
      zenStreak50: {
        id: 'zenStreak50',
        name: 'Zen Streak Legend',
        description: 'Achieve a 50-word streak in Zen mode',
        title: 'Streak Legend',
        condition: (profile) => profile.zen.bestStreak >= 50,
        category: 'zen'
      },
      zenStreak100: {
        id: 'zenStreak100',
        name: 'Zen Streak God',
        description: 'Achieve a 100-word streak in Zen mode',
        title: 'Streak God',
        condition: (profile) => profile.zen.bestStreak >= 100,
        category: 'zen'
      },

      // === RAID MODE ACHIEVEMENTS ===
      raider: {
        id: 'raider',
        name: 'Raider',
        description: 'Reach level 10 in Raid mode',
        title: 'Raider',
        condition: (profile) => profile.raid.highScore >= 10,
        category: 'raid'
      },
      raidMaster: {
        id: 'raidMaster',
        name: 'Raid Master',
        description: 'Reach level 25 in Raid mode',
        title: 'Raid Master',
        condition: (profile) => profile.raid.highScore >= 25,
        category: 'raid'
      },
      raidLegend: {
        id: 'raidLegend',
        name: 'Raid Legend',
        description: 'Reach level 50 in Raid mode',
        title: 'Raid Legend',
        condition: (profile) => profile.raid.highScore >= 50,
        category: 'raid'
      },
      raidGod: {
        id: 'raidGod',
        name: 'Raid God',
        description: 'Reach level 100 in Raid mode',
        title: 'Raid God',
        condition: (profile) => profile.raid.highScore >= 100,
        category: 'raid'
      },
      raidMythic: {
        id: 'raidMythic',
        name: 'Raid Mythic',
        description: 'Reach level 250 in Raid mode',
        title: 'Raid Mythic',
        condition: (profile) => profile.raid.highScore >= 250,
        category: 'raid'
      },
      raidUltimate: {
        id: 'raidUltimate',
        name: 'Raid Ultimate',
        description: 'Reach level 500 in Raid mode',
        title: 'Raid Ultimate',
        condition: (profile) => profile.raid.highScore >= 500,
        category: 'raid'
      },

      // === ARENA MODE ACHIEVEMENTS ===
      arenaEasy: {
        id: 'arenaEasy',
        name: 'Easy Arena Champion',
        description: 'Score 40+ in Easy Arena',
        title: 'Easy Champion',
        condition: (profile) => profile.arena.highScores.easy >= 40,
        category: 'arena'
      },
      arenaMedium: {
        id: 'arenaMedium',
        name: 'Medium Arena Champion',
        description: 'Score 60+ in Medium Arena',
        title: 'Medium Champion',
        condition: (profile) => profile.arena.highScores.medium >= 60,
        category: 'arena'
      },
      arenaHard: {
        id: 'arenaHard',
        name: 'Hard Arena Champion',
        description: 'Score 75+ in Hard Arena',
        title: 'Hard Champion',
        condition: (profile) => profile.arena.highScores.hard >= 75,
        category: 'arena'
      },

      // === DUEL MODE ACHIEVEMENTS ===
      duelist: {
        id: 'duelist',
        name: 'Duelist',
        description: 'Win 5 duels',
        title: 'Duelist',
        condition: (profile) => profile.duel.history.filter(duel => duel.result === 'Win').length >= 5,
        category: 'duel'
      },
      duelMaster: {
        id: 'duelMaster',
        name: 'Duel Master',
        description: 'Win 25 duels',
        title: 'Duel Master',
        condition: (profile) => profile.duel.history.filter(duel => duel.result === 'Win').length >= 25,
        category: 'duel'
      },
      duelLegend: {
        id: 'duelLegend',
        name: 'Duel Legend',
        description: 'Win 100 duels',
        title: 'Duel Legend',
        condition: (profile) => profile.duel.history.filter(duel => duel.result === 'Win').length >= 100,
        category: 'duel'
      },
      duelGod: {
        id: 'duelGod',
        name: 'Duel God',
        description: 'Win 250 duels',
        title: 'Duel God',
        condition: (profile) => profile.duel.history.filter(duel => duel.result === 'Win').length >= 250,
        category: 'duel'
      },
      duelMythic: {
        id: 'duelMythic',
        name: 'Duel Mythic',
        description: 'Win 500 duels',
        title: 'Duel Mythic',
        condition: (profile) => profile.duel.history.filter(duel => duel.result === 'Win').length >= 500,
        category: 'duel'
      },
      duelUltimate: {
        id: 'duelUltimate',
        name: 'Duel Ultimate',
        description: 'Win 1000 duels',
        title: 'Duel Ultimate',
        condition: (profile) => profile.duel.history.filter(duel => duel.result === 'Win').length >= 1000,
        category: 'duel'
      },
      highRoller: {
        id: 'highRoller',
        name: 'High Roller',
        description: 'Win a duel with 100+ gold wager',
        title: 'High Roller',
        condition: (profile) => profile.duel.history.some(duel => duel.result === 'Win' && duel.wager >= 100),
        category: 'duel'
      },
      megaRoller: {
        id: 'megaRoller',
        name: 'Mega Roller',
        description: 'Win a duel with 500+ gold wager',
        title: 'Mega Roller',
        condition: (profile) => profile.duel.history.some(duel => duel.result === 'Win' && duel.wager >= 500),
        category: 'duel'
      },
      ultraRoller: {
        id: 'ultraRoller',
        name: 'Ultra Roller',
        description: 'Win a duel with 1000+ gold wager',
        title: 'Ultra Roller',
        condition: (profile) => profile.duel.history.some(duel => duel.result === 'Win' && duel.wager >= 1000),
        category: 'duel'
      },

      // === ECONOMY ACHIEVEMENTS ===
      goldMiner: {
        id: 'goldMiner',
        name: 'Gold Miner',
        description: 'Accumulate 1000 gold',
        title: 'Miner',
        condition: (profile) => profile.gold >= 1000,
        category: 'economy'
      },
      goldCollector: {
        id: 'goldCollector',
        name: 'Gold Collector',
        description: 'Accumulate 5000 gold',
        title: 'Collector',
        condition: (profile) => profile.gold >= 5000,
        category: 'economy'
      },
      goldMaster: {
        id: 'goldMaster',
        name: 'Gold Master',
        description: 'Accumulate 10000 gold',
        title: 'Gold Master',
        condition: (profile) => profile.gold >= 10000,
        category: 'economy'
      },
      goldLegend: {
        id: 'goldLegend',
        name: 'Gold Legend',
        description: 'Accumulate 25000 gold',
        title: 'Gold Legend',
        condition: (profile) => profile.gold >= 25000,
        category: 'economy'
      },
      goldGod: {
        id: 'goldGod',
        name: 'Gold God',
        description: 'Accumulate 50000 gold',
        title: 'Gold God',
        condition: (profile) => profile.gold >= 50000,
        category: 'economy'
      },
      goldMythic: {
        id: 'goldMythic',
        name: 'Gold Mythic',
        description: 'Accumulate 100000 gold',
        title: 'Gold Mythic',
        condition: (profile) => profile.gold >= 100000,
        category: 'economy'
      },
      goldUltimate: {
        id: 'goldUltimate',
        name: 'Gold Ultimate',
        description: 'Accumulate 250000 gold',
        title: 'Gold Ultimate',
        condition: (profile) => profile.gold >= 250000,
        category: 'economy'
      },

      // === SHOP/THEME ACHIEVEMENTS ===
      themeCollector: {
        id: 'themeCollector',
        name: 'Theme Collector',
        description: 'Purchase 3 themes',
        title: 'Theme Collector',
        condition: (profile) => profile.shop.purchasedThemes.length >= 4, // Including default theme
        category: 'shop'
      },
      themeMaster: {
        id: 'themeMaster',
        name: 'Theme Master',
        description: 'Purchase 6 themes',
        title: 'Theme Master',
        condition: (profile) => profile.shop.purchasedThemes.length >= 7,
        category: 'shop'
      },
      themeLegend: {
        id: 'themeLegend',
        name: 'Theme Legend',
        description: 'Purchase all themes',
        title: 'Theme Legend',
        condition: (profile) => profile.shop.purchasedThemes.length >= 10,
        category: 'shop'
      },

      // === PERFECT LINE ACHIEVEMENTS ===
      perfectLine: {
        id: 'perfectLine',
        name: 'Perfect Line',
        description: 'Complete a perfect line (all words correct)',
        title: 'Perfect',
        condition: (profile) => profile.stats.perfectLinesCompleted >= 1,
        category: 'perfection'
      },
      perfectMaster: {
        id: 'perfectMaster',
        name: 'Perfect Master',
        description: 'Complete 10 perfect lines',
        title: 'Perfect Master',
        condition: (profile) => profile.stats.perfectLinesCompleted >= 10,
        category: 'perfection'
      },
      perfectLegend: {
        id: 'perfectLegend',
        name: 'Perfect Legend',
        description: 'Complete 50 perfect lines',
        title: 'Perfect Legend',
        condition: (profile) => profile.stats.perfectLinesCompleted >= 50,
        category: 'perfection'
      },
      perfectGod: {
        id: 'perfectGod',
        name: 'Perfect God',
        description: 'Complete 100 perfect lines',
        title: 'Perfect God',
        condition: (profile) => profile.stats.perfectLinesCompleted >= 100,
        category: 'perfection'
      },

      // === COMBO ACHIEVEMENTS ===
      comboMaster: {
        id: 'comboMaster',
        name: 'Combo Master',
        description: 'Achieve a 10x combo multiplier',
        title: 'Combo Master',
        condition: (profile) => profile.stats.maxComboAchieved >= 10,
        category: 'combo'
      },
      comboLegend: {
        id: 'comboLegend',
        name: 'Combo Legend',
        description: 'Achieve a 20x combo multiplier',
        title: 'Combo Legend',
        condition: (profile) => profile.stats.maxComboAchieved >= 20,
        category: 'combo'
      },
      comboGod: {
        id: 'comboGod',
        name: 'Combo God',
        description: 'Achieve a 50x combo multiplier',
        title: 'Combo God',
        condition: (profile) => profile.stats.maxComboAchieved >= 50,
        category: 'combo'
      },

      // === TIME-BASED ACHIEVEMENTS ===
      earlyBird: {
        id: 'earlyBird',
        name: 'Early Bird',
        description: 'Play the game for the first time',
        title: 'Early Bird',
        condition: (profile) => profile.createdAt && (Date.now() - profile.createdAt) > 0,
        category: 'time'
      },
      veteran: {
        id: 'veteran',
        name: 'Veteran',
        description: 'Play the game for 7 days',
        title: 'Veteran',
        condition: (profile) => profile.createdAt && (Date.now() - profile.createdAt) >= 7 * 24 * 60 * 60 * 1000,
        category: 'time'
      },
      oldTimer: {
        id: 'oldTimer',
        name: 'Old Timer',
        description: 'Play the game for 30 days',
        title: 'Old Timer',
        condition: (profile) => profile.createdAt && (Date.now() - profile.createdAt) >= 30 * 24 * 60 * 60 * 1000,
        category: 'time'
      },
      ancient: {
        id: 'ancient',
        name: 'Ancient',
        description: 'Play the game for 100 days',
        title: 'Ancient',
        condition: (profile) => profile.createdAt && (Date.now() - profile.createdAt) >= 100 * 24 * 60 * 60 * 1000,
        category: 'time'
      },
      immortal: {
        id: 'immortal',
        name: 'Immortal',
        description: 'Play the game for 365 days',
        title: 'Immortal',
        condition: (profile) => profile.createdAt && (Date.now() - profile.createdAt) >= 365 * 24 * 60 * 60 * 1000,
        category: 'time'
      }
    };

    const defaultSettings = {
      headingFont: "'Uncial Antiqua', serif",
      mainFont: "Roboto, Arial, sans-serif",
      uiScale: 1,
      fontSize: 1,
      musicEnabled: true,
      musicVolume: 0.5
    };

    let profile = loadJson(STORAGE_KEYS.profile, defaultProfile);
    let settings = loadJson(STORAGE_KEYS.settings, defaultSettings);

    function loadJson(key, fallback) {
      try { return { ...structuredClone(fallback), ...JSON.parse(localStorage.getItem(key) || '{}') }; }
      catch { return structuredClone(fallback); }
    }
    function saveProfile(){ 
      localStorage.setItem(STORAGE_KEYS.profile, JSON.stringify(profile)); 
    }
    function saveSettings(){ localStorage.setItem(STORAGE_KEYS.settings, JSON.stringify(settings)); }

    // Achievement system functions
    function checkAchievements() {
      let newAchievements = [];
      let newTitles = [];
      
      Object.values(achievements).forEach(achievement => {
        // Skip if already unlocked
        if (profile.achievements.unlocked.includes(achievement.id)) return;
        
        // Check if achievement condition is met
        if (achievement.condition(profile)) {
          profile.achievements.unlocked.push(achievement.id);
          newAchievements.push(achievement);
          
          // Add title if not already present
          if (!profile.achievements.titles.includes(achievement.title)) {
            profile.achievements.titles.push(achievement.title);
            newTitles.push(achievement.title);
            
            // Auto-select the first title if no title is currently selected
            if (profile.achievements.selectedTitle === null) {
              profile.achievements.selectedTitle = achievement.title;
            }
          }
        }
      });
      
      // Save profile if achievements were unlocked
      if (newAchievements.length > 0) {
        saveProfile();
        updateProfileDisplay();
        
        // Show achievement notification
        showAchievementNotification(newAchievements);
      }
      
      return { newAchievements, newTitles };
    }
    
    function showAchievementNotification(achievements) {
      // Create notification element
      const notification = document.createElement('div');
      notification.style.cssText = `
        position: fixed;
        top: 20px;
        right: 20px;
        background: var(--panel-bg);
        border: 2px solid var(--accent-correct);
        border-radius: 8px;
        padding: 1rem;
        color: var(--text-color);
        z-index: 1000;
        max-width: 300px;
        box-shadow: 0 4px 12px rgba(0,0,0,0.3);
        animation: slideIn 0.5s ease-out;
      `;
      
      let html = '<div style="color: var(--accent-correct); font-weight: bold; margin-bottom: 0.5rem;">üèÜ Achievement Unlocked!</div>';
      achievements.forEach(achievement => {
        html += `
          <div style="margin-bottom: 0.5rem;">
            <strong>${achievement.name}</strong><br>
            <span style="font-size: 0.9rem; color: var(--muted);">${achievement.description}</span><br>
            <span style="color: var(--accent-correct); font-weight: bold;">Title: ${achievement.title}</span>
          </div>
        `;
      });
      
      notification.innerHTML = html;
      document.body.appendChild(notification);
      
      // Remove notification after 5 seconds
      setTimeout(() => {
        if (notification.parentNode) {
          notification.parentNode.removeChild(notification);
        }
      }, 5000);
    }
    
    function getCurrentTitle() {
      if (!profile || !profile.achievements || profile.achievements.titles.length === 0) return '';
      
      // If selectedTitle is explicitly null, return empty string (No Title selected)
      if (profile.achievements.selectedTitle === null) return '';
      
      // Return the selected title if one is chosen, otherwise the most recent title
      return profile.achievements.selectedTitle || profile.achievements.titles[profile.achievements.titles.length - 1];
    }
    
    function selectTitle(title) {
      // Allow null for "No Title" option, or check if title exists in unlocked titles
      if (title !== null && !profile.achievements.titles.includes(title)) return;
      
      // Set the selected title (can be null)
      profile.achievements.selectedTitle = title;
      
      // Save the profile and update the display
      saveProfile();
      updateProfileDisplay();
      
      // Re-render the achievements page to show the updated selection
      renderAchievements();
    }
    

    
                       function renderAchievements() {
                     const titleSelectionList = document.getElementById('titleSelectionList');
                     const unlockedList = document.getElementById('unlockedList');
                     const lockedList = document.getElementById('lockedList');
      
      // Render title selection list
      if (titleSelectionList) {
        titleSelectionList.innerHTML = '';
        // Add "No Title" option
        const noTitleOption = document.createElement('div');
        noTitleOption.className = `title-option ${!profile.achievements.selectedTitle ? 'selected' : ''}`;
        noTitleOption.textContent = 'No Title';
        noTitleOption.onclick = () => selectTitle(null);
        titleSelectionList.appendChild(noTitleOption);
        
        if (profile.achievements.titles.length > 0) {
          profile.achievements.titles.forEach(title => {
            const titleOption = document.createElement('div');
            titleOption.className = `title-option ${title === profile.achievements.selectedTitle ? 'selected' : ''}`;
            titleOption.textContent = title;
            titleOption.onclick = () => selectTitle(title);
            titleSelectionList.appendChild(titleOption);
          });
        } else {
          titleSelectionList.appendChild(document.createElement('div')).innerHTML = '<div style="color: var(--muted); font-style: italic;">No titles unlocked yet</div>';
        }
      }
      
      unlockedList.innerHTML = '';
      lockedList.innerHTML = '';
      
      Object.values(achievements).forEach(achievement => {
        const isUnlocked = profile.achievements.unlocked.includes(achievement.id);
        const list = isUnlocked ? unlockedList : lockedList;
        
        const achievementItem = document.createElement('div');
        achievementItem.className = `achievement-item ${isUnlocked ? 'unlocked' : 'locked'}`;
        
        const icon = isUnlocked ? 'üèÜ' : 'üîí';
        const titleText = isUnlocked ? `Title: ${achievement.title}` : `Unlock: ${achievement.title}`;
        
        achievementItem.innerHTML = `
          <div class="achievement-icon">${icon}</div>
          <div class="achievement-info">
            <div class="achievement-name">${achievement.name}</div>
            <div class="achievement-description">${achievement.description}</div>
            <div class="achievement-title">${titleText}</div>
          </div>
        `;
        
        list.appendChild(achievementItem);
      });
      
      // Show message if no achievements unlocked
      if (unlockedList.children.length === 0) {
        unlockedList.innerHTML = '<div style="text-align: center; color: var(--muted); padding: 1rem;">No achievements unlocked yet. Keep playing to earn titles!</div>';
      }
    }

    // Theme catalog
    const themeCatalog = {
      themeDarkSteel:     { name: 'Dark Steel',     price: 0,     swatch: ['#111','#222','#8a1f11'] },
      themeAmethystNight: { name: 'Amethyst Night', price: 1000,  swatch: ['#1d0f2b','#2d1f2d','#7a5f7a'] },
      themeNeonGrid:      { name: 'Neon Grid',      price: 2500,  swatch: ['#000','#141428','#00ffff'] },
      themeRoseTwilight:  { name: 'Rose Twilight',  price: 5000,  swatch: ['#2f1e2e','#603050','#cc1166'] },
      themeOceanMist:     { name: 'Ocean Mist',     price: 10000, swatch: ['#1e2f2f','#225f5f','#44ffff'] },
      themeForestGrove:   { name: 'Forest Grove',   price: 20000, swatch: ['#1e2d1b','#3e4d3e','#66bb6a'] },
      themeCrimsonSunset: { name: 'Crimson Sunset', price: 40000, swatch: ['#2d0b0b','#661a1a','#ff3300'] },
      themeFrostbyte:     { name: 'Frostbyte',      price: 75000, swatch: ['#0b1f26','#12313a','#8be7ff'] },
      themeSolarFlare:    { name: 'Solar Flare',    price: 150000, swatch: ['#1b130c','#2d2219','#ffb74d'] },
      themeMidnightRoyal: { name: 'Midnight Royal', price: 500000, swatch: ['#0d1b2a','#14213d','#f0a500'] }
    };


    // Apply theme variables
    function applyTheme(themeKey) {
      const setVars = ({bg,panel,header,correct,incorrect,pbg,pbar,btn,hover,inbg,intext}) => {
        const r = document.documentElement.style;
        r.setProperty('--bg-color', bg);
        r.setProperty('--panel-bg', panel);
        r.setProperty('--header-text', header);
        r.setProperty('--accent-correct', correct);
        r.setProperty('--accent-incorrect', incorrect);
        r.setProperty('--progress-bg', pbg);
        r.setProperty('--progress-bar', pbar);
        r.setProperty('--button-bg', btn);
        r.setProperty('--button-hover', hover);
        r.setProperty('--input-bg', inbg);
        r.setProperty('--input-text', intext);
      };
      switch (themeKey) {
        case 'themeDarkSteel': setVars({ bg:'#111',panel:'rgba(0,0,0,.8)',header:'#ccc',correct:'#3d7d52',incorrect:'#a94442',pbg:'#333',pbar:'#8a1f11',btn:'#222',hover:'#333',inbg:'#1a1a1a',intext:'#ccc' }); break;
        case 'themeAmethystNight': setVars({ bg:'#1d0f2b',panel:'rgba(29,15,43,.8)',header:'#c1a3d6',correct:'#4a6c4a',incorrect:'#a67d7d',pbg:'#3d2c3d',pbar:'#7a5f7a',btn:'#2d1f2d',hover:'#443244',inbg:'#1a0f1a',intext:'#c1a3d6' }); break;
        case 'themeNeonGrid': setVars({ bg:'#000',panel:'rgba(20,20,40,.9)',header:'#0ff',correct:'#0f0',incorrect:'#f00',pbg:'#222',pbar:'#0ff',btn:'#111',hover:'#333',inbg:'#111',intext:'#0ff' }); break;
        case 'themeRoseTwilight': setVars({ bg:'#2f1e2e',panel:'rgba(40,0,40,.7)',header:'#e4c9c9',correct:'#ffcc00',incorrect:'#ff2255',pbg:'#603050',pbar:'#cc1166',btn:'#603050',hover:'#804060',inbg:'#502040',intext:'#f8f8f2' }); break;
        case 'themeOceanMist': setVars({ bg:'#1e2f2f',panel:'rgba(0,40,40,.7)',header:'#a0ffff',correct:'#33ffaa',incorrect:'#ff3333',pbg:'#116666',pbar:'#44ffff',btn:'#225f5f',hover:'#337f7f',inbg:'#114040',intext:'#ccffff' }); break;
        case 'themeForestGrove': setVars({ bg:'#1e2d1b',panel:'rgba(30,45,27,.8)',header:'#d0e0c0',correct:'#7cb342',incorrect:'#c62828',pbg:'#2e3b2e',pbar:'#66bb6a',btn:'#3e4d3e',hover:'#546e54',inbg:'#2e3b2e',intext:'#d0e0c0' }); break;
        case 'themeCrimsonSunset': setVars({ bg:'#2d0b0b',panel:'rgba(60,10,10,.85)',header:'#ffcccc',correct:'#ff6600',incorrect:'#cc0000',pbg:'#802020',pbar:'#ff3300',btn:'#661a1a',hover:'#992222',inbg:'#4d0f0f',intext:'#ffcccc' }); break;
        case 'themeFrostbyte': setVars({ bg:'#0b1f26',panel:'rgba(18,40,48,.88)',header:'#d9f4ff',correct:'#7bdcf0',incorrect:'#ff6b6b',pbg:'#16333d',pbar:'#8be7ff',btn:'#12313a',hover:'#184350',inbg:'#102930',intext:'#d9f4ff' }); break;
        case 'themeSolarFlare': setVars({ bg:'#1b130c',panel:'rgba(36,25,16,.9)',header:'#ffe6cc',correct:'#ffd166',incorrect:'#ff7f66',pbg:'#2a2018',pbar:'#ffb74d',btn:'#2d2219',hover:'#3a2b20',inbg:'#241a12',intext:'#ffe6cc' }); break;
        case 'themeMidnightRoyal': setVars({ bg:'#0d1b2a',panel:'rgba(13,27,42,.9)',header:'#e0c097',correct:'#ffd700',incorrect:'#ff4500',pbg:'#1b263b',pbar:'#f0a500',btn:'#14213d',hover:'#1f4068',inbg:'#1b263b',intext:'#e0c097' }); break;
      }
    }

    

    function applySettings() {
      document.documentElement.style.setProperty('--heading-font', settings.headingFont);
      document.documentElement.style.setProperty('--main-font', settings.mainFont);
      document.documentElement.style.setProperty('--ui-scale', settings.uiScale);
      document.body.style.fontSize = `calc(1rem * ${settings.fontSize})`;
      applyTheme(profile.shop.activeTheme);
      saveSettings();
      bgm.volume = settings.musicVolume;
      if (settings.musicEnabled) bgm.play().catch(()=>{});
      else bgm.pause();
    }

    // DOM refs
    const screens = {
      startup: document.getElementById('startupScreen'),
      home: document.getElementById('homeScreen'),
      game: document.getElementById('gameScreen'),
      raid: document.getElementById('raidScreen'),
      arena: document.getElementById('arenaScreen'),
      duel: document.getElementById('duelScreen'),
      zen: document.getElementById('zenScreen'),
      shop: document.getElementById('shopScreen'),
      achievements: document.getElementById('achievementsScreen'),
      options: document.getElementById('optionsScreen')
    };
    const skillButtonsContainer = document.getElementById('skillButtonsContainer');
    const avgWPMValue = document.getElementById('avgWPMValue');
    const totalLevelValue = document.getElementById('totalLevelValue');
    const goldValue = document.getElementById('goldValue');

    // Game UI
    const skillTitle = document.getElementById('skillTitle');
    const gameSkillProgressBar = document.getElementById('gameSkillProgressBar');
    const skillLevel = document.getElementById('skillLevel');
    const wpmDisplay = document.getElementById('wpmDisplay');
    const wordBox = document.getElementById('wordBox');
    const typedInput = document.getElementById('typedInput');
    const comboDisplay = document.getElementById('comboDisplay');
    const lineBonusDisplay = document.getElementById('lineBonusDisplay');

    // Raid UI
    const raidLevelElem = document.getElementById('raidLevel');
    const raidHighScoreElem = document.getElementById('raidHighScore');
    const raidErrorsElem = document.getElementById('raidErrors');
    const raidWordBox = document.getElementById('raidWordBox');
    const raidInput = document.getElementById('raidInput');

    // Arena UI
    const arenaScoreElem = document.getElementById('arenaScore');
    const arenaHighScoreElem = document.getElementById('arenaHighScore');
    const arenaTimerElem = document.getElementById('arenaTimer');
    const arenaBoard = document.getElementById('arenaBoard');
    const arenaDifficultySelect = document.getElementById('arenaDifficultySelect');
    
    // Update high score display when difficulty changes
    arenaDifficultySelect.addEventListener('change', () => {
      const diff = arenaDifficultySelect.value;
      arenaHighScoreElem.textContent = profile.arena.highScores[diff] || 0;
    });

    // Duel UI
    const duelGoldDisplay = document.getElementById('duelGoldDisplay');
    const duelWagerInput = document.getElementById('duelWagerInput');
    const startDuelBtn = document.getElementById('startDuelBtn');
    const duelCombatArea = document.getElementById('duelCombatArea');
    const playerHPSpan = document.getElementById('playerHP');
    const opponentHPSpan = document.getElementById('opponentHP');
    const duelLog = document.getElementById('duelLog');
    const duelResult = document.getElementById('duelResult');
    const duelHistoryTable = document.getElementById('duelHistoryTable');

    // Zen UI
    const zenWordsCompletedElem = document.getElementById('zenWordsCompleted');
    const zenStreakElem = document.getElementById('zenStreak');
    const zenBestStreakElem = document.getElementById('zenBestStreak');
    const zenWordBox = document.getElementById('zenWordBox');
    const zenInput = document.getElementById('zenInput');

    // Options UI
    const optionsBtn = document.getElementById('optionsBtn');
    const headingFontSelect = document.getElementById('headingFontSelect');
    const mainFontSelect = document.getElementById('mainFontSelect');
    const uiScaleRange = document.getElementById('uiScaleRange');
    const fontSizeRange = document.getElementById('fontSizeRange');
    const musicEnabledEl = document.getElementById('musicEnabled');
    const musicVolumeEl = document.getElementById('musicVolume');
    const saveSettingsBtn = document.getElementById('saveSettingsBtn');

    // Shop UI
    const shopBtn = document.getElementById('shopBtn');
    const themeCards = document.getElementById('themeCards');

    // Navigation

    document.getElementById('raidBtn').addEventListener('click', () => { showScreen('raid'); initRaid(); });
    document.getElementById('arenaBtn').addEventListener('click', () => { showScreen('arena'); resetArenaUI(); });
    document.getElementById('duelBtn').addEventListener('click', () => { showScreen('duel'); initDuelUI(); });
    document.getElementById('zenBtn').addEventListener('click', () => { showScreen('zen'); initZen(); });
    shopBtn.addEventListener('click', () => { showScreen('shop'); renderShop(); });

    // Profile management event listeners
    document.getElementById('createProfileBtn').addEventListener('click', () => {
      const name = document.getElementById('profileNameInput').value.trim();
      if (createProfile(name)) {
        showScreen('home');
        updateProfileDisplay();
        renderHome();
      }
    });
    

    
    // Reset profile button
    document.getElementById('resetProfileBtn').addEventListener('click', resetProfile);
    
    // Profile name input enter key support
    document.getElementById('profileNameInput').addEventListener('keydown', (e) => {
      if (e.key === 'Enter') {
        document.getElementById('createProfileBtn').click();
      }
    });

    function showScreen(key) {
      // Clean up Arena timers if switching away from Arena
      if (arenaTimer || spawnTimer) {
        clearInterval(arenaTimer);
        clearInterval(spawnTimer);
        arenaTimer = null;
        spawnTimer = null;
        
        // Save current score if Arena was active
        if (arenaScore > 0) {
          const diff = arenaDifficultySelect.value;
          if (arenaScore > (profile.arena.highScores[diff] || 0)) {
            profile.arena.highScores[diff] = arenaScore;
            saveProfile();
          }
        }
      }
      
      Object.values(screens).forEach(s => s.classList.remove('active'));
      screens[key].classList.add('active');
      
      if (key === 'home') renderHome();
      if (key === 'startup') renderStartupScreen();
    }

    // Achievements
    document.getElementById('achievementsBtn').addEventListener('click', () => { 
      showScreen('achievements'); 
      renderAchievements(); 
    });
    
    // Options
    optionsBtn.addEventListener('click', () => { 
      showScreen('options'); 
      openOptions(); 
    });
    saveSettingsBtn.addEventListener('click', saveOptions);

    function openOptions() {
      headingFontSelect.value = settings.headingFont;
      mainFontSelect.value = settings.mainFont;
      uiScaleRange.value = settings.uiScale;
      fontSizeRange.value = settings.fontSize;
      musicEnabledEl.checked = settings.musicEnabled;
      musicVolumeEl.value = settings.musicVolume;
    }
    function saveOptions() {
      settings.headingFont = headingFontSelect.value;
      settings.mainFont = mainFontSelect.value;
      settings.uiScale = +uiScaleRange.value;
      settings.fontSize = +fontSizeRange.value;
      settings.musicEnabled = musicEnabledEl.checked;
      settings.musicVolume = parseFloat(musicVolumeEl.value);
      applySettings();
      showScreen('home');
    }

    // Home
    function computeTotalLevel(){ return Object.values(profile.skills).reduce((s, sk)=> s + (sk.level||1), 0); }
    function renderHome() {
      const { totalSetsCompleted, totalWPMAccumulated } = profile.stats;
      const avg = totalSetsCompleted ? Math.round(totalWPMAccumulated / totalSetsCompleted) : 0;
      avgWPMValue.textContent = avg;
      totalLevelValue.textContent = computeTotalLevel();
      goldValue.textContent = profile.gold;
      
      // Check for achievements when home screen is rendered
      checkAchievements();

      skillButtonsContainer.innerHTML = '';
      Object.entries(profile.skills).forEach(([key, s]) => {
        const btn = document.createElement('button');
        btn.className = 'skill-button';
        btn.setAttribute('aria-label', `Open ${s.name}`);
        btn.innerHTML = `
          <div class="skill-title">${s.name}</div>
          <div class="progress-container"><div class="progress-bar" style="width:${(s.currentXP/s.nextLevelXP)*100 || 0}%;"></div></div>
          <div class="level-text">Level: ${s.level}/99</div>
        `;
        btn.addEventListener('click', () => startSkill(key));
        skillButtonsContainer.appendChild(btn);
      });
      updateDuelGoldDisplay();
    }

    // Particles
    const pCanvas = document.getElementById('particleCanvas');
    const pCtx = pCanvas.getContext('2d');
    function resizeCanvas(){ pCanvas.width = innerWidth; pCanvas.height = innerHeight; }
    addEventListener('resize', resizeCanvas); resizeCanvas();
    const particles = [];
    class Particle{
      constructor(x,y,vx,vy,size,life){ this.x=x; this.y=y; this.vx=vx; this.vy=vy; this.size=size; this.life=life; this.max=life; }
      update(){ this.x+=this.vx; this.y+=this.vy; this.life--; }
      draw(){ pCtx.globalAlpha = this.life/this.max; pCtx.fillStyle='#ffcc00'; pCtx.beginPath(); pCtx.arc(this.x,this.y,this.size,0,Math.PI*2); pCtx.fill(); pCtx.globalAlpha=1; }
    }
    function triggerParticlesAt(el) {
      const r = el.getBoundingClientRect();
      const x = r.left + r.width/2, y = r.top + r.height/2;
      for (let i=0;i<20;i++){
        const a = Math.random()*Math.PI*2, sp = Math.random()*3;
        particles.push(new Particle(x,y,Math.cos(a)*sp,Math.sin(a)*sp,Math.random()*3+2,Math.random()*30+30));
      }
    }
    (function loop(){
      pCtx.clearRect(0,0,pCanvas.width,pCanvas.height);
      for (let i=particles.length-1;i>=0;i--){
        const p = particles[i]; p.update(); p.draw(); if (p.life<=0) particles.splice(i,1);
      }
      requestAnimationFrame(loop);
    })();

    // Background music (song.mp3) with user gesture unlock
    const bgm = new Audio('song.mp3');
bgm.loop = true;
bgm.preload = 'auto';

// Audio unlock is now handled by startBackgroundMusic() when profiles are loaded
// The unlockBgm function is kept for compatibility but won't be called automatically
function unlockBgm() {
  bgm.volume = settings.musicVolume;
  if (settings.musicEnabled) {
    bgm.play().catch(err => console.warn('BGM play blocked:', err));
  }
}

function startBackgroundMusic() {
  if (settings.musicEnabled && !bgm.paused) {
    // Music is already playing, just ensure volume is correct
    bgm.volume = settings.musicVolume;
  } else if (settings.musicEnabled) {
    // Start music if it's not playing
    bgm.volume = settings.musicVolume;
    bgm.play().catch(err => console.warn('BGM play blocked:', err));
  }
}

    // Skills typing mode with combo system
    const WORDS_PER_SET = 7;
    const BASE_XP_PER_CORRECT = 25;
    const BASE_GOLD_PER_CORRECT = 10;
    const PERFECT_LINE_BONUS_XP = 50;
    const PERFECT_LINE_BONUS_GOLD = 20;

    let currentSkillKey = null;
    let currentLineWords = [];
    let nextLineWords = [];
    let currentWordIndex = 0;
    let wordsState = [];
    let setStartTime = 0;
    let correctInLine = 0;

    let wordStreak = 0; // continuous correct words across lines

    // Word memory system to reduce repetition
    const wordMemory = {
      skills: {},
      zen: new Set()
    };

    function getMultiplier() {
      // 5% per correct in streak, capped at +100% (2x)
      const m = 1 + Math.min(wordStreak, 20) * 0.05;
      return Math.max(1, Math.min(2, m));
    }
    function updateComboUI() {
      comboDisplay.textContent = `Combo x${getMultiplier().toFixed(2)} (${wordStreak})`;
    }

    function startSkill(skillKey) {
      currentSkillKey = skillKey;
      const s = profile.skills[skillKey];
      skillTitle.textContent = s.name;
      skillLevel.textContent = s.level;
      updateSkillProgressBar();
      initLines();
      wpmDisplay.textContent = 'WPM: ‚Äî';
      lineBonusDisplay.textContent = '';
      typedInput.value = '';
      showScreen('game');
      typedInput.focus();
      updateComboUI();
    }

    function initLines() {
      currentWordIndex = 0;
      correctInLine = 0;
      currentLineWords = generateWordSet(currentSkillKey);
      nextLineWords = generateWordSet(currentSkillKey);
      wordsState = new Array(currentLineWords.length).fill('');
      setStartTime = Date.now();
      updateWordBox();
    }

    function generateWordSet(skillKey) {
      const source = profile.skills[skillKey].words || [];
      const set = [];
      if (source.length === 0) {
        while (set.length < WORDS_PER_SET) set.push('add-words');
        return set;
      }
      
      // Initialize word memory for this skill if it doesn't exist
      if (!wordMemory.skills[skillKey]) {
        wordMemory.skills[skillKey] = new Set();
      }
      
      const used = new Set();
      const availableWords = source.filter(word => !wordMemory.skills[skillKey].has(word));
      
      // If we don't have enough unused words, clear the memory and start fresh
      if (availableWords.length < WORDS_PER_SET) {
        wordMemory.skills[skillKey].clear();
        availableWords.push(...source);
      }
      
      while (set.length < WORDS_PER_SET) {
        const w = availableWords[Math.floor(Math.random() * availableWords.length)];
        if (!used.has(w)) { 
          used.add(w); 
          set.push(w);
          // Mark this word as recently used
          wordMemory.skills[skillKey].add(w);
        }
      }
      return set;
    }

    function updateWordBox() {
      let line1 = '';
      for (let i=0; i<currentLineWords.length; i++){
        const word = currentLineWords[i];
        if (i < currentWordIndex) line1 += wordsState[i] + ' ';
        else if (i === currentWordIndex) line1 += highlightActiveWord(word) + ' ';
        else line1 += word + ' ';
      }
      const line2 = nextLineWords.join(' ');
      wordBox.innerHTML = (line1.trim() + '\n' + line2);
    }

    function highlightActiveWord(target) {
      const typed = typedInput.value;
      let res = '', mismatch = false;
      const L = Math.min(target.length, typed.length);
      for (let i=0;i<L;i++){
        if (!mismatch && target[i] === typed[i]) res += `<span class="letter correct">${target[i]}</span>`;
        else { mismatch = true; res += `<span class="letter incorrect">${target[i]}</span>`; }
      }
      if (target.length > typed.length) {
        const remain = target.slice(typed.length).split('').map((ch, i) =>
          i===0 && !mismatch ? `<span class="current-letter">${ch}</span>` : ch
        ).join('');
        res += remain;
      }
      return res;
    }

    typedInput.addEventListener('keydown', (e) => {
      if (e.key === ' ') { e.preventDefault(); finalizeCurrentWord(); }
    });
    typedInput.addEventListener('input', updateWordBox);

    function finalizeCurrentWord() {
      const typed = typedInput.value.trim();
      const correctWord = currentLineWords[currentWordIndex];
      if (typed === correctWord) {
        wordsState[currentWordIndex] = `<span class="final-correct">${correctWord}</span>`;
        const mult = getMultiplier();
        const xp = Math.round(BASE_XP_PER_CORRECT * mult);
        const gold = Math.round(BASE_GOLD_PER_CORRECT * mult);
        profile.gold += gold;
        correctInLine++;
        wordStreak++;
        gainXP(currentSkillKey, xp);
      } else {
        wordsState[currentWordIndex] = `<span class="final-incorrect">${correctWord}</span>`;
        wordStreak = 0; // reset streak on any mistake
      }
      updateComboUI();
      goldValue.textContent = profile.gold;
      saveProfile();

      typedInput.value = '';
      currentWordIndex++;
      if (currentWordIndex >= currentLineWords.length) handleLineCompletion();
      else updateWordBox();
    }

    function handleLineCompletion() {
      const dtMin = (Date.now() - setStartTime) / 60000;
      const wpm = currentLineWords.length / Math.max(dtMin, 0.0001);
      wpmDisplay.textContent = `WPM: ${Math.round(wpm)}`;
      profile.stats.totalSetsCompleted++;
      profile.stats.totalWPMAccumulated += wpm;

      // Perfect line bonus
      if (correctInLine === currentLineWords.length) {
        profile.stats.perfectLinesCompleted++;
        const mult = getMultiplier();
        const bonusXP = Math.round(PERFECT_LINE_BONUS_XP * mult);
        const bonusGold = Math.round(PERFECT_LINE_BONUS_GOLD * mult);
        gainXP(currentSkillKey, bonusXP);
        profile.gold += bonusGold;
        lineBonusDisplay.textContent = `Perfect line! +${bonusXP} XP, +${bonusGold} gold`;
        triggerParticlesAt(screens.game);
      } else {
        lineBonusDisplay.textContent = '';
      }

      // Update max combo achieved
      if (wordStreak > profile.stats.maxComboAchieved) {
        profile.stats.maxComboAchieved = wordStreak;
      }

      goldValue.textContent = profile.gold;
      saveProfile();
      
      // Check for achievements
      checkAchievements();

      // next line
      currentLineWords = nextLineWords;
      nextLineWords = generateWordSet(currentSkillKey);
      wordsState = new Array(currentLineWords.length).fill('');
      currentWordIndex = 0;
      correctInLine = 0;
      setStartTime = Date.now();
      updateWordBox();
    }

    function gainXP(skillKey, amount) {
      const s = profile.skills[skillKey];
      s.currentXP += amount;
      while (s.currentXP >= s.nextLevelXP && s.level < 99) {
        s.currentXP -= s.nextLevelXP;
        s.level++;
        s.nextLevelXP = Math.floor(s.nextLevelXP + 50 + (s.level * 2));
        triggerParticlesAt(screens.game);
      }
      skillLevel.textContent = s.level;
      updateSkillProgressBar();
      saveProfile();
      
      // Check for achievements after leveling up
      checkAchievements();
    }
    function updateSkillProgressBar() {
      const s = profile.skills[currentSkillKey];
      const pct = Math.max(0, Math.min(100, (s.currentXP / s.nextLevelXP) * 100));
      gameSkillProgressBar.style.width = `${pct}%`;
    }

    // Raid
let raidLevel = 1, raidMistakes = 0, raidTargetLine = '';
let raidReadyToAdvance = false;

function initRaid() {
  raidLevel = 1;
  raidMistakes = 0;            // reset only on init (not on level-up)
  raidReadyToAdvance = false;
  raidTargetLine = generateRaidLine();

  raidLevelElem.textContent = raidLevel;
  raidErrorsElem.textContent = raidMistakes;
  raidHighScoreElem.textContent = profile.raid.highScore;

  raidInput.disabled = false;
  raidInput.value = '';
  raidInput.focus();
  updateRaidWordBox();
}

function getCombinedWordList() {
  const all = [];
  for (const s of Object.values(profile.skills)) all.push(...(s.words || []));
  return Array.from(new Set(all));
}

function generateRaidLine() {
  const src = getCombinedWordList();
  const out = [];
  if (src.length === 0) {
    while (out.length < WORDS_PER_SET) out.push('add-words');
    return out.join(' ');
  }
  while (out.length < WORDS_PER_SET) out.push(src[Math.floor(Math.random() * src.length)]);
  return out.join(' ');
}

function highlightRaidWord(target) {
  const typed = raidInput.value;
  let res = '', mismatch = false;
  const L = Math.min(target.length, typed.length);
  for (let i = 0; i < L; i++) {
    if (!mismatch && target[i] === typed[i]) res += `<span class="letter correct">${target[i]}</span>`;
    else { mismatch = true; res += `<span class="letter incorrect">${target[i]}</span>`; }
  }
  if (target.length > typed.length) {
    const remain = target.slice(typed.length).split('').map((ch, i) =>
      i === 0 && !mismatch ? `<span class="current-letter">${ch}</span>` : ch
    ).join('');
    res += remain;
  }
  return res;
}

function updateRaidWordBox() {
  raidWordBox.innerHTML = highlightRaidWord(raidTargetLine);
  if (raidReadyToAdvance) {
    raidWordBox.innerHTML += `<br><span class="muted">Press Space to continue</span>`;
  }
}

// Typing: check prefix; increment cumulative errors on mismatch; do NOT level up here
raidInput.addEventListener('input', () => {
  const typed = raidInput.value;
  updateRaidWordBox();

  if (!raidTargetLine.startsWith(typed)) {
    raidMistakes++;
    raidInput.value = '';
    raidErrorsElem.textContent = raidMistakes;
    raidReadyToAdvance = false;

    if (raidMistakes >= 3) {
      raidWordBox.innerHTML = `<span class="final-incorrect">Game Over! You reached Raid Level ${raidLevel}.</span>`;
      raidInput.disabled = true;
      return;
    }

    updateRaidWordBox();
    return;
  }

  // Full line typed correctly: wait for Space to advance
  raidReadyToAdvance = (typed === raidTargetLine);
  updateRaidWordBox();
});

// Advance on Space after finishing the line; keep errors cumulative

// Zen Mode - Multi-word line-based typing like Skills mode
const zenWords = [
  "the","of","and","a","to","in","he","have","it","that","for","they","I","with","as","not","on","she","at","by","this","we","you","do","but","from","or","which","one","would","all","will","there","say","who","make","when","can","more","if","no","man","out","other","so","what","time","up","go","about","than","into","could","state","only","new","year","some","take","come","these","know","see","use","get","like","then","first","any","work","now","may","such","give","over","think","most","even","find","day","also","after","way","many","must","look","before","great","back","through","long","where","much","should","well","people","down","own","just","because","good","each","those","feel","seem","how","high","too","place","little","world","very","still","nation","hand","old","life","tell","write","become","here","show","house","both","between","need","mean","call","develop","under","last","right","move","thing","general","school","never","same","another","begin","while","number","part","turn","real","leave","might","want","point","form","off","child","few","small","since","against","ask","late","home","interest","large","person","end","open","public","follow","during","present","without","again","hold","govern","around","possible","head","consider","word","program","problem","however","lead","system","set","order","eye","plan","run","keep","face","fact","group","play","stand","increase","early","course","change","help","line"



];

// Zen mode variables (similar to Skills mode)
let zenCurrentLineWords = [];
let zenNextLineWords = [];
let zenCurrentWordIndex = 0;
let zenWordsState = [];
let zenSetStartTime = 0;
let zenCorrectInLine = 0;
let zenWordStreak = 0;
let zenWordsCompleted = 0;
let zenBestStreak = 0;

function initZen() {
  // Load stats from profile
  zenWordsCompleted = profile.zen.wordsCompleted || 0;
  zenBestStreak = profile.zen.bestStreak || 0;
  
  // Reset line-based variables
  zenWordStreak = 0;
  zenCorrectInLine = 0;
  
  // Update UI
  zenWordsCompletedElem.textContent = zenWordsCompleted;
  zenStreakElem.textContent = zenWordStreak;
  zenBestStreakElem.textContent = zenBestStreak;
  
  // Initialize lines
  initZenLines();
  
  // Focus input
  zenInput.disabled = false;
  zenInput.value = '';
  zenInput.focus();
}

function initZenLines() {
  zenCurrentWordIndex = 0;
  zenCorrectInLine = 0;
  zenCurrentLineWords = generateZenWordSet();
  zenNextLineWords = generateZenWordSet();
  zenWordsState = new Array(zenCurrentLineWords.length).fill('');
  zenSetStartTime = Date.now();
  updateZenWordBox();
}

function generateZenWordSet() {
  const set = [];
  const used = new Set();
  
  // Get available words that haven't been recently used
  const availableWords = zenWords.filter(word => !wordMemory.zen.has(word));
  
  // If we don't have enough unused words, clear the memory and start fresh
  if (availableWords.length < WORDS_PER_SET) {
    wordMemory.zen.clear();
    availableWords.push(...zenWords);
  }
  
  while (set.length < WORDS_PER_SET) {
    const w = availableWords[Math.floor(Math.random() * availableWords.length)];
    if (!used.has(w)) { 
      used.add(w); 
      set.push(w);
      // Mark this word as recently used
      wordMemory.zen.add(w);
    }
  }
  return set;
}

function updateZenWordBox() {
  let line1 = '';
  for (let i = 0; i < zenCurrentLineWords.length; i++) {
    const word = zenCurrentLineWords[i];
    if (i < zenCurrentWordIndex) {
      line1 += zenWordsState[i] + ' ';
    } else if (i === zenCurrentWordIndex) {
      line1 += highlightZenActiveWord(word) + ' ';
    } else {
      line1 += word + ' ';
    }
  }
  const line2 = zenNextLineWords.join(' ');
  zenWordBox.innerHTML = (line1.trim() + '\n' + line2);
}

function highlightZenActiveWord(target) {
  const typed = zenInput.value;
  let res = '', mismatch = false;
  const L = Math.min(target.length, typed.length);
  for (let i = 0; i < L; i++) {
    if (!mismatch && target[i] === typed[i]) {
      res += `<span class="letter correct">${target[i]}</span>`;
    } else { 
      mismatch = true; 
      res += `<span class="letter incorrect">${target[i]}</span>`; 
    }
  }
  if (target.length > typed.length) {
    const remain = target.slice(typed.length).split('').map((ch, i) =>
      i === 0 && !mismatch ? `<span class="current-letter">${ch}</span>` : ch
    ).join('');
    res += remain;
  }
  return res;
}

function finalizeZenWord() {
  const typed = zenInput.value.trim();
  const correctWord = zenCurrentLineWords[zenCurrentWordIndex];
  
  if (typed === correctWord) {
    zenWordsState[zenCurrentWordIndex] = `<span class="final-correct">${correctWord}</span>`;
    zenCorrectInLine++;
    zenWordStreak++;
    zenWordsCompleted++;
    
    if (zenWordStreak > zenBestStreak) {
      zenBestStreak = zenWordStreak;
    }
    
    // Update profile
    profile.zen.wordsCompleted = zenWordsCompleted;
    profile.zen.bestStreak = zenBestStreak;
    saveProfile();
    
    // Check for achievements
    checkAchievements();
    
    // Update UI
    zenWordsCompletedElem.textContent = zenWordsCompleted;
    zenStreakElem.textContent = zenWordStreak;
    zenBestStreakElem.textContent = zenBestStreak;
  } else {
    zenWordsState[zenCurrentWordIndex] = `<span class="final-incorrect">${correctWord}</span>`;
    zenWordStreak = 0; // reset streak on any mistake
    zenStreakElem.textContent = zenWordStreak;
  }
  
  zenInput.value = '';
  zenCurrentWordIndex++;
  
  if (zenCurrentWordIndex >= zenCurrentLineWords.length) {
    handleZenLineCompletion();
  } else {
    updateZenWordBox();
  }
}

function handleZenLineCompletion() {
  // Perfect line bonus
  if (zenCorrectInLine === zenCurrentLineWords.length) {
    zenWordStreak += 2; // bonus streak for perfect line
    if (zenWordStreak > zenBestStreak) {
      zenBestStreak = zenWordStreak;
    }
    profile.zen.bestStreak = zenBestStreak;
    saveProfile();
    zenStreakElem.textContent = zenWordStreak;
    zenBestStreakElem.textContent = zenBestStreak;
  }
  
  // Next line
  zenCurrentLineWords = zenNextLineWords;
  zenNextLineWords = generateZenWordSet();
  zenWordsState = new Array(zenCurrentLineWords.length).fill('');
  zenCurrentWordIndex = 0;
  zenCorrectInLine = 0;
  zenSetStartTime = Date.now();
  updateZenWordBox();
}

// Zen input event listeners (same as Skills mode)
zenInput.addEventListener('keydown', (e) => {
  if (e.key === ' ') { 
    e.preventDefault(); 
    finalizeZenWord(); 
  }
});

zenInput.addEventListener('input', updateZenWordBox);
raidInput.addEventListener('keydown', (e) => {
  if (e.key === ' ' && raidReadyToAdvance && raidInput.value.trim() === raidTargetLine) {
    e.preventDefault();

    raidLevel++;
    if (raidLevel > profile.raid.highScore) {
      profile.raid.highScore = raidLevel;
      saveProfile();
      
      // Check for achievements
      checkAchievements();
    }

    raidTargetLine = generateRaidLine();
    raidReadyToAdvance = false;

    raidLevelElem.textContent = raidLevel;
    raidHighScoreElem.textContent = profile.raid.highScore;
    raidErrorsElem.textContent = raidMistakes; // cumulative

    raidInput.value = '';
    updateRaidWordBox();
  }
});

    // Arena
    let arenaScore = 0, arenaTime = 30, arenaTimer = null, spawnTimer = null;
    const arenaDifficulties = { easy: { spawnRate: 600 }, medium: { spawnRate: 400 }, hard: { spawnRate: 288 } };

    function cleanupArena() {
      if (arenaTimer) clearInterval(arenaTimer);
      if (spawnTimer) clearInterval(spawnTimer);
      arenaTimer = null;
      spawnTimer = null;
      
      // Save current score if Arena was active
      if (arenaScore > 0) {
        const diff = arenaDifficultySelect.value;
        if (arenaScore > (profile.arena.highScores[diff] || 0)) {
          profile.arena.highScores[diff] = arenaScore;
          saveProfile();
        }
      }
      
      // Clear all targets from the board
      if (arenaBoard) {
        arenaBoard.innerHTML = '';
      }
    }

    function clearArenaTargets() {
      if (arenaBoard) {
        // Remove all target elements (circles) but keep the start button
        const targets = arenaBoard.querySelectorAll('div[style*="border-radius:50%"]');
        targets.forEach(target => {
          if (target.parentNode) target.parentNode.removeChild(target);
        });
      }
    }

    // Clean up Arena when page is hidden or unloaded
    document.addEventListener('visibilitychange', () => {
      if (document.hidden && (arenaTimer || spawnTimer)) {
        cleanupArena();
      }
    });

    window.addEventListener('beforeunload', cleanupArena);

    function resetArenaUI() {
      // Clear any existing timers
      if (arenaTimer) clearInterval(arenaTimer);
      if (spawnTimer) clearInterval(spawnTimer);
      arenaTimer = null;
      spawnTimer = null;
      
      arenaScore = 0; arenaTime = 30;
      arenaScoreElem.textContent = '0';
      arenaTimerElem.textContent = '30';
      arenaHighScoreElem.textContent = profile.arena.highScores[arenaDifficultySelect.value] || 0;
      
      // Clear all targets and reset the board
      clearArenaTargets();
      arenaBoard.innerHTML = '';
      
      const btn = document.createElement('button');
      btn.id = 'startArenaBtn'; btn.className = 'btn'; btn.textContent = 'Start Arena';
      btn.style.position = 'absolute'; btn.style.top = '50%'; btn.style.left = '50%'; btn.style.transform = 'translate(-50%,-50%)';
      btn.addEventListener('click', startArena);
      arenaBoard.appendChild(btn);
    }

    function startArena() {
      // Safety check: clear any existing timers first
      if (arenaTimer || spawnTimer) {
        clearInterval(arenaTimer);
        clearInterval(spawnTimer);
        arenaTimer = null;
        spawnTimer = null;
      }
      
      const diff = arenaDifficultySelect.value;
      const settingsDiff = arenaDifficulties[diff];
      arenaScore = 0; arenaTime = 30;
      arenaScoreElem.textContent = '0';
      arenaHighScoreElem.textContent = profile.arena.highScores[diff] || 0;
      arenaTimerElem.textContent = '30';
      arenaBoard.innerHTML = '';
      
      spawnTimer = setInterval(spawnTarget, settingsDiff.spawnRate);
      arenaTimer = setInterval(() => {
        arenaTime--; arenaTimerElem.textContent = arenaTime;
        if (arenaTime <= 0) {
          clearInterval(arenaTimer); clearInterval(spawnTimer);
          arenaTimer = null; spawnTimer = null;
          finishArena(diff);
        }
      }, 1000);
    }

    function finishArena(difficulty) {
      // Update high score if current score is higher
      if (arenaScore > (profile.arena.highScores[difficulty] || 0)) {
        profile.arena.highScores[difficulty] = arenaScore;
        saveProfile();
        arenaHighScoreElem.textContent = arenaScore;
        console.log(`New high score for ${difficulty}: ${arenaScore}`);
        
        // Check for achievements
        checkAchievements();
      } else {
        console.log(`Score ${arenaScore} didn't beat high score ${profile.arena.highScores[difficulty] || 0} for ${difficulty}`);
      }
      
      // Clear all targets
      clearArenaTargets();
      
      // Show final score and restart button
      arenaBoard.innerHTML = `
                 <div style="text-align:center; padding:1rem;">
           <h3>Arena Complete!</h3>
           <p>Final Score: ${arenaScore}</p>
           <p>High Score: ${profile.arena.highScores[difficulty] || 0}</p>
           <div style="display:flex; gap:0.5rem; justify-content:center; margin-top:1rem;">
             <button class="btn" onclick="resetArenaUI()">Play Again</button>
           </div>
         </div>
      `;
    }

    function spawnTarget() {
      const target = document.createElement('div');
      const slotSize = 32, gapX = 5, gapY = 1, cols = 4, rows = 7;
      const col = Math.floor(Math.random()*cols), row = Math.floor(Math.random()*rows);
      const left = col * (slotSize + gapX), top = row * (slotSize + gapY);
      const style = getComputedStyle(document.documentElement);
      const circleColor = style.getPropertyValue('--accent-correct') || '#ff4444';

      target.style.cssText = `
        position:absolute;width:${slotSize}px;height:${slotSize}px;border-radius:50%;
        background:${circleColor};top:${top}px;left:${left}px;cursor:pointer;animation: fadeout 1s linear forwards;
      `;
      
      // Only add target if Arena is still active
      if (arenaTimer && spawnTimer && arenaBoard) {
        arenaBoard.appendChild(target);
        const timeout = setTimeout(() => { 
          if (target.parentNode) arenaBoard.removeChild(target); 
        }, 1000);
        
        target.onclick = () => {
          arenaScore++; 
          arenaScoreElem.textContent = arenaScore;
          clearTimeout(timeout); 
          if (target.parentNode) arenaBoard.removeChild(target);
        };
      }
    }

    // Duel
    let duelPlayerHP = 99, duelOpponentHP = 99, duelWager = 0, duelRounds = 0, playerTurn = (crypto.getRandomValues(new Uint32Array(1))[0] & 1) === 1;
    function initDuelUI() {
      updateDuelGoldDisplay();
      updateDuelHistoryTable();
      duelCombatArea.style.display = 'none';
      duelResult.textContent = '';
      duelLog.innerHTML = '';
    }
    function updateDuelGoldDisplay() {
      duelGoldDisplay.textContent = profile.gold;
      goldValue.textContent = profile.gold;
    }
    startDuelBtn.addEventListener('click', startDuel);

    function startDuel() {
      duelWager = parseInt(duelWagerInput.value, 10);
      if (isNaN(duelWager) || duelWager < 1) { alert('Enter a valid wager'); return; }
      if (duelWager > profile.gold) { alert("You don't have enough gold!"); return; }
      duelPlayerHP = 99; duelOpponentHP = 99; duelRounds = 0; playerTurn = (crypto.getRandomValues(new Uint32Array(1))[0] & 1) === 1;
      playerHPSpan.textContent = duelPlayerHP; opponentHPSpan.textContent = duelOpponentHP;
      duelResult.textContent = ''; duelLog.innerHTML = ''; duelCombatArea.style.display = 'block';
      nextTurn();
    }
    function nextTurn() {
      if (duelPlayerHP <= 0 || duelOpponentHP <= 0) return finishDuel();
      duelRounds++;
      if (playerTurn) {
        const hit = Math.floor(Math.random()*25);
        duelOpponentHP = Math.max(duelOpponentHP - hit, 0);
        opponentHPSpan.textContent = duelOpponentHP;
        logPlayerHit(hit); playerTurn = false;
      } else {
        const hit = Math.floor(Math.random()*25);
        duelPlayerHP = Math.max(duelPlayerHP - hit, 0);
        playerHPSpan.textContent = duelPlayerHP;
        logOpponentHit(hit); playerTurn = true;
      }
      setTimeout(nextTurn, 1000);
    }
    function logPlayerHit(hit) {
      const row = document.createElement('div');
      row.className = 'combatRow'; row.style.display = 'flex'; row.style.justifyContent = 'space-between'; row.style.padding = '2px 0';
      row.innerHTML = `<span>You: ${hit}</span><span class="opponentHit"></span>`;
      duelLog.appendChild(row); duelLog.scrollTop = duelLog.scrollHeight;
    }
    function logOpponentHit(hit) {
      const last = duelLog.querySelector('.combatRow:last-child');
      if (last) last.querySelector('.opponentHit').textContent = `Opponent: ${hit}`;
      else {
        const row = document.createElement('div'); row.className = 'combatRow';
        row.style.display = 'flex'; row.style.justifyContent = 'space-between'; row.style.padding = '2px 0';
        row.innerHTML = `<span></span><span>Opponent: ${hit}</span>`;
        duelLog.appendChild(row);
      }
      duelLog.scrollTop = duelLog.scrollHeight;
    }
    function finishDuel() {
      let result, goldChange;
      if (duelOpponentHP <= 0) {
        result = 'Win'; goldChange = duelWager; profile.gold += duelWager;
        duelResult.textContent = `Victory! You won ${duelWager} gold.`;
      } else {
        result = 'Lose'; goldChange = -duelWager; profile.gold = Math.max(profile.gold - duelWager, 0);
        duelResult.textContent = `Defeat... You lost ${duelWager} gold.`;
      }
      profile.duel.history.push({ result, wager: duelWager, goldChange, rounds: duelRounds, at: Date.now() });
      saveProfile(); updateDuelGoldDisplay(); updateDuelHistoryTable();
      
      // Check for achievements
      checkAchievements();
    }
    function updateDuelHistoryTable() {
      const recent = profile.duel.history.slice(-5).reverse();
      duelHistoryTable.innerHTML = recent.map(m =>
        `<tr>
          <td style="padding:.4rem;">${m.result}</td>
          <td style="padding:.4rem;">${m.wager}</td>
          <td style="padding:.4rem;">${m.goldChange}</td>
          <td style="padding:.4rem;">${m.rounds}</td>
        </tr>`
      ).join('');
    }

    // Shop
    function renderShop() {
      // Themes
      themeCards.innerHTML = '';
      Object.entries(themeCatalog).forEach(([key, meta]) => {
        const owned = profile.shop.purchasedThemes.includes(key);
        const isActive = profile.shop.activeTheme === key;
        const card = document.createElement('div');
        card.className = 'card';
        card.innerHTML = `
          <div class="card-row">
            <div style="font-weight:700;">${meta.name}</div>
            <div class="muted">${owned ? 'Owned' : meta.price + ' gold'}</div>
          </div>
          <div class="theme-swatch">
            <div class="swatch" style="background:${meta.swatch[0]}"></div>
            <div class="swatch" style="background:${meta.swatch[1]}"></div>
            <div class="swatch" style="background:${meta.swatch[2]}"></div>
          </div>
          <div class="card-row">
            <button class="btn ${owned ? '' : 'btn-ghost'}" data-type="theme" data-action="${owned ? 'apply' : 'buy'}" data-key="${key}">
              ${owned ? (isActive ? 'Active' : 'Apply') : 'Buy'}
            </button>
          </div>
        `;
        themeCards.appendChild(card);
      });

      // Bind buttons
      document.querySelectorAll('#shopScreen button[data-type]').forEach(btn => {
        btn.addEventListener('click', () => {
          const type = btn.getAttribute('data-type');
          const action = btn.getAttribute('data-action');
          const key = btn.getAttribute('data-key');
          if (type === 'theme') {
            if (action === 'buy') buyTheme(key); else applyThemeOwned(key);
          }
        });
      });
    }

    function buyTheme(key) {
      const meta = themeCatalog[key]; if (!meta) return;
      if (profile.shop.purchasedThemes.includes(key)) return;
      if (profile.gold < meta.price) { alert('Not enough gold'); return; }
      profile.gold -= meta.price; profile.shop.purchasedThemes.push(key);
      saveProfile(); renderShop(); renderHome();
      
      // Check for achievements
      checkAchievements();
    }
    function applyThemeOwned(key) {
      if (!profile.shop.purchasedThemes.includes(key)) return;
      profile.shop.activeTheme = key; saveProfile(); applyTheme(key); renderShop();
    }

    // Init
    function init(){ 
      applySettings(); 
      
      // Check if we have a saved profile
      if (profile && profile.name) {
        // Automatically load the existing profile and go to home
        profile.lastPlayed = Date.now();
        saveProfile();
        startBackgroundMusic();
        checkAchievements();
        showScreen('home');
        updateProfileDisplay();
        renderHome();
      } else {
        // Show startup screen to create new profile
        showScreen('startup');
        renderStartupScreen();
      }
    }

    // Debug function to show Arena state
    function debugArenaState() {
      console.log('=== Arena Debug Info ===');
      console.log('Current Score:', arenaScore);
      console.log('Current Time:', arenaTime);
      console.log('Timer Active:', !!arenaTimer);
      console.log('Spawn Timer Active:', !!spawnTimer);
      console.log('Board Children:', arenaBoard ? arenaBoard.children.length : 'No board');
      console.log('High Scores:', profile.arena.highScores);
      console.log('Current Difficulty:', arenaDifficultySelect.value);
      console.log('=======================');
    }

    // Make debug function available globally for testing
    window.debugArenaState = debugArenaState;

    // Keyboard Navigation System
    let currentFocusIndex = 0;
    let focusableElements = [];
    let currentScreen = 'startup';

    // Initialize keyboard navigation for a screen
    function initKeyboardNavigation(screen) {
      currentScreen = screen;
      currentFocusIndex = 0;
      
      if (screen === 'home') {
        // Home screen: top row buttons + skill buttons
        const topRowButtons = [
          document.getElementById('achievementsBtn'),
          document.getElementById('raidBtn'),
          document.getElementById('arenaBtn'),
          document.getElementById('duelBtn'),
          document.getElementById('zenBtn'),
          document.getElementById('shopBtn'),
          document.getElementById('optionsBtn')
        ].filter(Boolean);
        
        const skillButtons = Array.from(document.querySelectorAll('#skillButtonsContainer .skill-button'));
        
        focusableElements = [...topRowButtons, ...skillButtons];
        
        // Store grid information for Excel-like navigation
        window.topRowCount = topRowButtons.length;
        window.skillRowCount = skillButtons.length;
        window.skillColumns = 2; // Skill buttons are in 2 columns
        window.skillRows = Math.ceil(skillButtons.length / window.skillColumns);
        
        console.log('Home screen keyboard navigation initialized:', {
          topRowCount: window.topRowCount,
          skillRowCount: window.skillRowCount,
          skillColumns: window.skillColumns,
          skillRows: window.skillRows,
          totalElements: focusableElements.length
        });
      } else if (screen === 'achievements') {
        // Achievements: title options + achievement items
        const titleOptions = Array.from(document.querySelectorAll('#titleSelectionList .title-option'));
        const achievementItems = Array.from(document.querySelectorAll('#unlockedList .achievement-item, #lockedList .achievement-item'));
        
        focusableElements = [...titleOptions, ...achievementItems];
        
        console.log('Achievements screen keyboard navigation initialized:', {
          titleOptionsCount: titleOptions.length,
          achievementItemsCount: achievementItems.length,
          totalElements: focusableElements.length
        });
      } else if (screen === 'shop') {
        // Shop: theme buttons in grid layout (not the cards themselves)
        const themeButtons = Array.from(document.querySelectorAll('#shopScreen .card button[data-type="theme"]'));
        
        focusableElements = [...themeButtons];
        
        // Calculate grid layout for Excel-like navigation
        // The shop grid uses CSS grid with auto-fill, so we need to determine actual columns
        const shopGrid = document.querySelector('#shopScreen .shop-grid');
        if (shopGrid) {
          const computedStyle = window.getComputedStyle(shopGrid);
          const gridTemplateColumns = computedStyle.gridTemplateColumns;
          
          // Parse the grid template to get actual column count
          // For auto-fill with minmax, we need to calculate based on container width
          const containerWidth = shopGrid.offsetWidth;
          const cardWidth = 220; // minmax(220px, 1fr) from CSS
          const gap = 16; // 1rem gap from CSS
          
          // Calculate how many columns can fit
          window.shopColumns = Math.floor((containerWidth + gap) / (cardWidth + gap));
          window.shopRows = Math.ceil(themeButtons.length / window.shopColumns);
          
          // Ensure at least 1 column
          if (window.shopColumns < 1) window.shopColumns = 1;
        } else {
          // Fallback if grid element not found
          window.shopColumns = 1;
          window.shopRows = themeButtons.length;
        }
        
        console.log('Shop screen keyboard navigation initialized:', {
          themeButtonsCount: themeButtons.length,
          shopColumns: window.shopColumns,
          shopRows: window.shopRows,
          totalElements: focusableElements.length
        });
      } else {
        focusableElements = [];
        return;
      }
      
      // Set initial focus
      if (focusableElements.length > 0) {
        setFocus(0);
      }
    }

    // Set focus to a specific element
    function setFocus(index) {
      if (focusableElements.length === 0) return;
      
      // Remove previous focus
      focusableElements.forEach(el => el.classList.remove('keyboard-focus'));
      
      // Set new focus with proper bounds checking
      currentFocusIndex = (index + focusableElements.length) % focusableElements.length;
      if (currentFocusIndex < 0) currentFocusIndex = 0;
      if (currentFocusIndex >= focusableElements.length) currentFocusIndex = focusableElements.length - 1;
      
      const targetElement = focusableElements[currentFocusIndex];
      
      if (targetElement) {
        targetElement.classList.add('keyboard-focus');
        targetElement.scrollIntoView({ behavior: 'smooth', block: 'nearest' });
      }
    }

    // Handle keyboard navigation
    function handleKeyboardNavigation(e) {
      // Handle Escape key for all screens
      if (e.key === 'Escape') {
        e.preventDefault();
        if (currentScreen !== 'home' && currentScreen !== 'startup') {
          // Return to home screen from any menu
          showScreen('home');
          return;
        }
        return;
      }
      
      // Only handle arrow keys and Enter/Space for specific screens
      if (currentScreen !== 'home' && currentScreen !== 'achievements' && currentScreen !== 'shop') return;
      if (focusableElements.length === 0) return;
      
      let newIndex = currentFocusIndex;
      
      switch (e.key) {
        case 'ArrowUp':
          e.preventDefault();
          if (currentScreen === 'home') {
            if (currentFocusIndex < window.topRowCount) {
              // In top row, move to previous top row element
              newIndex = currentFocusIndex - 1;
            } else {
              // In skill grid, move to element directly above (same column, previous row)
              const skillIndex = currentFocusIndex - window.topRowCount;
              const currentSkillRow = Math.floor(skillIndex / window.skillColumns);
              const currentSkillCol = skillIndex % window.skillColumns;
              
              if (currentSkillRow > 0) {
                // Move up one row in the same column
                const newSkillIndex = (currentSkillRow - 1) * window.skillColumns + currentSkillCol;
                newIndex = window.topRowCount + newSkillIndex;
              } else {
                // At top of skill grid, move to corresponding top row button
                newIndex = Math.min(currentSkillCol, window.topRowCount - 1);
              }
            }
          } else if (currentScreen === 'achievements') {
            // In achievements, up arrow moves to previous element
            newIndex = currentFocusIndex - 1;
          } else if (currentScreen === 'shop') {
            // In shop, up arrow moves to element directly above (same column, previous row)
            const currentRow = Math.floor(currentFocusIndex / window.shopColumns);
            const currentCol = currentFocusIndex % window.shopColumns;
            
            if (currentRow > 0) {
              // Move up one row in the same column
              newIndex = (currentRow - 1) * window.shopColumns + currentCol;
            } else {
              // At top row, wrap to bottom row of same column
              newIndex = (window.shopRows - 1) * window.shopColumns + currentCol;
              if (newIndex >= focusableElements.length) {
                newIndex = focusableElements.length - 1;
              }
            }
          }
          break;
          
        case 'ArrowDown':
          e.preventDefault();
          if (currentScreen === 'home') {
            if (currentFocusIndex < window.topRowCount) {
              // In top row, move to corresponding skill element below
              const topRowIndex = currentFocusIndex;
              const skillIndex = Math.min(topRowIndex, window.skillRowCount - 1);
              newIndex = window.topRowCount + skillIndex;
            } else {
              // In skill grid, move to element directly below (same column, next row)
              const skillIndex = currentFocusIndex - window.topRowCount;
              const currentSkillRow = Math.floor(skillIndex / window.skillColumns);
              const currentSkillCol = skillIndex % window.skillColumns;
              
              if (currentSkillRow < window.skillRows - 1) {
                // Move down one row in the same column
                const newSkillIndex = (currentSkillRow + 1) * window.skillColumns + currentSkillCol;
                if (newSkillIndex < window.skillRowCount) {
                  newIndex = window.topRowCount + newSkillIndex;
                } else {
                  // At bottom of grid, wrap to top of same column
                  newIndex = window.topRowCount + currentSkillCol;
                }
              } else {
                // At bottom of grid, wrap to top of same column
                newIndex = window.topRowCount + currentSkillCol;
              }
            }
          } else if (currentScreen === 'achievements') {
            // In achievements, down arrow moves to next element
            newIndex = currentFocusIndex + 1;
          } else if (currentScreen === 'shop') {
            // In shop, down arrow moves to element directly below (same column, next row)
            const currentRow = Math.floor(currentFocusIndex / window.shopColumns);
            const currentCol = currentFocusIndex % window.shopColumns;
            
            if (currentRow < window.shopRows - 1) {
              // Move down one row in the same column
              newIndex = (currentRow + 1) * window.shopColumns + currentCol;
              if (newIndex >= focusableElements.length) {
                // At bottom of grid, wrap to top of same column
                newIndex = currentCol;
              }
            } else {
              // At bottom row, wrap to top row of same column
              newIndex = currentCol;
            }
          }
          break;
          
        case 'ArrowLeft':
          e.preventDefault();
          if (currentScreen === 'home') {
            if (currentFocusIndex < window.topRowCount) {
              // In top row, move to previous top row element
              newIndex = currentFocusIndex - 1;
            } else {
              // In skill grid, move to element directly to the left (previous column, same row)
              const skillIndex = currentFocusIndex - window.topRowCount;
              const currentSkillRow = Math.floor(skillIndex / window.skillColumns);
              const currentSkillCol = skillIndex % window.skillColumns;
              
              if (currentSkillCol > 0) {
                // Move left one column in the same row
                const newSkillIndex = currentSkillRow * window.skillColumns + (currentSkillCol - 1);
                newIndex = window.topRowCount + newSkillIndex;
              } else {
                // At left edge, wrap to rightmost column of same row
                const newSkillIndex = currentSkillRow * window.skillColumns + (window.skillColumns - 1);
                if (newSkillIndex < window.skillRowCount) {
                  newIndex = window.topRowCount + newSkillIndex;
                }
              }
            }
          } else if (currentScreen === 'achievements') {
            // In achievements, left arrow moves to previous element
            newIndex = currentFocusIndex - 1;
          } else if (currentScreen === 'shop') {
            // In shop, left arrow moves to element directly to the left (previous column, same row)
            const currentRow = Math.floor(currentFocusIndex / window.shopColumns);
            const currentCol = currentFocusIndex % window.shopColumns;
            
            if (currentCol > 0) {
              // Move left one column in the same row
              newIndex = currentRow * window.shopColumns + (currentCol - 1);
            } else {
              // At left edge, wrap to rightmost column of same row
              newIndex = currentRow * window.shopColumns + (window.shopColumns - 1);
              if (newIndex >= focusableElements.length) {
                newIndex = focusableElements.length - 1;
              }
            }
          }
          break;
          
        case 'ArrowRight':
          e.preventDefault();
          if (currentScreen === 'home') {
            if (currentFocusIndex < window.topRowCount) {
              // In top row, move to next top row element
              newIndex = currentFocusIndex + 1;
            } else {
              // In skill grid, move to element directly to the right (next column, same row)
              const skillIndex = currentFocusIndex - window.topRowCount;
              const currentSkillRow = Math.floor(skillIndex / window.skillColumns);
              const currentSkillCol = skillIndex % window.skillColumns;
              
              if (currentSkillCol < window.skillColumns - 1) {
                // Move right one column in the same row
                const newSkillIndex = currentSkillRow * window.skillColumns + (currentSkillCol + 1);
                if (newSkillIndex < window.skillRowCount) {
                  newIndex = window.topRowCount + newSkillIndex;
                }
              } else {
                // At right edge, wrap to leftmost column of same row
                const newSkillIndex = currentSkillRow * window.skillColumns;
                if (newSkillIndex < window.skillRowCount) {
                  newIndex = window.topRowCount + newSkillIndex;
                }
              }
            }
          } else if (currentScreen === 'achievements') {
            // In achievements, right arrow moves to next element
            newIndex = currentFocusIndex + 1;
          } else if (currentScreen === 'shop') {
            // In shop, right arrow moves to element directly to the right (next column, same row)
            const currentRow = Math.floor(currentFocusIndex / window.shopColumns);
            const currentCol = currentFocusIndex % window.shopColumns;
            
            if (currentCol < window.shopColumns - 1) {
              // Move right one column in the same row
              newIndex = currentRow * window.shopColumns + (currentCol + 1);
              if (newIndex >= focusableElements.length) {
                // At right edge, wrap to leftmost column of same row
                newIndex = currentRow * window.shopColumns;
              }
            } else {
              // At right edge, wrap to leftmost column of same row
              newIndex = currentRow * window.shopColumns;
            }
          }
          break;
          
        case 'Enter':
        case ' ':
          e.preventDefault();
          if (focusableElements[currentFocusIndex]) {
            focusableElements[currentFocusIndex].click();
          }
          return;
          
        default:
          return; // Don't prevent default for other keys
      }
      
      setFocus(newIndex);
    }

    // Add keyboard event listener
    document.addEventListener('keydown', handleKeyboardNavigation);

    // Update showScreen function to initialize keyboard navigation
    const originalShowScreen = showScreen;
    showScreen = function(key) {
      originalShowScreen(key);
      // Small delay to ensure DOM is fully updated before initializing keyboard navigation
      setTimeout(() => initKeyboardNavigation(key), 10);
    };

    // Update renderHome to refresh keyboard navigation
    const originalRenderHome = renderHome;
    renderHome = function() {
      originalRenderHome();
      if (currentScreen === 'home') {
        initKeyboardNavigation('home');
      }
    };

    // Update renderAchievements to refresh keyboard navigation
    const originalRenderAchievements = renderAchievements;
    renderAchievements = function() {
      originalRenderAchievements();
      if (currentScreen === 'achievements') {
        // Small delay to ensure DOM is updated
        setTimeout(() => initKeyboardNavigation('achievements'), 50);
      }
    };

    // Update renderShop to refresh keyboard navigation
    const originalRenderShop = renderShop;
    renderShop = function() {
      originalRenderShop();
      if (currentScreen === 'shop') {
        // Small delay to ensure DOM is updated
        setTimeout(() => initKeyboardNavigation('shop'), 50);
      }
    };

    // Init
    init();
  </script>
</body>
</html>